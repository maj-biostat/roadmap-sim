[
  {
    "objectID": "notebooks/simulation-pars.html#baseline-response",
    "href": "notebooks/simulation-pars.html#baseline-response",
    "title": "Simulation settings",
    "section": "Baseline response",
    "text": "Baseline response\nThe baseline probability/log-odds of treatment success is assumed to vary by silo and site of infection as detailed below.\n\n\nBaseline probability of treatment success by silo and site of infection\n\n\nSilo\nJoint\nPr(trt success)\nlog-odds\n\n\n\n\nearly\nknee\n0.65\n0.62\n\n\nearly\nhip\n0.75\n1.10\n\n\nlate\nknee\n0.55\n0.20\n\n\nlate\nhip\n0.6\n0.41\n\n\nchronic\nknee\n0.6\n0.41\n\n\nchronic\nhip\n0.65\n0.62",
    "crumbs": [
      "Design",
      "Simulation settings"
    ]
  },
  {
    "objectID": "notebooks/simulation-pars.html#accrual",
    "href": "notebooks/simulation-pars.html#accrual",
    "title": "Simulation settings",
    "section": "Accrual",
    "text": "Accrual\nAccrual is assumed to follow a non-homogeneous Poisson process event times with ramp up over the first 12 months of enrolment and then enrolment of around 1.5 per day.\n\n\nCode\n# events per day\nlambda = 1.52\n# ramp up over 12 months \nrho = function(t) pmin(t/360, 1)\n\nd_fig &lt;- data.table(\n  t = 0:(5 * 365),\n  # expected number enrolled\n  n = c(0, nhpp.mean(lambda, rho, t1 = 5 * 365, num.points = 5 * 365))\n)\n\nggplot(d_fig, aes(x = t/365, y = n)) +\n  geom_line() +\n  scale_x_continuous(\"Year\") +\n  scale_y_continuous(\"E[Accrual]\", breaks = seq(0, 2500, by = 500))\n\n\n\n\n\n\n\n\nFigure 1: Expected accrual",
    "crumbs": [
      "Design",
      "Simulation settings"
    ]
  },
  {
    "objectID": "notebooks/simulation-pars.html#domain-non-membership-effects",
    "href": "notebooks/simulation-pars.html#domain-non-membership-effects",
    "title": "Simulation settings",
    "section": "Domain non-membership effects",
    "text": "Domain non-membership effects\nWe assume a small effects for not being randomised to a domain for all domains.",
    "crumbs": [
      "Design",
      "Simulation settings"
    ]
  },
  {
    "objectID": "notebooks/simulation-pars.html#missingness",
    "href": "notebooks/simulation-pars.html#missingness",
    "title": "Simulation settings",
    "section": "Missingness",
    "text": "Missingness\nMissingness is not implemented.",
    "crumbs": [
      "Design",
      "Simulation settings"
    ]
  },
  {
    "objectID": "notebooks/simulation-pars.html#non-differential-follow-up",
    "href": "notebooks/simulation-pars.html#non-differential-follow-up",
    "title": "Simulation settings",
    "section": "Non-differential follow-up",
    "text": "Non-differential follow-up\nTo avoid artifacts associated with non-differential follow-up (e.g. early vs late deaths), participants will be included in the analyses only when they reach the primary endpoints (12 months) irrespective of whether they experienced treatment failure before that time.",
    "crumbs": [
      "Design",
      "Simulation settings"
    ]
  },
  {
    "objectID": "notebooks/simulation-pars.html#simulation-scenarios",
    "href": "notebooks/simulation-pars.html#simulation-scenarios",
    "title": "Simulation settings",
    "section": "Simulation scenarios",
    "text": "Simulation scenarios\nWe consider a range of simulation settings:\n\nNull scenario - no effect of any randomised treatment in any cell (OR = 1) for all domains and silos\nAll effective - all randomised treatments in all cells effective (OR = 1.5) for all domains and silos\nSingle effective - single cell effective (OR = 1.5) for single domain and silo\nSingle harmful - single cell harmful (OR = 1/1.5) for single domain and silo",
    "crumbs": [
      "Design",
      "Simulation settings"
    ]
  },
  {
    "objectID": "notebooks/adaptations.html#interim-analyses",
    "href": "notebooks/adaptations.html#interim-analyses",
    "title": "Adaptations",
    "section": "Interim analyses",
    "text": "Interim analyses\nInterim analyses start at"
  },
  {
    "objectID": "notebooks/about.html#repository-status",
    "href": "notebooks/about.html#repository-status",
    "title": "About",
    "section": "Repository status",
    "text": "Repository status\nDetails on GitHub repository files, tags, commits follow:\n\n\nCode\nrepo &lt;- git2r::repository(path = \".\")\nsummary(repo)\n\n\nLocal:    main /Users/mark/Documents/project/roadmap/src/roadmap-sim\nRemote:   main @ origin (https://github.com/maj-biostat/roadmap-sim.git)\nHead:     [592de94] 2024-01-17: Fix intro, links and refs\n\nBranches:         2\nTags:             0\nCommits:         26\nContributors:     1\nStashes:          0\nIgnored files:    7\nUntracked files: 12\nUnstaged files:   4\nStaged files:     0\n\nLatest commits:\n[592de94] 2024-01-17: Fix intro, links and refs\n[15ec95d] 2024-01-17: replace stan data with call to roadmap.data pkg\n[f6ad763] 2024-01-17: wip\n[997d807] 2024-01-16: Wip\n[1364d2a] 2024-01-16: Remove redundant",
    "crumbs": [
      "About"
    ]
  },
  {
    "objectID": "notebooks/model-implementation.html",
    "href": "notebooks/model-implementation.html",
    "title": "Model implementation",
    "section": "",
    "text": "The simplest implementation I could think of split the data into silo-specific chunks, mimicking the formulation in the model specification earlier. Nevertheless, the model is cumbersome.\n\n\ndata {\n  // early\n  int N_e;\n  array[N_e] int e_su;\n  array[N_e] int e_y;\n  array[N_e] int e_n;\n  vector[N_e] e_ec; // membership\n  vector[N_e] e_ecp; // non-membership, ie 1 - e_ec\n  array[N_e] int e_c;\n  \n  int N_l;\n  array[N_l] int l_su;\n  array[N_l] int l_y;\n  array[N_l] int l_n;\n  vector[N_l] l_ec;\n  vector[N_l] l_ecp; // 1 - l_ec\n  array[N_l] int l_c;\n  vector[N_l] l_ea;\n  vector[N_l] l_eap;\n  array[N_l] int l_a;\n  vector[N_l] l_eb1;\n  vector[N_l] l_eb2;\n  vector[N_l] l_ebp;\n  array[N_l] int l_b;\n  \n  int N_c;\n  array[N_c] int c_su;\n  array[N_c] int c_y;\n  array[N_c] int c_n;\n  vector[N_c] c_ec;\n  vector[N_c] c_ecp; // 1 - c_ec\n  array[N_c] int c_c;\n  vector[N_c] c_ea;\n  vector[N_c] c_eap;\n  array[N_c] int c_a;\n  vector[N_c] c_eb1;\n  vector[N_c] c_eb2;\n  vector[N_c] c_ebp;\n  array[N_c] int c_b;\n  \n  // priors\n  real pri_sig_b_c;\n  real pri_sig_a_l;\n  real pri_sig_b1_l;\n  real pri_sig_b2_l;\n  real pri_sig_a_c;\n  real pri_sig_b1_c;\n  real pri_sig_b2_c;\n  \n}\ntransformed data {\n  int N = N_e + N_l + N_c;\n}\nparameters {\n  vector[6] alpha;\n  real gamma_b;\n  real gamma_c;\n  real b_a_l_raw;\n  real b_b1_l_raw;\n  real b_b2_l_raw;\n  real b_a_c_raw;\n  real b_b1_c_raw;\n  real b_b2_c_raw;\n  real b_c_raw;\n}\ntransformed parameters{\n  // Include non-randomised items in parameter vector but set to zero \n  // see b_c[3] below. Gives a simpler way to build up model without index\n  // overrun or conditionals for building linear predictor.\n  \n  vector[2] b_a_l; // dair vs revision (late silo)\n  vector[3] b_b1_l; // note length - dair vs revision (late silo, recvd one-stage)\n  vector[3] b_b2_l; // note length - dair vs revision (late silo, recvd two-stage)\n  \n  vector[2] b_a_c; // dair vs revision (chronic silo)\n  vector[2] b_b1_c; // dair vs revision (chronic silo, recvd one-stage)\n  vector[2] b_b2_c; // dair vs revision (chronic silo, recvd two-stage)\n  \n  vector[3] b_c; // note length\n\n  b_a_l[1] = 0.0;\n  b_a_l[2] = b_a_l_raw;\n\n  b_b1_l[1] = 0.0;\n  b_b1_l[2] = b_b1_l_raw;\n  b_b1_l[3] = 0.0;\n   \n  b_b2_l[1] = 0.0;\n  b_b2_l[2] = b_b2_l_raw;\n  b_b2_l[3] = 0.0;\n  \n  b_a_c[1] = 0.0;\n  b_a_c[2] = b_a_c_raw;\n\n  b_b1_c[1] = 0.0;\n  b_b1_c[2] = b_b1_c_raw;\n\n  b_b2_c[1] = 0.0;\n  b_b2_c[2] = b_b2_c_raw;\n   \n  b_c[1] = 0.0;\n  b_c[2] = b_c_raw;\n  // handles other, but this can be ignored in post-processing\n  b_c[3] = 0.0;\n}\nmodel{\n  target += normal_lpdf(alpha | 0, 1.5);\n  \n  target += std_normal_lpdf(gamma_b);\n  target += std_normal_lpdf(gamma_c);\n  // all silos\n  target += normal_lpdf(b_c_raw | 0, pri_sig_b_c);\n  // late silo\n  target += normal_lpdf(b_a_l_raw | 0, pri_sig_a_l);\n  target += normal_lpdf(b_b1_l_raw | 0, pri_sig_b1_l);\n  target += normal_lpdf(b_b2_l_raw | 0, pri_sig_b2_l);\n  // chronic silo\n  target += normal_lpdf(b_a_c_raw | 0, pri_sig_a_c);\n  target += normal_lpdf(b_b1_c_raw | 0, pri_sig_b1_c);\n  target += normal_lpdf(b_b2_c_raw | 0, pri_sig_b2_c);\n  \n  // likelihood chunks pertaining to each silo\n  target += binomial_logit_lpmf(e_y | e_n, alpha[e_su] +\n                                      e_ecp * gamma_c + \n                                      e_ec .* b_c[e_c]) ;      \n                                    \n  target += binomial_logit_lpmf(l_y | l_n, alpha[l_su] + \n                                    l_ebp * gamma_b + \n                                    l_ecp * gamma_c +\n                                    l_ea .* b_a_l[l_a] +\n                                    l_eb1 .* b_b1_l[l_b] +  \n                                    l_eb2 .* b_b2_l[l_b] +\n                                    l_ec .* b_c[l_c]\n                                    ) ;    \n                                    \n  target += binomial_logit_lpmf(c_y | c_n, alpha[c_su] +\n                                      c_ebp * gamma_b + \n                                      c_ecp * gamma_c +\n                                      c_ea .* b_a_c[c_a] +\n                                      c_eb1 .* b_b1_c[c_b] + \n                                      c_eb2 .* b_b2_c[c_b] +\n                                      c_ec .* b_c[c_c]) ; \n}\ngenerated quantities{\n  vector[N_e] eta_e ;\n  vector[N_l] eta_l ;\n  vector[N_c] eta_c ;\n  vector[N] eta;\n  \n  eta_e = alpha[e_su] + e_ecp * gamma_c + e_ec .* b_c[e_c];\n  eta_l = alpha[l_su] + l_ebp * gamma_b + l_ecp * gamma_c +\n    l_ea .* b_a_l[l_a] + \n    l_eb1 .* b_b1_l[l_b] + l_eb2 .* b_b2_l[l_b] +\n    l_ec .* b_c[l_c];\n  eta_c = alpha[c_su] + c_ebp * gamma_b + c_ecp * gamma_c +\n    c_ea .* b_a_c[c_a] +\n    c_eb1 .* b_b1_c[c_b] + c_eb2 .* b_b2_c[c_b] +\n    c_ec .* b_c[c_c];\n    \n  eta = append_row(eta_e, append_row(eta_l, eta_c));\n\n}\n\n\nBelow I create a data set with many more records that we will have available in order to see if we can recover the parameters. I fit the above model and then extract and summarise the posterior.\n\n\nCode\nm2 &lt;- cmdstanr::cmdstan_model(\"stan/model-sim-02.stan\")\n\nset.seed(1)\nll &lt;- get_trial_data(N = 5e4)\nlsd &lt;- get_stan_data(ll$d_i)\nld &lt;- lsd$ld\nd_b &lt;- copy(lsd$d_b)\n\nf2 &lt;- m2$sample(\n  ld, iter_warmup = 1000, iter_sampling = 2000,\n  parallel_chains = 2, chains = 2, refresh = 0, show_exceptions = F, \n  max_treedepth = 13)\n\n\nRunning MCMC with 2 parallel chains...\n\nChain 2 finished in 5.4 seconds.\nChain 1 finished in 5.7 seconds.\n\nBoth chains finished successfully.\nMean chain execution time: 5.5 seconds.\nTotal execution time: 5.7 seconds.\n\n\nCode\npost &lt;- data.table(f2$draws(variables = c(\n  \"eta\"\n), format = \"matrix\"))\n\n# create index field\npost &lt;- melt(post, measure.vars = names(post))\npost[, idx := gsub(\".*\\\\[\", \"\", variable)]\npost[, idx := gsub(\"\\\\]\", \"\", idx)]\npost[, idx := as.integer(idx)]\n\nd_fig &lt;- cbind(d_b, post[, .(eta_med = median(value), \n         eta_q025 = quantile(value, prob = 0.025),\n         eta_q975 = quantile(value, prob = 0.975)), keyby = idx])\n\n\nFigure 1 shows a comparison between the true log-odds of treatment success with the 95% credible interval obtained from the model. It suggests a strong association between the true and estimated log-odds of treatment success for this particular dataset.\n\n\nCode\nggplot(d_fig, aes(x = eta, y = eta_med)) +\n  # geom_point() +\n  geom_linerange(aes(ymin = eta_q025, ymax = eta_q975)) +\n  geom_abline(intercept = 0, slope = 1, lwd = 0.1) +\n  scale_x_continuous(\"True log-odds success\") +\n  scale_y_continuous(\"Posterior log-odds success (95% credible interval)\") +\n  facet_grid(silo ~ joint) +\n  ggtitle(\"True log-odds success vs 95% credible interval\")\n\n\n\n\n\n\n\n\nFigure 1: Scatter plot comparing true vs estimated 95% credible interval for log-odds treatment success.",
    "crumbs": [
      "Design",
      "Model implementation"
    ]
  },
  {
    "objectID": "notebooks/model-spec.html",
    "href": "notebooks/model-spec.html",
    "title": "Model specification",
    "section": "",
    "text": "The primary outcome is treatment success at 12 months post platform entry, defined as all of:\nhereafter referred to as ‘treatment success’.\nFor each silo and site of infectioin we model the probability of treatment success as follows:\nwhere",
    "crumbs": [
      "Design",
      "Model specification"
    ]
  },
  {
    "objectID": "notebooks/model-spec.html#priors",
    "href": "notebooks/model-spec.html#priors",
    "title": "Model specification",
    "section": "Priors",
    "text": "Priors\nAs with the linear predictor, the priors are currently targeted towards the simulation work but may be appropriate for the final model.\n\nIntercepts\nThe silo and infection site specific intercepts are given independent normal priors\n\\[\\begin{aligned}\n\\alpha_{s(i),u(i)} \\sim \\mathcal{N}(0, 1.5^2)\n\\end{aligned}\\]\nOn the probability scale, these concentrate on 0.5 with 95% of the density between 0.04 and 0.96, approximately uniform across this interval.\nWhile the intercept priors are currently independent, consideration should be given to partial pooling across site of infection. However, the concept of exchangeability is perhaps dubious for this set of parameters due to the fact that the baseline log-odds of success must be interpreted based on the domain level options available to each group.\nFor example, there are no randomisation options for early stage infection in domains A and B and therefore the baseline log-odds (intercept) refers to the cohort of patients that were not randomised within A nor B and randomised to the reference group for domain C. In contrast, for the late stage patients, the baseline log-odds of treatment success is interpreted contextually for the cohort of patients that were randomised to the reference level of domains A, B and C, see below.\n\n\nGroups corresponding to baseline log-odds of treatment success\n\n\nSilo\nA\nB\nC\n\n\n\n\nearly\n-\n-\nno-rif\n\n\nlate\ndair\n-\nno-rif\n\n\nchronic\none\n6wk\nno-rif\n\n\n\n\n\n\nDomain non-membership\nThe domain non-membership parameters are given standard normal independent priors. These parameters are pooled across all silos.\n\\[\\begin{aligned}\n\\gamma_\\mathcal{D} \\sim \\mathcal{N}(0, 1)\n\\end{aligned}\\]\n\n\nInterventions\nA hierarchical prior structure may be appropriate for some of the intervention effects dependent on what can be assumed regarding exchangeability.\n\nSurgical domain\nSilo-specific, independent normal priors are assumed for the surgical domain. There is no pooling, we simply compare dair vs revision in the late stage patients and one vs two stage in the chronic stage patients.\n\\[\\begin{aligned}\n\\beta_{A,s,d_{A,j}} \\sim \\mathcal{N}(0, 1)\n\\end{aligned}\\]\nThe reference level is set to 0.\n\n\nAntibiotic duration domain\nWhile a hierarchical structure could be considered for this domain, independent normal priors are currenlty assumed for the duration domain. Currently, there is no pooling. We compare 6 vs 12 weeks for late stage patients having a one stage procedure and 7 days vs 12 wks for those having a two stage procedure. Independently, we compare 6 vs 12 weeks for chronic stage patients having a one stage procedure and 7 days vs 12 wks for those having a two stage procedure.\n\\[\\begin{aligned}\n\\beta_{B_k,s,d_{B,j}} \\sim \\mathcal{N}(0, 1)\n\\end{aligned}\\]\nThe reference level is set to 0.\nTheoretically, partial pooling could be implemented across the late and chronic silos.\n\n\nAntibiotic type domain\nA hierarchical structure could also be considered for this domain. The ‘average’ across silos could be obtained by sampling from the posterior assuming normality based on the parameter for the group variance. With three groups the extent of the partial pooling is going to be heavily influenced by the prior rather than the data.\nCurrently we adopt a standard normal prior for the treatment effects in this domain, which are pooled across silos.\n\\[\\begin{aligned}\n\\beta_{C,d_{C,j}} \\sim \\mathcal{N}(0, 1)\n\\end{aligned}\\]\nThe reference level is set to 0.",
    "crumbs": [
      "Design",
      "Model specification"
    ]
  },
  {
    "objectID": "notebooks/model-spec.html#footnotes",
    "href": "notebooks/model-spec.html#footnotes",
    "title": "Model specification",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nIn practice, it may be the case that non-membership for domain \\(B\\) is relevant. For example, if an early stage patient receives a one or two-stage surgical procedure.↩︎\nAs such, silo-specific decisions on antibiotic type are not possible.↩︎",
    "crumbs": [
      "Design",
      "Model specification"
    ]
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Overview",
    "section": "",
    "text": "This site contains notes, data summaries and simulation results for the ROADMAP study.\nAll the code can be found on github, just use the icon to the top right. The functionality herein has a dependency on the roadmap.data R package, which can also be found via the above link (see the readme for this repo). If you find any issues, let me know and I will prioritise accordingly.",
    "crumbs": [
      "Overview"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html",
    "href": "notebooks/population-structure.html",
    "title": "Population structure",
    "section": "",
    "text": "The following specification is for the partially factorial structure of the study. The outcome model is specified separately.",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#silo",
    "href": "notebooks/population-structure.html#silo",
    "title": "Population structure",
    "section": "Silo",
    "text": "Silo\nThe total sample size is divided across the silos in proportion to the values described in the table below. These proportions are expectations. Each simulated dataset will vary somewhat from these proportions due to the stochastic nature of the generation process.\n\n\nSilo categories (\\(\\pi\\) denotes probability of membership)\n\n\nSilo\n\\(\\pi\\)\n\n\n\n\nearly\n0.3\n\n\nlate\n0.5\n\n\nchronic\n0.2",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#site-of-infection-joint",
    "href": "notebooks/population-structure.html#site-of-infection-joint",
    "title": "Population structure",
    "section": "Site of infection (joint)",
    "text": "Site of infection (joint)\nEach silo comprises patients assumed to have primary infection in either knee or hip (not both). The proportion of infections associated with each joint for each silo are shown below. As previously, these proportions are expectations and the empirical proportions observed in simulated datasets will vary from these.\n\n\nSite of infection (\\(\\pi\\) denotes probability of site infection conditional on silo membership)\n\n\nSilo\nJoint\n\\(\\pi\\)\n\n\n\n\n\nearly\nknee\n0.4\n\n\n\nearly\nhip\n0.6\n\n\n\nlate\nknee\n0.3\n\n\n\nlate\nhip\n0.7\n\n\n\nchronic\nknee\n0.5\n\n\n\nchronic\nhip\n0.5",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#randomisation-into-surgery-domain-a",
    "href": "notebooks/population-structure.html#randomisation-into-surgery-domain-a",
    "title": "Population structure",
    "section": "Randomisation into surgery domain (A)",
    "text": "Randomisation into surgery domain (A)\nRandomisation into domain A is conditional on silo membership as detailed below.\n\n\nRandomisation within domain A\n\n\nSilo\nRandomised (\\(e_a\\))\n\n\n\n\nearly\nN\n\n\nlate\nY\n\n\nchronic\nY",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#surgery-domain-a",
    "href": "notebooks/population-structure.html#surgery-domain-a",
    "title": "Population structure",
    "section": "Surgery domain (A)",
    "text": "Surgery domain (A)\nAllocation probabilities (conditional on entry into domain A) are shown below. Early silo does not receive randomisation and all early stage patients are assumed to receive DAIR.\n\n\nAllocation within domain A (\\(\\pi\\) denotes probability allocation to surgery type conditional on silo membership)\n\n\nSilo\nSurgery type (\\(a\\))\n\\(\\pi\\)\n\n\n\n\n\nearly\ndair\n-\n\n\n\nlate\ndair\n0.5\n\n\n\nlate\nrevision\n0.5\n\n\n\nchronic\none-stage\n0.5\n\n\n\nchronic\ntwo-stage\n0.5",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#intended-surgery",
    "href": "notebooks/population-structure.html#intended-surgery",
    "title": "Population structure",
    "section": "Intended surgery",
    "text": "Intended surgery\nLate stage infections will be randomised to DAIR vs revision where revision would be planned as one or two-stage, determined by the treating clinician, i.e. not randomised. As we do not know the assignment mechanism for one vs two-stage for the late-stage infection patients allocated to revision, we simply assume an equal chance of receiving one vs two stage.\nIn all other cases, the intended surgery is set to allocated surgery.\n\n\nIndended surgical approach (\\(\\pi\\) denotes probability allocation to surgery type conditional on silo membership)\n\n\nSilo\nAllocation (\\(a\\))\nIntended surgery (\\(q\\))\n\\(\\pi\\)\n\n\n\n\n\nearly\ndair\ndair\n-\n\n\n\nlate\ndair\ndair\n-\n\n\n\nlate\nrevision\none-stage\n0.5\n\n\n\nlate\nrevision\ntwo-stage\n0.5\n\n\n\nchronic\none-stage\none-stage\n-\n\n\n\nchronic\ntwo-stage\ntwo-stage\n-",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#randomisation-into-duration-domain-b",
    "href": "notebooks/population-structure.html#randomisation-into-duration-domain-b",
    "title": "Population structure",
    "section": "Randomisation into duration domain (B)",
    "text": "Randomisation into duration domain (B)\nEntry into domain B is dependent on the domain A entry and allocation and is detailed below.\n\n\nRandomisation within domain B\n\n\nIntended surgery (\\(q\\))\nRandomised (\\(e_b\\))\n\n\n\n\n\ndair\nN\n\n\n\nrevision\nY\n\n\n\none-stage\nY\n\n\n\ntwo-stage\nY",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#duration-domain-b",
    "href": "notebooks/population-structure.html#duration-domain-b",
    "title": "Population structure",
    "section": "Duration domain (B)",
    "text": "Duration domain (B)\nThe treatment options and allocation probabilities for domain B are detailed below. Duration of antibiotic is conditional on allocated (intended) surgery type, see above. Patients receiving DAIR are assumed to have 12 wk duration (not randomised).\n\n\nAllocation within duration domain (\\(\\pi\\) denotes probability allocation to surgery type conditional on allocated/intended surgery)\n\n\nAllocation/Intended surgery (\\(q\\))\nAllocation (\\(b\\))\n\\(\\pi\\)\n\n\n\n\ndair\n12 wk\n-\n\n\none-stage\n6 wk\n0.5\n\n\none-stage\n12 wk\n0.5\n\n\ntwo-stage\n7 day post 2\n0.5\n\n\ntwo-stage\n12 wk post 2\n0.5",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#randomisation-into-adjunctive-domain-c",
    "href": "notebooks/population-structure.html#randomisation-into-adjunctive-domain-c",
    "title": "Population structure",
    "section": "Randomisation into adjunctive domain (C)",
    "text": "Randomisation into adjunctive domain (C)\n60% of cohort enter into domain, the rest are flagged as ineligible as detailed below.\n\n\nRandomisation within domain C (\\(\\pi\\) denotes probability patient is indicated as eligible for domain)\n\n\nSilo\nRandomised (\\(e_c\\))\n\\(\\pi\\)\n\n\n\n\nearly\nY\n0.6\n\n\nlate\nY\n0.6\n\n\nchronic\nY\n0.6",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#adjunctive-domain-c",
    "href": "notebooks/population-structure.html#adjunctive-domain-c",
    "title": "Population structure",
    "section": "Adjunctive domain (C)",
    "text": "Adjunctive domain (C)\nThe treatment options and allocation probabilities for domain C are detailed below.\n\n\nAllocation within adjunctive domain (\\(\\pi\\) denotes probability that an eligible patient is allocated to no rif vs rif)\n\n\nAllocation (\\(c\\))\n\\(\\pi\\)\n\n\n\n\nno rif\n0.5\n\n\nrif\n0.5",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/population-structure.html#encoded-specification",
    "href": "notebooks/population-structure.html#encoded-specification",
    "title": "Population structure",
    "section": "Encoded specification",
    "text": "Encoded specification\nThe above specification is bundled into an R package (roadmap.data) for consistent data generation for ROADMAP.\n\n\nCode\nroadmap.data::get_pop_spec()\n\n\n$r_silo\n      silo   p\n1:   early 0.3\n2:    late 0.5\n3: chronic 0.2\n\n$r_joint\n      silo joint   p\n1:   early  knee 0.4\n2:   early   hip 0.6\n3:    late  knee 0.3\n4:    late   hip 0.7\n5: chronic  knee 0.5\n6: chronic   hip 0.5\n\n$r_ea\n      silo rand\n1:   early    N\n2:    late    Y\n3: chronic    Y\n\n$r_a\n      silo    a   p\n1:   early dair  NA\n2:    late dair 0.5\n3:    late  rev 0.5\n4: chronic  one 0.5\n5: chronic  two 0.5\n\n$r_a_q\n      silo    a   qa   p\n1:   early dair dair  NA\n2:    late dair dair  NA\n3:    late  rev  one 0.5\n4:    late  rev  two 0.5\n5: chronic  one  one  NA\n6: chronic  two  two  NA\n\n$r_eb\n     qa rand\n1: dair    N\n2:  rev    Y\n3:  one    Y\n4:  two    Y\n\n$r_b\n     qa     b   p\n1: dair   w12 1.0\n2:  one w06p1 0.5\n3:  one w12p1 0.5\n4:  two d07p2 0.5\n5:  two w12p2 0.5\n\n$r_ec\n      silo rand   p\n1:   early    Y 0.6\n2:    late    Y 0.6\n3: chronic    Y 0.6\n\n$r_c\n       c   p\n1: norif 0.5\n2:   rif 0.5\n\n\nThe following function simulates the design matrix.\n\n\nCode\nroadmap.data::get_design\n\n\nfunction(N = 100000, pop_spec = NULL){\n\n  if(is.null(pop_spec)){\n    pop_spec &lt;- get_pop_spec()\n  }\n\n  d &lt;- data.table()\n  # pt id\n  d[, id := 1:N]\n  d[, silo := sample(pop_spec$r_silo$silo, size = N, replace = T, prob = pop_spec$r_silo$p)]\n  setkey(d, silo)\n  setkey(pop_spec$r_joint, silo)\n  setkey(pop_spec$r_ea, silo)\n  for(z in pop_spec$r_silo$silo){\n    d[z, joint :=\n        sample(pop_spec$r_joint[z, joint], size = .N, replace = T, prob = pop_spec$r_joint[z, p])\n    ]\n\n    # might as well set ea (eligibility for domain a)\n    d[z, ea := pop_spec$r_ea[z, rand]]\n  }\n\n  # Surgery domain (A)\n  setkey(pop_spec$r_a, silo)\n  d[\"early\", a := \"dair\"]\n  z &lt;- \"late\"\n  d[z, a := sample(pop_spec$r_a[z, a], size = .N, replace = T, prob = pop_spec$r_a[z, p])]\n  z &lt;- \"chronic\"\n  d[z, a := sample(pop_spec$r_a[z, a], size = .N, replace = T, prob = pop_spec$r_a[z, p])]\n\n  # introduce the intended surgical approach (for late stage allocated to revision)\n  setkey(d, silo, a)\n  setkey(pop_spec$r_a_q, silo, a)\n  d[.(\"late\", \"rev\"), qa :=\n      sample(pop_spec$r_a_q[.(\"late\", \"rev\"), qa], size = .N, replace = T, prob = pop_spec$r_a_q[.(\"late\", \"rev\"), p])]\n  d[is.na(qa), qa := copy(a)]\n\n  # Duration domain (B)\n  # eligibility based on a\n  d &lt;- merge(d, pop_spec$r_eb[, .(qa, eb = rand)], by = c(\"qa\"), all.x = T)\n  setcolorder(d, c(\"id\", \"silo\", \"joint\", \"ea\", \"a\", \"qa\",\"eb\"))\n  setkey(d, id)\n\n  setkey(d, qa)\n  setkey(pop_spec$r_b, qa)\n  # all dair get 12wk\n  d[\"dair\", b := pop_spec$r_b[\"dair\", unique(b)]]\n\n  setkey(d, qa)\n  setkey(pop_spec$r_b, qa)\n\n  z &lt;- \"one\"\n  d[z, b := sample(pop_spec$r_b[z, b], size = .N, replace = T, prob = pop_spec$r_b[z, p])]\n  z &lt;- \"two\"\n  d[z, b := sample(pop_spec$r_b[z, b], size = .N, replace = T, prob = pop_spec$r_b[z, p])]\n  setkey(d, id)\n\n  # Antibiotic type domain (C)\n\n  # Here I make eligibility random to reflect that some of our cohort will not\n  # enter into this domain, irrespective of their randomisation in other domains.\n  # Each silo is allowed to have a different proportion of pts entering into\n  # domain C.\n  setkey(d, silo)\n  setkey(pop_spec$r_ec, silo)\n\n  for(z in pop_spec$r_ec$silo){\n    d[z, ec :=\n        sample(c(\"Y\",\"N\"), size = .N, replace = T, prob = c(pop_spec$r_ec[z, p], 1- pop_spec$r_ec[z, p]))\n    ]\n  }\n\n  d[ec == \"Y\",\n    c := sample(pop_spec$r_c[, c], size = .N, replace = T, prob = pop_spec$r_c[, p])]\n  d[ec == \"N\", c := \"other\"]\n\n  setkey(d, id)\n\n  d\n}\n&lt;bytecode: 0x116a1e0e0&gt;\n&lt;environment: namespace:roadmap.data&gt;\n\n\nThe data generation assumptions imply unique patients groups on which we would observe the outcome. The outcome is known to be heterogenous across these groups and yet the stated goal is to aggregate measures of effect (odds ratios) across all these groups, e.g. no rif vs rif. However, the effect of interest is assumed to be obtained from the model parameter that characterises the effect of antibiotic type conditional on the other covariates in the model.\n\n\nCode\nd &lt;- roadmap.data::get_design()\nunique(d[order(silo, joint, ea, a, qa, eb, b, ec, c), .SD, .SDcols = !c(\"id\")])\n\n\n       silo joint ea    a   qa eb     b ec     c\n 1: chronic   hip  Y  one  one  Y w06p1  N other\n 2: chronic   hip  Y  one  one  Y w06p1  Y norif\n 3: chronic   hip  Y  one  one  Y w06p1  Y   rif\n 4: chronic   hip  Y  one  one  Y w12p1  N other\n 5: chronic   hip  Y  one  one  Y w12p1  Y norif\n 6: chronic   hip  Y  one  one  Y w12p1  Y   rif\n 7: chronic   hip  Y  two  two  Y d07p2  N other\n 8: chronic   hip  Y  two  two  Y d07p2  Y norif\n 9: chronic   hip  Y  two  two  Y d07p2  Y   rif\n10: chronic   hip  Y  two  two  Y w12p2  N other\n11: chronic   hip  Y  two  two  Y w12p2  Y norif\n12: chronic   hip  Y  two  two  Y w12p2  Y   rif\n13: chronic  knee  Y  one  one  Y w06p1  N other\n14: chronic  knee  Y  one  one  Y w06p1  Y norif\n15: chronic  knee  Y  one  one  Y w06p1  Y   rif\n16: chronic  knee  Y  one  one  Y w12p1  N other\n17: chronic  knee  Y  one  one  Y w12p1  Y norif\n18: chronic  knee  Y  one  one  Y w12p1  Y   rif\n19: chronic  knee  Y  two  two  Y d07p2  N other\n20: chronic  knee  Y  two  two  Y d07p2  Y norif\n21: chronic  knee  Y  two  two  Y d07p2  Y   rif\n22: chronic  knee  Y  two  two  Y w12p2  N other\n23: chronic  knee  Y  two  two  Y w12p2  Y norif\n24: chronic  knee  Y  two  two  Y w12p2  Y   rif\n25:   early   hip  N dair dair  N   w12  N other\n26:   early   hip  N dair dair  N   w12  Y norif\n27:   early   hip  N dair dair  N   w12  Y   rif\n28:   early  knee  N dair dair  N   w12  N other\n29:   early  knee  N dair dair  N   w12  Y norif\n30:   early  knee  N dair dair  N   w12  Y   rif\n31:    late   hip  Y dair dair  N   w12  N other\n32:    late   hip  Y dair dair  N   w12  Y norif\n33:    late   hip  Y dair dair  N   w12  Y   rif\n34:    late   hip  Y  rev  one  Y w06p1  N other\n35:    late   hip  Y  rev  one  Y w06p1  Y norif\n36:    late   hip  Y  rev  one  Y w06p1  Y   rif\n37:    late   hip  Y  rev  one  Y w12p1  N other\n38:    late   hip  Y  rev  one  Y w12p1  Y norif\n39:    late   hip  Y  rev  one  Y w12p1  Y   rif\n40:    late   hip  Y  rev  two  Y d07p2  N other\n41:    late   hip  Y  rev  two  Y d07p2  Y norif\n42:    late   hip  Y  rev  two  Y d07p2  Y   rif\n43:    late   hip  Y  rev  two  Y w12p2  N other\n44:    late   hip  Y  rev  two  Y w12p2  Y norif\n45:    late   hip  Y  rev  two  Y w12p2  Y   rif\n46:    late  knee  Y dair dair  N   w12  N other\n47:    late  knee  Y dair dair  N   w12  Y norif\n48:    late  knee  Y dair dair  N   w12  Y   rif\n49:    late  knee  Y  rev  one  Y w06p1  N other\n50:    late  knee  Y  rev  one  Y w06p1  Y norif\n51:    late  knee  Y  rev  one  Y w06p1  Y   rif\n52:    late  knee  Y  rev  one  Y w12p1  N other\n53:    late  knee  Y  rev  one  Y w12p1  Y norif\n54:    late  knee  Y  rev  one  Y w12p1  Y   rif\n55:    late  knee  Y  rev  two  Y d07p2  N other\n56:    late  knee  Y  rev  two  Y d07p2  Y norif\n57:    late  knee  Y  rev  two  Y d07p2  Y   rif\n58:    late  knee  Y  rev  two  Y w12p2  N other\n59:    late  knee  Y  rev  two  Y w12p2  Y norif\n60:    late  knee  Y  rev  two  Y w12p2  Y   rif\n       silo joint ea    a   qa eb     b ec     c",
    "crumbs": [
      "Design",
      "Population structure"
    ]
  },
  {
    "objectID": "notebooks/example-trials.html",
    "href": "notebooks/example-trials.html",
    "title": "Example trials",
    "section": "",
    "text": "Example trials are provided to give insight into the cell sizes as well as the level of uncertainty associated with the parameter estimation process. Examples are from trials at their maximum sample size with all follow up completed. Sequential variants with adaptations will be added later.",
    "crumbs": [
      "Design",
      "Example trials"
    ]
  },
  {
    "objectID": "notebooks/example-trials.html#null-trial",
    "href": "notebooks/example-trials.html#null-trial",
    "title": "Example trials",
    "section": "Null trial",
    "text": "Null trial\nTable 1 shows a summary of the treatment sucesses based on the \\(n\\) patients associated with each combination of design variables when no treatment effects (non-membership effects still retained) in the simulated data of 2500 patients. Given that this is a summary of a single data set, some variation from the underlying simulation parameters is to be expected.\n\n\nCode\nsim_spec &lt;- get_sim_spec()\nsim_spec$b_a_late[\"rev\"] &lt;- 0\nsim_spec$b_a_chronic[\"two\"] &lt;- 0\nsim_spec$b_b1_late_one[\"w12p1\"] &lt;- 0\nsim_spec$b_b2_late_two[\"w12p2\"] &lt;- 0\nsim_spec$b_b1_chronic_one[\"w12p1\"] &lt;- 0\nsim_spec$b_b2_chronic_two[\"w12p2\"] &lt;- 0\nsim_spec$b_c[\"rif\"] &lt;- 0\n\nset.seed(15)\nll &lt;- get_trial_data(N = 2500, pop_spec = NULL, sim_spec = sim_spec)\n\ngt_tbl &lt;- tbl_ex_trial(ll$d)\ngt_tbl\n\n\n\n\n\n\n\n\n\n\n\n\nSurgical Da\nDuration Db\nType Dc\nResponse\n\n\nmember\nassigned\nplan\nmember\nassigned1\nmember\nassigned\ny\nn\nMLE (py)\nTRUE (py)2\n\n\n\n\nchronic - hip\n\n\n\nY\none\none\nY\nw06p1\nN\nother\n14\n26\n0.54\n0.64\n\n\n\nY\none\none\nY\nw06p1\nY\nnorif\n12\n19\n0.63\n0.65\n\n\n\nY\none\none\nY\nw06p1\nY\nrif\n16\n21\n0.76\n0.65\n\n\n\nY\none\none\nY\nw12p1\nN\nother\n13\n20\n0.65\n0.64\n\n\n\nY\none\none\nY\nw12p1\nY\nnorif\n17\n29\n0.59\n0.65\n\n\n\nY\none\none\nY\nw12p1\nY\nrif\n14\n18\n0.78\n0.65\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nN\nother\n15\n25\n0.60\n0.64\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nY\nnorif\n14\n21\n0.67\n0.65\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nY\nrif\n10\n16\n0.62\n0.65\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nN\nother\n17\n26\n0.65\n0.64\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nY\nnorif\n15\n29\n0.52\n0.65\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nY\nrif\n7\n16\n0.44\n0.65\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n164\n266\n0.62\n—\n\n\nchronic - knee\n\n\n\nY\none\none\nY\nw06p1\nN\nother\n14\n23\n0.61\n0.59\n\n\n\nY\none\none\nY\nw06p1\nY\nnorif\n14\n26\n0.54\n0.60\n\n\n\nY\none\none\nY\nw06p1\nY\nrif\n16\n26\n0.62\n0.60\n\n\n\nY\none\none\nY\nw12p1\nN\nother\n16\n24\n0.67\n0.59\n\n\n\nY\none\none\nY\nw12p1\nY\nnorif\n12\n21\n0.57\n0.60\n\n\n\nY\none\none\nY\nw12p1\nY\nrif\n11\n16\n0.69\n0.60\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nN\nother\n16\n30\n0.53\n0.59\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nY\nnorif\n11\n24\n0.46\n0.60\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nY\nrif\n12\n23\n0.52\n0.60\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nN\nother\n20\n32\n0.62\n0.59\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nY\nnorif\n7\n13\n0.54\n0.60\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nY\nrif\n10\n24\n0.42\n0.60\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n159\n282\n0.56\n—\n\n\nearly - hip\n\n\n\nN\ndair\ndair\nN\nw12\nN\nother\n147\n199\n0.74\n0.73\n\n\n\nN\ndair\ndair\nN\nw12\nY\nnorif\n108\n137\n0.79\n0.75\n\n\n\nN\ndair\ndair\nN\nw12\nY\nrif\n85\n123\n0.69\n0.75\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n340\n459\n0.74\n—\n\n\nearly - knee\n\n\n\nN\ndair\ndair\nN\nw12\nN\nother\n77\n122\n0.63\n0.63\n\n\n\nN\ndair\ndair\nN\nw12\nY\nnorif\n62\n93\n0.67\n0.65\n\n\n\nN\ndair\ndair\nN\nw12\nY\nrif\n60\n93\n0.65\n0.65\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n199\n308\n0.65\n—\n\n\nlate - hip\n\n\n\nY\ndair\ndair\nN\nw12\nN\nother\n88\n170\n0.52\n0.56\n\n\n\nY\ndair\ndair\nN\nw12\nY\nnorif\n74\n120\n0.62\n0.57\n\n\n\nY\ndair\ndair\nN\nw12\nY\nrif\n78\n127\n0.61\n0.57\n\n\n\nY\nrev\none\nY\nw06p1\nN\nother\n26\n40\n0.65\n0.59\n\n\n\nY\nrev\none\nY\nw06p1\nY\nnorif\n18\n36\n0.50\n0.60\n\n\n\nY\nrev\none\nY\nw06p1\nY\nrif\n19\n33\n0.58\n0.60\n\n\n\nY\nrev\none\nY\nw12p1\nN\nother\n33\n49\n0.67\n0.59\n\n\n\nY\nrev\none\nY\nw12p1\nY\nnorif\n11\n18\n0.61\n0.60\n\n\n\nY\nrev\none\nY\nw12p1\nY\nrif\n13\n28\n0.46\n0.60\n\n\n\nY\nrev\ntwo\nY\nd07p2\nN\nother\n25\n41\n0.61\n0.59\n\n\n\nY\nrev\ntwo\nY\nd07p2\nY\nnorif\n16\n33\n0.48\n0.60\n\n\n\nY\nrev\ntwo\nY\nd07p2\nY\nrif\n22\n30\n0.73\n0.60\n\n\n\nY\nrev\ntwo\nY\nw12p2\nN\nother\n24\n40\n0.60\n0.59\n\n\n\nY\nrev\ntwo\nY\nw12p2\nY\nnorif\n19\n29\n0.66\n0.60\n\n\n\nY\nrev\ntwo\nY\nw12p2\nY\nrif\n21\n33\n0.64\n0.60\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n487\n827\n0.59\n—\n\n\nlate - knee\n\n\n\nY\ndair\ndair\nN\nw12\nN\nother\n29\n58\n0.50\n0.51\n\n\n\nY\ndair\ndair\nN\nw12\nY\nnorif\n25\n55\n0.45\n0.52\n\n\n\nY\ndair\ndair\nN\nw12\nY\nrif\n30\n47\n0.64\n0.52\n\n\n\nY\nrev\none\nY\nw06p1\nN\nother\n12\n26\n0.46\n0.54\n\n\n\nY\nrev\none\nY\nw06p1\nY\nnorif\n8\n13\n0.62\n0.55\n\n\n\nY\nrev\none\nY\nw06p1\nY\nrif\n7\n12\n0.58\n0.55\n\n\n\nY\nrev\none\nY\nw12p1\nN\nother\n12\n24\n0.50\n0.54\n\n\n\nY\nrev\none\nY\nw12p1\nY\nnorif\n5\n11\n0.45\n0.55\n\n\n\nY\nrev\none\nY\nw12p1\nY\nrif\n8\n17\n0.47\n0.55\n\n\n\nY\nrev\ntwo\nY\nd07p2\nN\nother\n17\n30\n0.57\n0.54\n\n\n\nY\nrev\ntwo\nY\nd07p2\nY\nnorif\n4\n12\n0.33\n0.55\n\n\n\nY\nrev\ntwo\nY\nd07p2\nY\nrif\n9\n13\n0.69\n0.55\n\n\n\nY\nrev\ntwo\nY\nw12p2\nN\nother\n11\n18\n0.61\n0.54\n\n\n\nY\nrev\ntwo\nY\nw12p2\nY\nnorif\n8\n9\n0.89\n0.55\n\n\n\nY\nrev\ntwo\nY\nw12p2\nY\nrif\n6\n13\n0.46\n0.55\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n191\n358\n0.53\n—\n\n\ntotal\n—\n—\n—\n—\n—\n—\n—\n1540\n2500\n0.62\n—\n\n\n\n1 w06p1 = 6 weeks following one-stage procedure, w12p1 = 12 weeks following one-stage procedure etc\n\n\n2 Transformed from the log-odds of response as used in the linear predictor to simulate data.\n\n\n\n\n\n\n\n\n\nTable 1: Summary of simulated trial data when no treatment effects present\n\n\n\n\nModel the simulated data first using standard normal priors on the domain level treatment effects, then increasing the prior standard deviation to ten in order to see if there is any movement in the posterior summary.\n\n\nCode\nlsd &lt;- get_stan_data(ll$d_i)\nld &lt;- lsd$ld\nd_b &lt;- copy(lsd$d_b)\n\nm2 &lt;- cmdstanr::cmdstan_model(\"stan/model-sim-02.stan\")\n\nf_null_1 &lt;- m2$sample(\n  ld, iter_warmup = 1000, iter_sampling = 2000,\n  parallel_chains = 2, chains = 2, refresh = 0, show_exceptions = F, \n  max_treedepth = 13)\n\n\nRunning MCMC with 2 parallel chains...\n\nChain 2 finished in 1.4 seconds.\nChain 1 finished in 1.6 seconds.\n\nBoth chains finished successfully.\nMean chain execution time: 1.5 seconds.\nTotal execution time: 1.6 seconds.\n\n\nCode\npost_1 &lt;- data.table(f_null_1$draws(variables = c(\n  \"alpha\", \"gamma_b\", \"gamma_c\", \n  \"b_a_l\", \n  \"b_b1_l\", \n  \"b_b2_l\",\n  \"b_a_c\",\n  \"b_b1_c\", \n  \"b_b2_c\",\n  \"b_c\"\n), format = \"matrix\"))\n\n# compare when prior sd is set to 10 for trt effects\n\npri_sd &lt;- 10\nld$pri_sig_b_c &lt;- pri_sd\nld$pri_sig_a_l &lt;- pri_sd\nld$pri_sig_b1_l &lt;- pri_sd\nld$pri_sig_b2_l &lt;- pri_sd\nld$pri_sig_a_c &lt;- pri_sd\nld$pri_sig_b1_c &lt;- pri_sd\nld$pri_sig_b2_c &lt;- pri_sd\n\nf_null_2 &lt;- m2$sample(\n  ld, iter_warmup = 1000, iter_sampling = 2000,\n  parallel_chains = 2, chains = 2, refresh = 0, show_exceptions = F, \n  max_treedepth = 13)\n\n\nRunning MCMC with 2 parallel chains...\n\nChain 2 finished in 1.8 seconds.\nChain 1 finished in 1.9 seconds.\n\nBoth chains finished successfully.\nMean chain execution time: 1.9 seconds.\nTotal execution time: 2.0 seconds.\n\n\nCode\npost_2 &lt;- data.table(f_null_2$draws(variables = c(\n  \"alpha\", \"gamma_b\", \"gamma_c\", \n  \"b_a_l\", \n  \"b_b1_l\", \n  \"b_b2_l\",\n  \"b_a_c\",\n  \"b_b1_c\", \n  \"b_b2_c\",\n  \"b_c\"\n), format = \"matrix\"))\n\n\n\n\nCode\nd_fig1 &lt;- post_alpha(post_1)\nd_fig2 &lt;- post_alpha(post_2)\n\nd_fig &lt;- rbind(\n  cbind(prior_sd = 1, d_fig1),\n  cbind(prior_sd = pri_sd, d_fig2)\n)\nd_fig[, prior_sd := factor(prior_sd, levels = c(1, pri_sd))]\n\nggplot(d_fig, aes(x = grp, y = a, group = prior_sd, col = prior_sd)) +\n  scale_x_discrete(\"\") +\n  scale_y_continuous(\"log-odds treatment success\") + \n  scale_color_discrete(\"Prior sd on log-OR domain trt effects\") +\n  geom_point(data = d_fig, aes(x = grp, y = a_med), position = position_dodge(width = 0.4)) +\n  geom_linerange(aes(ymin = a_q025, ymax = a_q975), position = position_dodge2(width = 0.4)) +\n  geom_point(data = d_fig, aes(x = grp, y = a), col = 1, pch = 2)\n\n\n\n\n\n\n\n\nFigure 1: Posterior median and 95% CI for baseline log-odds of treatment success (triangles show true values).\n\n\n\n\n\n\n\nCode\nd_fig1 &lt;- post_dom_a(post_1)\nd_fig2 &lt;- post_dom_a(post_2)\n\nd_fig &lt;- rbind(\n  cbind(prior_sd = 1, d_fig1),\n  cbind(prior_sd = pri_sd, d_fig2)\n)\nd_fig[, prior_sd := factor(prior_sd, levels = c(1, pri_sd))]\n\n# https://www.andrewheiss.com/blog/2022/12/08/log10-natural-log-scales-ggplot/\n\nggplot(d_fig, aes(x = trt, y = b, col = prior_sd)) +\n  scale_x_discrete(\"\") +\n  scale_y_continuous(\"log-OR\") + \n  scale_color_discrete(\"Prior sd on log-OR domain trt effects\") +\n  geom_point(data = d_fig, aes(x = trt, y = b_med), position = position_dodge(width = 0.4)) +\n  geom_linerange(aes(ymin = b_q025, ymax = b_q975), position = position_dodge2(width = 0.4)) +\n  geom_point(data = d_fig, aes(x = trt, y = b), col = 1, pch = 2) +\n  facet_grid(~silo,scale=\"free_x\",space=\"free_x\")\n\n\n\n\n\n\n\n\nFigure 2: Posterior median and 95% CI for baseline log-odds of treatment success domain A (independent estimates for late and chronic silo).\n\n\n\n\n\n\n\nCode\nd_fig1 &lt;- post_dom_b(post_1)\nd_fig2 &lt;- post_dom_b(post_2)\n\nd_fig &lt;- rbind(\n  cbind(prior_sd = 1, d_fig1),\n  cbind(prior_sd = pri_sd, d_fig2)\n)\nd_fig[, prior_sd := factor(prior_sd, levels = c(1, pri_sd))]\n\n# https://www.andrewheiss.com/blog/2022/12/08/log10-natural-log-scales-ggplot/\n\nggplot(d_fig, aes(x = trt, y = b, col = prior_sd)) +\n  scale_x_discrete(\"\") +\n  scale_y_continuous(\"log-OR\") + \n  scale_color_discrete(\"Prior sd on log-OR domain trt effects\") +\n  geom_point(data = d_fig, aes(x = trt, y = b_med), position = position_dodge(width = 0.4)) +\n  geom_linerange(aes(ymin = b_q025, ymax = b_q975), position = position_dodge2(width = 0.4)) +\n  geom_point(data = d_fig, aes(x = trt, y = b), col = 1, pch = 2) +\n  facet_grid(paste0(\"Planned/assigned surgery: \", qa, \"-stage\")~silo,scale=\"free_x\",space=\"free_x\")\n\n\n\n\n\n\n\n\nFigure 3: Posterior median and 95% CI for baseline log-odds of treatment success domain B (independent estimates for late and chronic silo).\n\n\n\n\n\n\n\nCode\nd_fig1 &lt;- post_dom_c(post_1)\nd_fig2 &lt;- post_dom_c(post_2)\n\nd_fig &lt;- rbind(\n  cbind(prior_sd = 1, d_fig1),\n  cbind(prior_sd = pri_sd, d_fig2)\n)\nd_fig[, prior_sd := factor(prior_sd, levels = c(1, pri_sd))]\n\nggplot(d_fig, aes(x = trt, y = b, col = prior_sd)) +\n  scale_x_discrete(\"\") +\n  scale_y_continuous(\"log-OR\") + \n  scale_color_discrete(\"Prior sd on log-OR domain trt effects\") +\n  geom_point(data = d_fig, aes(x = trt, y = b_med), position = position_dodge(width = 0.4)) +\n  geom_linerange(aes(ymin = b_q025, ymax = b_q975), position = position_dodge2(width = 0.4)) +\n  geom_point(data = d_fig, aes(x = trt, y = b), col = 1, pch = 2)\n\n\n\n\n\n\n\n\nFigure 4: Posterior median and 95% CI for baseline log-odds of treatment success in domain C (effect is pooled across all silos).",
    "crumbs": [
      "Design",
      "Example trials"
    ]
  },
  {
    "objectID": "notebooks/example-trials.html#all-domains-effective",
    "href": "notebooks/example-trials.html#all-domains-effective",
    "title": "Example trials",
    "section": "All domains effective",
    "text": "All domains effective\nshows a summary of the treatment sucesses based on the \\(n\\) patients associated with each combination of design variables when all treatment effects set to log(2) (with non-membership effects retained as before) in the simulated data of 2500 patients.\n\n\nCode\nsim_spec &lt;- get_sim_spec()\nsim_spec$b_a_late[\"rev\"] &lt;- log(2)\nsim_spec$b_a_chronic[\"two\"] &lt;- log(2)\nsim_spec$b_b1_late_one[\"w12p1\"] &lt;- log(2)\nsim_spec$b_b2_late_two[\"w12p2\"] &lt;- log(2)\nsim_spec$b_b1_chronic_one[\"w12p1\"] &lt;- log(2)\nsim_spec$b_b2_chronic_two[\"w12p2\"] &lt;- log(2)\nsim_spec$b_c[\"rif\"] &lt;- log(2)\n\nset.seed(222)\nll &lt;- get_trial_data(N = 2500, pop_spec = NULL, sim_spec = sim_spec)\n\n# just wrapped table generation up into a function to save space and min repitition, see util.R\ngt_tbl &lt;- tbl_ex_trial(ll$d)\ngt_tbl\n\n\n\n\n\n\n\n\n\n\n\n\nSurgical Da\nDuration Db\nType Dc\nResponse\n\n\nmember\nassigned\nplan\nmember\nassigned1\nmember\nassigned\ny\nn\nMLE (py)\nTRUE (py)2\n\n\n\n\nchronic - hip\n\n\n\nY\none\none\nY\nw06p1\nN\nother\n13\n18\n0.72\n0.64\n\n\n\nY\none\none\nY\nw06p1\nY\nnorif\n12\n15\n0.80\n0.65\n\n\n\nY\none\none\nY\nw06p1\nY\nrif\n16\n21\n0.76\n0.79\n\n\n\nY\none\none\nY\nw12p1\nN\nother\n27\n31\n0.87\n0.78\n\n\n\nY\none\none\nY\nw12p1\nY\nnorif\n11\n17\n0.65\n0.79\n\n\n\nY\none\none\nY\nw12p1\nY\nrif\n16\n21\n0.76\n0.88\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nN\nother\n24\n28\n0.86\n0.78\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nY\nnorif\n19\n30\n0.63\n0.79\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nY\nrif\n14\n16\n0.88\n0.88\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nN\nother\n25\n29\n0.86\n0.88\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nY\nnorif\n21\n22\n0.95\n0.88\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nY\nrif\n13\n13\n1.00\n0.94\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n211\n261\n0.81\n—\n\n\nchronic - knee\n\n\n\nY\none\none\nY\nw06p1\nN\nother\n13\n21\n0.62\n0.59\n\n\n\nY\none\none\nY\nw06p1\nY\nnorif\n12\n18\n0.67\n0.60\n\n\n\nY\none\none\nY\nw06p1\nY\nrif\n16\n19\n0.84\n0.75\n\n\n\nY\none\none\nY\nw12p1\nN\nother\n18\n26\n0.69\n0.74\n\n\n\nY\none\none\nY\nw12p1\nY\nnorif\n8\n12\n0.67\n0.75\n\n\n\nY\none\none\nY\nw12p1\nY\nrif\n12\n14\n0.86\n0.86\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nN\nother\n11\n16\n0.69\n0.74\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nY\nnorif\n18\n22\n0.82\n0.75\n\n\n\nY\ntwo\ntwo\nY\nd07p2\nY\nrif\n13\n14\n0.93\n0.86\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nN\nother\n26\n31\n0.84\n0.85\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nY\nnorif\n9\n13\n0.69\n0.86\n\n\n\nY\ntwo\ntwo\nY\nw12p2\nY\nrif\n12\n12\n1.00\n0.92\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n168\n218\n0.77\n—\n\n\nearly - hip\n\n\n\nN\ndair\ndair\nN\nw12\nN\nother\n147\n189\n0.78\n0.73\n\n\n\nN\ndair\ndair\nN\nw12\nY\nnorif\n112\n144\n0.78\n0.75\n\n\n\nN\ndair\ndair\nN\nw12\nY\nrif\n117\n135\n0.87\n0.86\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n376\n468\n0.80\n—\n\n\nearly - knee\n\n\n\nN\ndair\ndair\nN\nw12\nN\nother\n99\n137\n0.72\n0.63\n\n\n\nN\ndair\ndair\nN\nw12\nY\nnorif\n73\n103\n0.71\n0.65\n\n\n\nN\ndair\ndair\nN\nw12\nY\nrif\n68\n81\n0.84\n0.79\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n240\n321\n0.75\n—\n\n\nlate - hip\n\n\n\nY\ndair\ndair\nN\nw12\nN\nother\n81\n154\n0.53\n0.56\n\n\n\nY\ndair\ndair\nN\nw12\nY\nnorif\n64\n114\n0.56\n0.57\n\n\n\nY\ndair\ndair\nN\nw12\nY\nrif\n91\n124\n0.73\n0.73\n\n\n\nY\nrev\none\nY\nw06p1\nN\nother\n32\n48\n0.67\n0.74\n\n\n\nY\nrev\none\nY\nw06p1\nY\nnorif\n37\n56\n0.66\n0.75\n\n\n\nY\nrev\none\nY\nw06p1\nY\nrif\n33\n36\n0.92\n0.86\n\n\n\nY\nrev\none\nY\nw12p1\nN\nother\n41\n43\n0.95\n0.85\n\n\n\nY\nrev\none\nY\nw12p1\nY\nnorif\n28\n32\n0.88\n0.86\n\n\n\nY\nrev\none\nY\nw12p1\nY\nrif\n29\n31\n0.94\n0.92\n\n\n\nY\nrev\ntwo\nY\nd07p2\nN\nother\n27\n42\n0.64\n0.74\n\n\n\nY\nrev\ntwo\nY\nd07p2\nY\nnorif\n17\n26\n0.65\n0.75\n\n\n\nY\nrev\ntwo\nY\nd07p2\nY\nrif\n26\n30\n0.87\n0.86\n\n\n\nY\nrev\ntwo\nY\nw12p2\nN\nother\n42\n46\n0.91\n0.85\n\n\n\nY\nrev\ntwo\nY\nw12p2\nY\nnorif\n40\n43\n0.93\n0.86\n\n\n\nY\nrev\ntwo\nY\nw12p2\nY\nrif\n40\n42\n0.95\n0.92\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n628\n867\n0.72\n—\n\n\nlate - knee\n\n\n\nY\ndair\ndair\nN\nw12\nN\nother\n47\n80\n0.59\n0.51\n\n\n\nY\ndair\ndair\nN\nw12\nY\nnorif\n19\n48\n0.40\n0.52\n\n\n\nY\ndair\ndair\nN\nw12\nY\nrif\n37\n51\n0.73\n0.69\n\n\n\nY\nrev\none\nY\nw06p1\nN\nother\n12\n17\n0.71\n0.70\n\n\n\nY\nrev\none\nY\nw06p1\nY\nnorif\n12\n18\n0.67\n0.71\n\n\n\nY\nrev\none\nY\nw06p1\nY\nrif\n11\n12\n0.92\n0.83\n\n\n\nY\nrev\none\nY\nw12p1\nN\nother\n14\n19\n0.74\n0.82\n\n\n\nY\nrev\none\nY\nw12p1\nY\nnorif\n10\n13\n0.77\n0.83\n\n\n\nY\nrev\none\nY\nw12p1\nY\nrif\n16\n17\n0.94\n0.91\n\n\n\nY\nrev\ntwo\nY\nd07p2\nN\nother\n8\n14\n0.57\n0.70\n\n\n\nY\nrev\ntwo\nY\nd07p2\nY\nnorif\n8\n12\n0.67\n0.71\n\n\n\nY\nrev\ntwo\nY\nd07p2\nY\nrif\n15\n16\n0.94\n0.83\n\n\n\nY\nrev\ntwo\nY\nw12p2\nN\nother\n19\n23\n0.83\n0.82\n\n\n\nY\nrev\ntwo\nY\nw12p2\nY\nnorif\n12\n12\n1.00\n0.83\n\n\n\nY\nrev\ntwo\nY\nw12p2\nY\nrif\n13\n13\n1.00\n0.91\n\n\nsubtotal\n—\n—\n—\n—\n—\n—\n—\n253\n365\n0.69\n—\n\n\ntotal\n—\n—\n—\n—\n—\n—\n—\n1876\n2500\n0.75\n—\n\n\n\n1 w06p1 = 6 weeks following one-stage procedure, w12p1 = 12 weeks following one-stage procedure etc\n\n\n2 Transformed from the log-odds of response as used in the linear predictor to simulate data.\n\n\n\n\n\n\n\n\n\nTable 2: Summary of simulated trial data when no treatment effects present\n\n\n\n\n\n\nCode\nlsd &lt;- get_stan_data(ll$d_i)\nld &lt;- lsd$ld\nd_b &lt;- copy(lsd$d_b)\n\nm2 &lt;- cmdstanr::cmdstan_model(\"stan/model-sim-02.stan\")\n\nf_alleff_1 &lt;- m2$sample(\n  ld, iter_warmup = 1000, iter_sampling = 2000,\n  parallel_chains = 2, chains = 2, refresh = 0, show_exceptions = F, \n  max_treedepth = 13)\n\n\nRunning MCMC with 2 parallel chains...\n\nChain 2 finished in 1.2 seconds.\nChain 1 finished in 1.3 seconds.\n\nBoth chains finished successfully.\nMean chain execution time: 1.2 seconds.\nTotal execution time: 1.4 seconds.\n\n\nCode\npost_1 &lt;- data.table(f_alleff_1$draws(variables = c(\n  \"alpha\", \"gamma_b\", \"gamma_c\", \n  \"b_a_l\", \n  \"b_b1_l\", \n  \"b_b2_l\",\n  \"b_a_c\",\n  \"b_b1_c\", \n  \"b_b2_c\",\n  \"b_c\"\n), format = \"matrix\"))\n\n# compare when prior sd is set to 10 for trt effects\n\npri_sd &lt;- 10\nld$pri_sig_b_c &lt;- pri_sd\nld$pri_sig_a_l &lt;- pri_sd\nld$pri_sig_b1_l &lt;- pri_sd\nld$pri_sig_b2_l &lt;- pri_sd\nld$pri_sig_a_c &lt;- pri_sd\nld$pri_sig_b1_c &lt;- pri_sd\nld$pri_sig_b2_c &lt;- pri_sd\n\nf_alleff_2 &lt;- m2$sample(\n  ld, iter_warmup = 1000, iter_sampling = 2000,\n  parallel_chains = 2, chains = 2, refresh = 0, show_exceptions = F, \n  max_treedepth = 13)\n\n\nRunning MCMC with 2 parallel chains...\n\nChain 1 finished in 1.7 seconds.\nChain 2 finished in 1.7 seconds.\n\nBoth chains finished successfully.\nMean chain execution time: 1.7 seconds.\nTotal execution time: 1.8 seconds.\n\n\nCode\npost_2 &lt;- data.table(f_alleff_2$draws(variables = c(\n  \"alpha\", \"gamma_b\", \"gamma_c\", \n  \"b_a_l\", \n  \"b_b1_l\", \n  \"b_b2_l\",\n  \"b_a_c\",\n  \"b_b1_c\", \n  \"b_b2_c\",\n  \"b_c\"\n), format = \"matrix\"))\n\n\n\n\nCode\nd_fig1 &lt;- post_alpha(post_1)\nd_fig2 &lt;- post_alpha(post_2)\n\nd_fig &lt;- rbind(\n  cbind(prior_sd = 1, d_fig1),\n  cbind(prior_sd = pri_sd, d_fig2)\n)\nd_fig[, prior_sd := factor(prior_sd, levels = c(1, pri_sd))]\n\nggplot(d_fig, aes(x = grp, y = a, group = prior_sd, col = prior_sd)) +\n  scale_x_discrete(\"\") +\n  scale_y_continuous(\"log-odds treatment success\") + \n  scale_color_discrete(\"Prior sd on log-OR domain trt effects\") +\n  geom_point(data = d_fig, aes(x = grp, y = a_med), position = position_dodge(width = 0.4)) +\n  geom_linerange(aes(ymin = a_q025, ymax = a_q975), position = position_dodge2(width = 0.4)) +\n  geom_point(data = d_fig, aes(x = grp, y = a), col = 1, pch = 2)\n\n\n\n\n\n\n\n\nFigure 5: Posterior median and 95% CI for baseline log-odds of treatment success (triangles show true values).\n\n\n\n\n\n\n\nCode\nd_fig1 &lt;- post_dom_a(post_1)\nd_fig2 &lt;- post_dom_a(post_2)\n\nd_fig &lt;- rbind(\n  cbind(prior_sd = 1, d_fig1),\n  cbind(prior_sd = pri_sd, d_fig2)\n)\nd_fig[, prior_sd := factor(prior_sd, levels = c(1, pri_sd))]\n\n# https://www.andrewheiss.com/blog/2022/12/08/log10-natural-log-scales-ggplot/\n\nggplot(d_fig, aes(x = trt, y = b, col = prior_sd)) +\n  scale_x_discrete(\"\") +\n  scale_y_continuous(\"log-OR\") + \n  scale_color_discrete(\"Prior sd on log-OR domain trt effects\") +\n  geom_point(data = d_fig, aes(x = trt, y = b_med), position = position_dodge(width = 0.4)) +\n  geom_linerange(aes(ymin = b_q025, ymax = b_q975), position = position_dodge2(width = 0.4)) +\n  geom_point(data = d_fig, aes(x = trt, y = b), col = 1, pch = 2) +\n  facet_grid(~silo,scale=\"free_x\",space=\"free_x\")\n\n\n\n\n\n\n\n\nFigure 6: Posterior median and 95% CI for baseline log-odds of treatment success domain A (independent estimates for late and chronic silo).\n\n\n\n\n\n\n\nCode\nd_fig1 &lt;- post_dom_b(post_1)\nd_fig2 &lt;- post_dom_b(post_2)\n\nd_fig &lt;- rbind(\n  cbind(prior_sd = 1, d_fig1),\n  cbind(prior_sd = pri_sd, d_fig2)\n)\nd_fig[, prior_sd := factor(prior_sd, levels = c(1, pri_sd))]\n\n# https://www.andrewheiss.com/blog/2022/12/08/log10-natural-log-scales-ggplot/\n\nggplot(d_fig, aes(x = trt, y = b, col = prior_sd)) +\n  scale_x_discrete(\"\") +\n  scale_y_continuous(\"log-OR\") + \n  scale_color_discrete(\"Prior sd on log-OR domain trt effects\") +\n  geom_point(data = d_fig, aes(x = trt, y = b_med), position = position_dodge(width = 0.4)) +\n  geom_linerange(aes(ymin = b_q025, ymax = b_q975), position = position_dodge2(width = 0.4)) +\n  geom_point(data = d_fig, aes(x = trt, y = b), col = 1, pch = 2) +\n  facet_grid(paste0(\"Planned/assigned surgery: \", qa, \"-stage\")~silo,scale=\"free_x\",space=\"free_x\")\n\n\n\n\n\n\n\n\nFigure 7: Posterior median and 95% CI for baseline log-odds of treatment success domain B (independent estimates for late and chronic silo).\n\n\n\n\n\n\n\nCode\nd_fig1 &lt;- post_dom_c(post_1)\nd_fig2 &lt;- post_dom_c(post_2)\n\nd_fig &lt;- rbind(\n  cbind(prior_sd = 1, d_fig1),\n  cbind(prior_sd = pri_sd, d_fig2)\n)\nd_fig[, prior_sd := factor(prior_sd, levels = c(1, pri_sd))]\n\nggplot(d_fig, aes(x = trt, y = b, col = prior_sd)) +\n  scale_x_discrete(\"\") +\n  scale_y_continuous(\"log-OR\") + \n  scale_color_discrete(\"Prior sd on log-OR domain trt effects\") +\n  geom_point(data = d_fig, aes(x = trt, y = b_med), position = position_dodge(width = 0.4)) +\n  geom_linerange(aes(ymin = b_q025, ymax = b_q975), position = position_dodge2(width = 0.4)) +\n  geom_point(data = d_fig, aes(x = trt, y = b), col = 1, pch = 2)\n\n\n\n\n\n\n\n\nFigure 8: Posterior median and 95% CI for baseline log-odds of treatment success in domain C (effect is pooled across all silos).",
    "crumbs": [
      "Design",
      "Example trials"
    ]
  },
  {
    "objectID": "notebooks/trial-data.html",
    "href": "notebooks/trial-data.html",
    "title": "Simulated trial data",
    "section": "",
    "text": "Trial data is simulated under the model specification, see earlier section.\n\n\nCode\nll &lt;- get_trial_data(N = 2500)\n\nd_a &lt;- ll$d[silo %in% c(\"late\", \"chronic\"), .(y = sum(y), .N), keyby = .(silo, joint, ea, a)]\nd_b_late &lt;- ll$d[silo %in% c(\"late\") & a == \"rev\", .(y = sum(y), .N), keyby = .(silo, joint, qa, eb, b)]\nd_b_chronic &lt;- ll$d[silo %in% c(\"chronic\") , .(y = sum(y), .N), keyby = .(silo, joint, qa, eb, b)]\n\nd_b &lt;- rbind(d_b_late, d_b_chronic)\nd_c &lt;- ll$d[ec == \"Y\", .(y = sum(y), .N), keyby = .(silo, joint, ec, c)]\n\nd_all_grps &lt;- ll$d[, .(y = sum(y), .N), keyby = .(silo, joint, ea, a, qa, eb, b, ec, c)]\n\n\nTable 1 shows a summary of simulated trial data for surgical domain. Each row comprises patients allocated to the surgical domain intervention along with whatever their duration and type interventions were.\nFor example, late stage patients with knee joint infections receiving revision would include patients allocated to the duration options dependent on the planned surgical procedure and type options dependent on whether they were eligible for the type domain.\n\n\nCode\ncols &lt;- c(\"Silo\", \"Infection site\", \"Surgery\", \"Success\", \"N\", \"Pr(success)\")\nnames(cols) &lt;- names(d_a[, .(silo, joint, a, y, N, p_obs = y/N)])\n\ngt_tbl &lt;- d_a[, .(silo, joint, a, y, N, p_obs = y/N)] |&gt; \n  gt(\n  ) |&gt; \n  cols_align(\n    align = \"left\",\n    columns = starts_with(c(\"silo\", \"joint\"))\n  ) |&gt; \n  fmt_number(\n    columns = starts_with(c(\"p_obs\")),\n    decimals = 2\n  ) |&gt;\n  cols_label(.list = cols)\n\ngt_tbl\n\n\n\n\n\n\n\n\n\n\n\nSilo\nInfection site\nSurgery\nSuccess\nN\nPr(success)\n\n\n\n\nchronic\nhip\none\n77\n114\n0.68\n\n\nchronic\nhip\ntwo\n88\n104\n0.85\n\n\nchronic\nknee\none\n86\n118\n0.73\n\n\nchronic\nknee\ntwo\n103\n136\n0.76\n\n\nlate\nhip\ndair\n242\n404\n0.60\n\n\nlate\nhip\nrev\n364\n463\n0.79\n\n\nlate\nknee\ndair\n124\n204\n0.61\n\n\nlate\nknee\nrev\n142\n189\n0.75\n\n\n\n\n\n\n\n\nTable 1: Summary of simulated trial data for surgical domain\n\n\n\n\nTable 2 shows the analogous summary of simulated trial data for the duration domain.\n\n\nCode\ncols &lt;- c(\"Silo\", \"Infection site\", \"Revision\", \"Duration\", \"Success\", \"N\", \"Pr(success)\")\nnames(cols) &lt;- names(d_b[, .(silo, joint, qa, b, y, N, p_obs = y/N)])\n\ngt_tbl &lt;- d_b[, .(silo, joint, qa, b, y, N, p_obs = y/N)] |&gt; \n  gt(\n  ) |&gt; \n  cols_align(\n    align = \"left\",\n    columns = starts_with(c(\"silo\", \"joint\"))\n  ) |&gt; \n  fmt_number(\n    columns = starts_with(c(\"p_obs\")),\n    decimals = 2\n  ) |&gt;\n  cols_label(.list = cols)\n\ngt_tbl\n\n\n\n\n\n\n\n\n\n\n\nSilo\nInfection site\nRevision\nDuration\nSuccess\nN\nPr(success)\n\n\n\n\nlate\nhip\none\nw06p1\n92\n124\n0.74\n\n\nlate\nhip\none\nw12p1\n103\n125\n0.82\n\n\nlate\nhip\ntwo\nd07p2\n75\n102\n0.74\n\n\nlate\nhip\ntwo\nw12p2\n94\n112\n0.84\n\n\nlate\nknee\none\nw06p1\n35\n47\n0.74\n\n\nlate\nknee\none\nw12p1\n32\n44\n0.73\n\n\nlate\nknee\ntwo\nd07p2\n40\n52\n0.77\n\n\nlate\nknee\ntwo\nw12p2\n35\n46\n0.76\n\n\nchronic\nhip\none\nw06p1\n31\n56\n0.55\n\n\nchronic\nhip\none\nw12p1\n46\n58\n0.79\n\n\nchronic\nhip\ntwo\nd07p2\n48\n55\n0.87\n\n\nchronic\nhip\ntwo\nw12p2\n40\n49\n0.82\n\n\nchronic\nknee\none\nw06p1\n43\n59\n0.73\n\n\nchronic\nknee\none\nw12p1\n43\n59\n0.73\n\n\nchronic\nknee\ntwo\nd07p2\n49\n68\n0.72\n\n\nchronic\nknee\ntwo\nw12p2\n54\n68\n0.79\n\n\n\n\n\n\n\n\nTable 2: Summary of simulated trial data for duration domain\n\n\n\n\nTable 3 shows the analogous summary of simulated trial data for the type domain.\n\n\nCode\ncols &lt;- c(\"Silo\", \"Infection site\", \"Type\", \"Success\", \"N\", \"Pr(success)\")\nnames(cols) &lt;- names(d_c[, .(silo, joint, c, y, N, p_obs = y/N)])\n\ngt_tbl &lt;- d_c[, .(silo, joint, c, y, N, p_obs = y/N)] |&gt; \n  gt(\n  ) |&gt; \n  cols_align(\n    align = \"left\",\n    columns = starts_with(c(\"silo\", \"joint\"))\n  ) |&gt; \n  fmt_number(\n    columns = starts_with(c(\"p_obs\")),\n    decimals = 2\n  ) |&gt;\n  cols_label(.list = cols)\n\ngt_tbl\n\n\n\n\n\n\n\n\n\n\n\nSilo\nInfection site\nType\nSuccess\nN\nPr(success)\n\n\n\n\nchronic\nhip\nnorif\n48\n71\n0.68\n\n\nchronic\nhip\nrif\n53\n64\n0.83\n\n\nchronic\nknee\nnorif\n47\n66\n0.71\n\n\nchronic\nknee\nrif\n66\n79\n0.84\n\n\nearly\nhip\nnorif\n106\n137\n0.77\n\n\nearly\nhip\nrif\n102\n132\n0.77\n\n\nearly\nknee\nnorif\n57\n97\n0.59\n\n\nearly\nknee\nrif\n64\n95\n0.67\n\n\nlate\nhip\nnorif\n181\n260\n0.70\n\n\nlate\nhip\nrif\n184\n250\n0.74\n\n\nlate\nknee\nnorif\n75\n117\n0.64\n\n\nlate\nknee\nrif\n97\n130\n0.75\n\n\n\n\n\n\n\n\nTable 3: Summary of simulated trial data for type domain\n\n\n\n\nTable 4 shows the analogous summary of simulated trial data across all the combinations of silo, site of infection, domain membership and treatment allocation. It gives a better sense of the structure of the data as seen by the model, but unfortunately, it is not possible to produce dynamic totals based on the filtered data.\n\n\nCode\nd_tbl &lt;- d_all_grps[, .(silo, joint, ea, a, qa, eb, b, ec, c, y, N, p_obs = round(y/N, 2))]\nd_tbl[, silo := factor(silo, levels = c(\"early\", \"late\", \"chronic\"))]\nd_tbl[, joint := factor(joint, levels = c(\"knee\", \"hip\"))]\n\nsetkey(d_tbl, silo, joint)\n\nopts &lt;- list(\n  pageLength = 20, autoWidth = TRUE\n  )\n\ndatatable(d_tbl,\n          rownames = FALSE,\n          colnames = c(\n            'Silo' = 1, \n            'Infection site' = 2,\n            'A' = 3,\n            'A (trt)' = 4,\n            'A (plan)' = 5,\n            'B' = 6,\n            'B (trt)' = 7,\n            'C' = 8,\n            'C (trt)' = 9,\n            'Success' = 10,\n            'N' = 11,\n            'Pr(success)' = 12\n            ),\n          filter = 'top', options = opts\n          )\n\n\n\n\n\n\n\n\n\n\nTable 4: Summary of all groupings from simulated trial data",
    "crumbs": [
      "Design",
      "Simulated trial data"
    ]
  },
  {
    "objectID": "notebooks/estimands.html",
    "href": "notebooks/estimands.html",
    "title": "Estimands in complex designs",
    "section": "",
    "text": "Are designed to permit the evaluation of multiple interventions in a perpetual manner under a single protocol establishing a common infrastructure and analysis plan. Interventions can be added and withdrawn at different times based on need and the control group may be revised as the trial progresses. Platform trials can include adaptive elements (commonly stopping rules and adaptive randomisations) that allow design variations based on accruing evidence."
  },
  {
    "objectID": "notebooks/estimands.html#platform-trials",
    "href": "notebooks/estimands.html#platform-trials",
    "title": "Estimands in complex designs",
    "section": "",
    "text": "Are designed to permit the evaluation of multiple interventions in a perpetual manner under a single protocol establishing a common infrastructure and analysis plan. Interventions can be added and withdrawn at different times based on need and the control group may be revised as the trial progresses. Platform trials can include adaptive elements (commonly stopping rules and adaptive randomisations) that allow design variations based on accruing evidence."
  },
  {
    "objectID": "notebooks/estimands.html#estimands",
    "href": "notebooks/estimands.html#estimands",
    "title": "Estimands in complex designs",
    "section": "Estimands",
    "text": "Estimands\nCausal estimands are population quantities describing causal effects of treatments. The estimand framework facilitates a precise description of the treatment effect of interest in clinical trials. The estimand is the thing targeted for estimation which will address a question of interest intrinsic to the trial. In other words, setting objectives leads to estimands which, once clear, can lead to identifying a suitable method for estimation.\n\n\n\n\n\n\nNote\n\n\n\nIf you do not have a clear definition of an estimand, how do you derive an appropriate estimator?\n\n\nEstimands comprise:\n\na population of interest\na treatment strategy\na variable to be measured for each patient\nstrategies for handing intercurrent events (IE)\na population summary measure\n\nPer FDA, endpoint measures are developed to assess clinical outcomes, but things do seem to get mixed up.\nNevertheless - the endpoint is an outcome obtained for each patient that will be statistically analyzed to address the scientific question; this may include data from multiple variables.\nWhile the usual suspects for defining analysis populations (specifically for dealing with IE) were intention-to-treat ITT and per-protocol, the ICH expanded this set of strategies. Loosely, ITT analyses all patients as randomised, irrespective of what actually happened (e.g. deviations). PP analyses, only those who follow the protocol are used, the otherse are excluded. PP is commonly cited as being subject to bias, ITT less so. ICH defines:\n\nICH treatment strategies\n\n\n\n\n\n\nCommand\nDescription of common use\n\n\n\n\ntreatment policy\nMost common, similar to ITT; data collected is used regardless of whether IE occur. In other words, the IE is not a considered a departure from the treatment regimen of interest. TP preserves the randomisation, hence its attraction. Death can lead to TP being undefineable unless death is the (or a component of the) primary.\n\n\ncomposite policy\nIncorporates the IE as a component of the variable, e.g. alive at 29 days without use of rescue medication.\n\n\nhypothetical\nComplicated - envisages a scenario where the IE does not occur. The observed outcomes of patients without IE correspond to the outcome of interest, but the outcome of patients with IE is considered missing and needs to be imputed.\n\n\nwhile on treatment\nApplicable where there are repeat measures. The data is used up to the point where treatement was ended.\n\n\nprincipal stratum\nInvolves defining sub-populations according to the specific IEs on one or all treatments.\n\n\n\nas analyses strategies with some loose and brief descriptions provided above.\nIntercurrent events are just post-randomisation events that impact our measurements or interpretation of measurements in some way (e.g. intercurrent events arise through discontinuation of medication).\nFor the population-level summary, it is ususally relevant to provide within and between-arm measures, e.g. within-arm being overall survival at 28 days vs between-arm hazard ratio etc.\nPlatform trials introduce complexity into the specification of estimands and is not well considered in the literature. For example, what are the implications of addring treatment arms or modifying the control or implementing further data-driven adaptive features?"
  }
]
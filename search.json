[
  {
    "objectID": "notebooks/estimands.html",
    "href": "notebooks/estimands.html",
    "title": "Estimands in complex designs",
    "section": "",
    "text": "Are designed to permit the evaluation of multiple interventions in a perpetual manner under a single protocol establishing a common infrastructure and analysis plan. Interventions can be added and withdrawn at different times based on need and the control group may be revised as the trial progresses. Platform trials can include adaptive elements (commonly stopping rules and adaptive randomisations) that allow design variations based on accruing evidence."
  },
  {
    "objectID": "notebooks/estimands.html#platform-trials",
    "href": "notebooks/estimands.html#platform-trials",
    "title": "Estimands in complex designs",
    "section": "",
    "text": "Are designed to permit the evaluation of multiple interventions in a perpetual manner under a single protocol establishing a common infrastructure and analysis plan. Interventions can be added and withdrawn at different times based on need and the control group may be revised as the trial progresses. Platform trials can include adaptive elements (commonly stopping rules and adaptive randomisations) that allow design variations based on accruing evidence."
  },
  {
    "objectID": "notebooks/estimands.html#estimands",
    "href": "notebooks/estimands.html#estimands",
    "title": "Estimands in complex designs",
    "section": "Estimands",
    "text": "Estimands\nCausal estimands are population quantities describing causal effects of treatments. The estimand framework facilitates a precise description of the treatment effect of interest in clinical trials. The estimand is the thing targeted for estimation which will address a question of interest intrinsic to the trial. In other words, setting objectives leads to estimands which, once clear, can lead to identifying a suitable method for estimation.\n\n\n\n\n\n\nNote\n\n\n\nIf you do not have a clear definition of an estimand, how do you derive an appropriate estimator?\n\n\nEstimands comprise:\n\na population of interest\na treatment strategy\na variable to be measured for each patient\nstrategies for handing intercurrent events (IE)\na population summary measure\n\nPer FDA, endpoint measures are developed to assess clinical outcomes, but things do seem to get mixed up.\nNevertheless - the endpoint is an outcome obtained for each patient that will be statistically analyzed to address the scientific question; this may include data from multiple variables.\nWhile the usual suspects for defining analysis populations (specifically for dealing with IE) were intention-to-treat ITT and per-protocol, the ICH expanded this set of strategies. Loosely, ITT analyses all patients as randomised, irrespective of what actually happened (e.g. deviations). PP analyses, only those who follow the protocol are used, the otherse are excluded. PP is commonly cited as being subject to bias, ITT less so. ICH defines:\n\nICH treatment strategies\n\n\n\n\n\n\nCommand\nDescription of common use\n\n\n\n\ntreatment policy\nMost common, similar to ITT; data collected is used regardless of whether IE occur. In other words, the IE is not a considered a departure from the treatment regimen of interest. TP preserves the randomisation, hence its attraction. Death can lead to TP being undefineable unless death is the (or a component of the) primary.\n\n\ncomposite policy\nIncorporates the IE as a component of the variable, e.g. alive at 29 days without use of rescue medication.\n\n\nhypothetical\nComplicated - envisages a scenario where the IE does not occur. The observed outcomes of patients without IE correspond to the outcome of interest, but the outcome of patients with IE is considered missing and needs to be imputed.\n\n\nwhile on treatment\nApplicable where there are repeat measures. The data is used up to the point where treatement was ended.\n\n\nprincipal stratum\nInvolves defining sub-populations according to the specific IEs on one or all treatments.\n\n\n\nas analyses strategies with some loose and brief descriptions provided above.\nIntercurrent events are just post-randomisation events that impact our measurements or interpretation of measurements in some way (e.g. intercurrent events arise through discontinuation of medication).\nFor the population-level summary, it is ususally relevant to provide within and between-arm measures, e.g. within-arm being overall survival at 28 days vs between-arm hazard ratio etc.\nPlatform trials introduce complexity into the specification of estimands and is not well considered in the literature. For example, what are the implications of addring treatment arms or modifying the control or implementing further data-driven adaptive features?"
  },
  {
    "objectID": "notebooks/marginal-vs-conditional.html",
    "href": "notebooks/marginal-vs-conditional.html",
    "title": "Modelling approach - arginal vs conditional",
    "section": "",
    "text": "It is well known and broadly documented that the choice of treatment effect (e.g. absolute vs relative) leads to different characterisations of the same phenomenon and implies different heterogeneity."
  },
  {
    "objectID": "notebooks/modelling.html",
    "href": "notebooks/modelling.html",
    "title": "Modelling approaches",
    "section": "",
    "text": "Start simply, the goals being to encourage thinking about what the data might look like in order to get a sense of what we might be able to do with it, plus to start to look a bit more closely at the possibilities regarding the statistical modelling.\nFor what it is worth, here are a few comments about odds-ratios on the treatment effect, irrespetive of whether we assume a common parameter across silos or not.\nWhen I am referring to a marginal perspective in relation to a causal treatment effect (using an odds-ratio) I just mean the following, which follows the standard potential outcomes notation and definitions:\nwhere x=1 denotes treatment and x=0 denotes control and Y^a \\perp \\!\\!\\! \\perp X so that the observed OR equates to the causal OR. Typically, we would just use a model to estimate this quantity on the log-odds scale\nand then exponentiate the \\beta_1.\nWhen I say conditional, which I know is sloppy, I mean any situation where we might be thinking about strata specific effects\nfor which estimation would usually entail a model with an interaction between X and A and where you would likely note (absolutely) larger age-specific treatment effect odds ratios when compared to the marginal model. Unlike collapsable effect measures, the marginal treatment effect odds ratio is not a weighted average of the treatment effects in age strata. This can lead to weird findings if you choose to (even casually) look too closely."
  },
  {
    "objectID": "notebooks/modelling.html#scenario-1---how-model-specification-influences-parameter-estimation-in-logistic-regression",
    "href": "notebooks/modelling.html#scenario-1---how-model-specification-influences-parameter-estimation-in-logistic-regression",
    "title": "Modelling approaches",
    "section": "Scenario 1 - how model specification influences parameter estimation in logistic regression",
    "text": "Scenario 1 - how model specification influences parameter estimation in logistic regression\nAssume a total sample size of 10000 (for no other reason than to ensure that the empircal summaries will be close to the simulation parameters). Select two silos - early (37.5% of sample) and late (62.5% of sample) acute infections and one domain (antibiotic type) as the focus.\nAlso assume (for now) that everyone in the cohort will be eligible for the antibiotic type domain and that the only options are soc vs soc + rifampin. Include adjustment for joint (knee vs hip) with early acute silo having (abitrarily) more hip infections (early acute with 60% chance of hip infections, late acute with 35% chance of hip infections). Any randomisation is 1:1.\nAssume an outcome model for patient i as follows:\n\\begin{aligned}\ny_i &\\sim Bernoulli(\\pi_i) \\\\\nlogit(\\pi_i) &= \\eta_i = \\beta_0 + bsilo_{[silo[i]]} + babty_{[abty[i]]}  + bjoint_{[joint[i]]}\n\\end{aligned}\nwhere\n\n\\beta_0 is a common intercept\nbsilo_s models the effect of silo\nbabty_a models the effect of rifampin\nbjoint_j models the effect of joint (site of infection)\n\nAll terms are interpreted as the change in the log-odds of treatment success under a unit change in the category under consideration, holding all other terms constant.\nThe effects are, by design, common across strata (urgh, silo). Assume:\n\n\\beta_0 = logit^{-1}(0.7) (baseline response in early acute, soc, knee is 70% treatment success)\nbsilo_{[silo[i]] == earlyacute]} = 0\nbsilo_{[silo[i]] == lateacute]} = -0.5 (worse outcomes in the late acute silo)\nbabty_{[abty[i]] == soc]} = 0\nbabty_{[abty[i]] == rif]} = 1 (rifampin works)\nbjoint_{[joint[i]] == knee]} = 0\nbjoint_{[joint[i]] == hip]} = -0.75 (hip decreases likelihood of treatment success)\n\nSimulate a dataset under the above setup.\n\n\nCode\nset.seed(1001)\ndd1 &lt;- get_data_demo_1(\n  N = 10000,\n  a0 = qlogis(0.7),\n  # late acute does worse\n  a_la = -0.5,\n  c_abty = 1,\n  # hip joint infection decreases your chances of success\n  z_joint = -0.75,\n  pr_ea_joint = 0.6,\n  pr_la_joint = 0.3\n)\n\ndd1_smry &lt;- dd1[, .(y = sum(y), .N), keyby = .(silo, joint, abty)]\ndd1_smry[, joint := c(\"knee\", \"hip\")[joint + 1]]\ndd1_smry[, pr_success := y / N]\n\n\ncols &lt;- c(\"Y\", \"N\", \"Pr(Y)\")\nnames(cols) &lt;- c(\"y\", \"N\", \"pr_success\")\n\ngt_tbl &lt;- dd1_smry |&gt; \n  gt(\n    rowname_col = \"abty\",\n    groupname_col = c(\"silo\", \"joint\")\n  ) |&gt; \n  fmt_number(\n    columns = starts_with(\"pr_success\"),\n    decimals = 2\n  ) |&gt;\n  summary_rows(\n    columns = c(\"y\", \"N\"),\n    fns = list(\n      SubTotal ~ sum(., na.rm = T)\n    )\n  ) |&gt;\n  grand_summary_rows(\n    columns = c(\"y\", \"N\"),\n    fns = list(\n      Total ~ sum(., na.rm = T)\n    )\n  ) |&gt; \n  cols_width(\n    starts_with(\"abty\") ~ px(150)\n  ) |&gt; \n  cols_label(.list = cols) |&gt;\n  opt_table_font(\n    font = list(\n      google_font(name = \"Patrick Hand SC\"),\n      \"Cochin\", \"serif\"\n    )\n  ) |&gt;\n  tab_options(\n    table.font.size = px(14L)\n  )\n\n# plogis(qlogis(0.7)+1 - 0.75)\n# plogis(qlogis(0.7)-0.5+1 - 0.75)\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n    \n    \n  \n  \n    \n    \n      \n      Y\n      N\n      Pr(Y)\n    \n  \n  \n    \n      early_acute - knee\n    \n    rif\n627\n745\n0.84\n    soc\n499\n719\n0.69\n    SubTotal\n1126\n1464\n—\n    \n      early_acute - hip\n    \n    rif\n855\n1120\n0.76\n    soc\n551\n1100\n0.50\n    SubTotal\n1406\n2220\n—\n    \n      late_acute - knee\n    \n    rif\n1795\n2261\n0.79\n    soc\n1304\n2243\n0.58\n    SubTotal\n3099\n4504\n—\n    \n      late_acute - hip\n    \n    rif\n563\n896\n0.63\n    soc\n373\n916\n0.41\n    SubTotal\n936\n1812\n—\n    Total\n6567\n10000\n—\n  \n  \n  \n\nTable 1:  Demo data - single abtype domain. \n\n\n\nDouble checking a few of the above manually,\n\\begin{aligned}\nPr(Y) = \\begin{cases}\n  logit^{-1}(logit(0.7)+1-0.75) \\approx 0.75, & \\text{if early acute and hip with rif}\\\\\n  logit^{-1}(logit(0.7)-0.5+1-0.75) \\approx 0.65, & \\text{if late acute and hip with rif}\\\\\n  etc, &\n         \\end{cases}\n\\end{aligned}\nVery simple model:\n\n\ndata {\n  int N;\n  array[N] int y;\n  array[N] int n;\n  // covariates excludes intercept\n  int P;\n  matrix[N,P] X;\n}\nparameters {\n  real b0;\n  vector[P] b;  \n}\nmodel{\n  target += normal_lpdf(b0 | 0, 1.5);\n  target += normal_lpdf(b | 0, 1);\n  target += binomial_logit_lpmf(y | n, b0 + X * b); \n}\ngenerated quantities{\n  vector[N] p_y;\n  p_y = inv_logit(b0 + X * b);\n}\n\n\nFit with no stratification/adjustment, i.e. include only a term for assignment to rifampin. This gives an odds ratio associated with assignment of rifampin in the sample; a completely pooled effect of treatment.\nThe linear predictor is just\n\\beta_0 + \\beta_1 I(abty_{[i]} == rif)\n\n\\beta_1 gives us the log-odds ratio for the effect of rifampin in our sample.\n\nFit a second model that stratifies by silo and age. There is a common effect of antibiotic choice (no interactions) but the effect is interpreted in terms of holding silo and site of infection constant. In other words, it is more of a subject-specific rather population average effect and is arguably more clinically relevant. The linear predictor is now\n\\beta_0 + \\beta_1 I(abty_{[i]} == rif) + \\beta_2 I(silo_{[i]} == late acute) + \\beta_3 I(joint_{[i]} == hip)\n\n\\beta_1 gives us the log-odds ratio for the effect of rifampin in our sample holding silo and site of infection (joint) constant.\n\n\n\nCode\ndat &lt;- dd1[, .(y = sum(y), n = .N), keyby = abty]\ndat[abty == \"rif\", x := 1]\ndat[abty == \"soc\", x := 0]\n\nld1 &lt;- list(\n  N = 2, P = 1, \n  X = array(dat$x, dim = c(2,1)),\n  y = dat$y, n = dat$n\n)\n\nm1 &lt;- cmdstan_model(stan_file = file.path(\"stan\", \"model01.stan\"))\nf1 &lt;- m1$sample(\n  chains = 4, \n  data = ld1,\n  iter_sampling = 1000,\n  fixed_param = F,\n  refresh = 0\n)\n\n\nRunning MCMC with 4 sequential chains...\n\nChain 1 finished in 0.0 seconds.\nChain 2 finished in 0.0 seconds.\nChain 3 finished in 0.0 seconds.\nChain 4 finished in 0.0 seconds.\n\nAll 4 chains finished successfully.\nMean chain execution time: 0.0 seconds.\nTotal execution time: 0.5 seconds.\n\n\nCode\ndat &lt;- dd1[, .(y = sum(y), n = .N), keyby = .(abty, silo, joint)]\ndat[abty == \"rif\", x := 1]\ndat[abty == \"soc\", x := 0]\ndat[silo == \"early_acute\", s := 0]\ndat[silo == \"late_acute\", s := 1]\n\nld2 &lt;- list(\n  N = nrow(dat), P = 3, \n  # note - treatment effect (x) will be b[1]\n  X = dat[, .(x, s, joint)],\n  y = dat$y, n = dat$n\n)\n\n# same model implementation\nf2 &lt;- m1$sample(\n  chains = 4, \n  data = ld2,\n  iter_sampling = 1000,\n  fixed_param = F,\n  refresh = 0\n)\n\n\nRunning MCMC with 4 sequential chains...\n\nChain 1 finished in 0.1 seconds.\nChain 2 finished in 0.0 seconds.\nChain 3 finished in 0.0 seconds.\nChain 4 finished in 0.0 seconds.\n\nAll 4 chains finished successfully.\nMean chain execution time: 0.0 seconds.\nTotal execution time: 0.5 seconds.\n\n\nSummarise the joint posterior from the two models.\n\n\nCode\np1 &lt;- data.table(f1$draws(variables = c(\"b0\",\"b\"), format = \"matrix\"))\np1 &lt;- melt(p1, measure.vars = names(p1), variable.name = \"par\")\n\np2 &lt;- data.table(f2$draws(variables = c(\"b0\",\"b\"), format = \"matrix\"))\np2 &lt;- melt(p2, measure.vars = names(p2), variable.name = \"par\")\n\ndtbl1 &lt;- rbind(\n  p1[\n    , .(model = \"marginal\",\n        mu = mean(value), \n        sd = sd(value),\n        q025 = quantile(value, prob = 0.025),\n        q975 = quantile(value, prob = 0.975)),\n  keyby = par],\n  p2[\n    , .(model = \"conditional\",\n        mu = mean(value), \n        sd = sd(value),\n        q025 = quantile(value, prob = 0.025),\n        q975 = quantile(value, prob = 0.975)),\n  keyby = par]\n)\n\nterm = c(\"intercept\", \"trt\", \"silo\", \"joint\")\nnames(term) = c(\"b0\", paste0(\"b[\",1:3,\"]\"))\n\ndtbl1[, term := term[par]]\n\nsetcolorder(dtbl1, c(\"model\",\"par\", \"term\"))\n\ngt_tbl &lt;- dtbl1[, .SD, .SDcols = !c(\"par\")] |&gt; \n  gt(\n    rowname_col = \"term\",\n    groupname_col = c(\"model\")\n  ) |&gt; \n  fmt_number(\n    decimals = 3\n  )  |&gt;\n  opt_table_font(\n    font = list(\n      google_font(name = \"Patrick Hand SC\"),\n      \"Cochin\", \"serif\"\n    )\n  ) |&gt;\n  tab_options(\n    table.font.size = px(14L)\n  )\n\nor_trt1 &lt;- dtbl1[model == \"marginal\" & term == \"trt\", exp(mu)]\nor_trt2 &lt;- dtbl1[model == \"conditional\" & term == \"trt\", exp(mu)]\n\nrisk1 &lt;- plogis(dtbl1[model == \"marginal\" & term == \"intercept\", mu])\nrisk2 &lt;- plogis(dtbl1[model == \"conditional\" & term == \"intercept\", mu])\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n      \n      mu\n      sd\n      q025\n      q975\n    \n  \n  \n    \n      marginal\n    \n    intercept\n0.192\n0.028\n0.136\n0.249\n    trt\n0.986\n0.044\n0.903\n1.071\n    \n      conditional\n    \n    intercept\n0.786\n0.051\n0.689\n0.889\n    trt\n1.008\n0.044\n0.924\n1.094\n    silo\n−0.462\n0.048\n−0.556\n−0.368\n    joint\n−0.731\n0.048\n−0.824\n−0.639\n  \n  \n  \n\nTable 2:  Summary of joint posterior from marginal and conditional models. \n\n\n\nBy including the additional terms in the model we arrive at an absolutely larger parameter estimate for the effect of rifampin (albeit usually with the same or larger standard errors) and a widely different view on baseline risk. The conditional model reflects correctly specifies the approach based on the known data generating assumptions and accordingly the baseline risk aligns closer to what we know to be the truth: 0.55 (marginal) vs 0.69 (conditional) models.\nSimilarly, we get 2.68 and 2.74 for the estimated odds-ratios for the effect of rifampin under the marginal and conditional model.\nIn summary, in a logistic model, if you exclude a relevant predictor then the remaining parameters will be pulled towards the null. The difference between the two model assumptions are a function of the size of the effects - the stronger the effects the greater the difference between the model results. For small effects, there will usually be negligible differences.\nI believe there is also an impact on the transportability of effects to other populations. For example, consider the same model fit to a population where the joint infection distribution were reversed across the two silos.\n\n\nCode\nset.seed(1002)\ndd2 &lt;- get_data_demo_1(\n  N = 10000,\n  a0 = qlogis(0.7),\n  # late acute does worse\n  a_la = -0.5,\n  c_abty = 1,\n  # hip joint infection decreases your chances of success\n  z_joint = -0.75,\n  pr_ea_joint = 0.3,\n  pr_la_joint = 0.6\n)\n\ndat &lt;- dd2[, .(y = sum(y), n = .N), keyby = abty]\ndat[abty == \"rif\", x := 1]\ndat[abty == \"soc\", x := 0]\n\nld3 &lt;- list(\n  N = 2, P = 1, \n  X = array(dat$x, dim = c(2,1)),\n  y = dat$y, n = dat$n\n)\n\nf3 &lt;- m1$sample(\n  chains = 4, \n  data = ld3,\n  iter_sampling = 1000,\n  fixed_param = F,\n  refresh = 0\n)\n\n\nRunning MCMC with 4 sequential chains...\n\nChain 1 finished in 0.0 seconds.\nChain 2 finished in 0.0 seconds.\nChain 3 finished in 0.0 seconds.\nChain 4 finished in 0.0 seconds.\n\nAll 4 chains finished successfully.\nMean chain execution time: 0.0 seconds.\nTotal execution time: 0.5 seconds.\n\n\nCode\ndat &lt;- dd2[, .(y = sum(y), n = .N), keyby = .(abty, silo, joint)]\ndat[abty == \"rif\", x := 1]\ndat[abty == \"soc\", x := 0]\ndat[silo == \"early_acute\", s := 0]\ndat[silo == \"late_acute\", s := 1]\n\nld4 &lt;- list(\n  N = nrow(dat), P = 3, \n  # note - treatment effect (x) will be b[1]\n  X = dat[, .(x, s, joint)],\n  y = dat$y, n = dat$n\n)\n\n# same model implementation\nf4 &lt;- m1$sample(\n  chains = 4, \n  data = ld4,\n  iter_sampling = 1000,\n  fixed_param = F,\n  refresh = 0\n)\n\n\nRunning MCMC with 4 sequential chains...\n\nChain 1 finished in 0.0 seconds.\nChain 2 finished in 0.0 seconds.\nChain 3 finished in 0.0 seconds.\nChain 4 finished in 0.1 seconds.\n\nAll 4 chains finished successfully.\nMean chain execution time: 0.0 seconds.\nTotal execution time: 0.5 seconds.\n\n\n\n\nCode\np3 &lt;- data.table(f3$draws(variables = c(\"b0\", \"b\"), format = \"matrix\"))\np3 &lt;- melt(p3, measure.vars = names(p3), variable.name = \"par\")\n\np4 &lt;- data.table(f4$draws(variables = c(\"b0\", \"b\"), format = \"matrix\"))\np4 &lt;- melt(p4, measure.vars = names(p4), variable.name = \"par\")\n\ndtbl1 &lt;- rbind(\n  p3[\n    , .(model = \"marginal\",\n        mu = mean(value), \n        sd = sd(value),\n        q025 = quantile(value, prob = 0.025),\n        q975 = quantile(value, prob = 0.975)),\n  keyby = par],\n  p4[\n    , .(model = \"conditional\",\n        mu = mean(value), \n        sd = sd(value),\n        q025 = quantile(value, prob = 0.025),\n        q975 = quantile(value, prob = 0.975)),\n  keyby = par]\n)\n\nterm = c(\"intercept\", \"trt\", \"silo\", \"joint\")\nnames(term) = c(\"b0\", paste0(\"b[\",1:3,\"]\"))\ndtbl1[, term := term[par]]\nsetcolorder(dtbl1, c(\"model\",\"par\", \"term\"))\n\ngt_tbl &lt;- dtbl1[, .SD, .SDcols = !c(\"par\")] |&gt; \n  gt(\n    rowname_col = \"term\",\n    groupname_col = c(\"model\")\n  ) |&gt; \n  fmt_number(\n    decimals = 3\n  )  |&gt;\n  opt_table_font(\n    font = list(\n      google_font(name = \"Patrick Hand SC\"),\n      \"Cochin\", \"serif\"\n    )\n  ) |&gt;\n  tab_options(\n    table.font.size = px(14L)\n  )\n\nor_trt1 &lt;- dtbl1[model == \"marginal\" & term == \"trt\", exp(mu)]\nor_trt2 &lt;- dtbl1[model == \"conditional\" & term == \"trt\", exp(mu)]\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n      \n      mu\n      sd\n      q025\n      q975\n    \n  \n  \n    \n      marginal\n    \n    intercept\n0.165\n0.028\n0.110\n0.222\n    trt\n0.949\n0.044\n0.863\n1.034\n    \n      conditional\n    \n    intercept\n0.898\n0.046\n0.814\n0.988\n    trt\n0.991\n0.046\n0.903\n1.083\n    silo\n−0.527\n0.048\n−0.621\n−0.436\n    joint\n−0.785\n0.046\n−0.875\n−0.695\n  \n  \n  \n\nTable 3:  Summary of joint posterior from marginal and conditional models under\nnew distributional assumption for age \n\n\n\nSide note - the relationship between power and the inclusion of predictive baseline covariates differs between linear and logistic regression. In linear regression, you get increased power by the inclusion of additional covariates by virtue of the fact that the standard error drops. In logistic regression, the standard error usually stays the same when you include more covariates (and it can get larger). However, the parameters will (in general) also move in absolute value further away from the null."
  },
  {
    "objectID": "notebooks/modelling.html#scenario-2---model-incorporating-all-strata-and-domains",
    "href": "notebooks/modelling.html#scenario-2---model-incorporating-all-strata-and-domains",
    "title": "Modelling approaches",
    "section": "Scenario 2 - model incorporating all strata and domains",
    "text": "Scenario 2 - model incorporating all strata and domains\nNow assume:\n\na more realistic 2500 enrolments, some of whom will be deemed to be non-entries for various domain elements\n30%, 50% and 20% of enrolments fall under the early, late and chronic silos respectively\nin expectation, N = 750, 1250 and 500 for each of the silos\nknee infections correspond to 60% of cases (same in all silos)\nfor any given domain, 5% of the enrolments will be ineligible\nbaseline treatment success of 65%, 55% and 45% for early, late and chronic infection\n\nFor now, for the model specification, I am assuming the following:\n\\begin{aligned}\ny_i &\\sim Binomial(\\pi_i, n_i) \\\\\nlogit(\\pi_i) &= \\eta_i = bsilo_{[silo[i]]} +\n  bjoint_{[joint[i]]} + \\\\\n  &bsurg_{[surg[i]]} +\n  babdu_{[abdu[i]]} +\n  babty_{[abty[i]]}\n\\end{aligned}\nwhich, I know, negates the possibility of subject level effects and is almost certainly not ideal. With priors:\n\\begin{aligned}\nbsilo_s &\\sim N(0, 1.5) \\\\\nbjoint_j &\\sim N(0, 1) \\\\\nbsurg_o &\\sim N(0, 1) \\\\\nbabdu_p &\\sim N(0, 1) \\\\\nbabty_q &\\sim N(0, 1)\n\\end{aligned}\nwith all bar bsilo_s and bjoint_j having sum-to-zero constraints applied and bjoint_{[1]} = 0. Note that bsilo_s is given a different sd simply to make it just about uniform on the probability scale and therefore allowing us to place a zero mean without major concern.\nThe following function (from the data.R script) simulates data.\n\n\nCode\nset.seed(1010)\ndd2 &lt;- get_data_demo_2(\n  N = 2500,\n  # baseline log-odds of trt success by silo\n  b_silo = c(early_acute=qlogis(0.65), late_acute=qlogis(0.55), chronic=qlogis(0.45)),\n  # hip does worse\n  b_joint = c(knee = 0, hip = -0.5),\n  \n  # outcome model parameters for each domain\n  # could do this with ragged, but this is quicker.    \n  v_early_surg = c(early_na=0),\n  v_late_surg = c(late_na=0, late_dair = 0, late_one=0.1, late_two=-0.4),\n  v_chronic_surg = c(chronic_na=0, chronic_one=0, chronic_two=0.2),\n  \n  v_early_abdu = c(early_na=0),\n  v_late_abdu = c(late_na=0, late_one_short=0, late_one_long=0.3, late_two_short=0, late_two_long=0.1),\n  v_chronic_abdu = c(chronic_na=0, chronic_one_short=0, chronic_one_long=-0.2, chronic_two_short=0,chronic_two_long=0.5),\n  \n  v_early_abty = c(early_na=0, soc = 0, rif = 0.3),\n  v_late_abty = c(late_na=0, soc = 0, rif = 0.3),\n  v_chronic_abty = c(chronic_na=0, soc = 0, rif = 0.3)\n      \n)\n\n\nProvide summaries of patients contributing to the estimation of effects in each domain (surgery, antibiotic duration and antibiotic type).\n\nSurgery domain\nFor the surgery domain, there were approx 700 patients in the early silo that would have received dair, but are put into against an early_na classification to ensure they do not interfere with the estimation of dair effects.\nYou will note that the late acute silo has both one and two stage (instead of just revision). What I am doing is randomising to dair, one-stage, two-stage with probabilities \\{0.5, 0.25, 0.25\\} so that you get approximately 1:1 for dair vs revision.\nYou will also note the separate categories for late_one and chronic_one distinguishing the surgery types. I think this is in line with what SW was suggesting but I am not entirely sure. The approach intends to accomodate different effects for one vs two stage in the late vs chronic silo, albeit that this is somewhat mute given that the surgery domain intends to aggregate one and two-stage in the late acute group into a revision category. However, for now, I am leaving it as one-stage vs two-stage in the late silo and will worry about refining this down the line.\nBased on this structure, for the surgery domain, I am assuming silo and joint specific effects of interest for the late and chronic silos. The presentation of these effects could be something along the lines of:\n\nfor late - dair vs one and dair vs two, separately for knee and hip\nfor chronic - one vs two, separately for knee and hip\n\ninterpreted in the context of a given antibiotic duration, type etc.\n\n\nCode\ndd2_smry &lt;- dd2[, .(y = sum(y), .N), keyby = .(silo, joint, surg)]\ndd2_smry[, pr_obs := y / N]\ndd2_smry[, odds_obs := pr_obs / (1-pr_obs)]\ndd2_smry[, surg := factor(surg, levels = c(\n  paste0(c(\"early\", \"late\", \"chronic\"), \"_na\"),\n  paste0(\"late_\", c(\"dair\", \"one\", \"two\")),\n  paste0(\"chronic_\", c(\"one\", \"two\"))\n  ))]\n\ndd2_smry &lt;- dd2_smry[order(silo, joint, surg)]\nsetkey(dd2_smry, silo, joint, surg)\n\n\nors &lt;- c(\n  NA, NA,\n  dd2_smry[.(\"late_acute\", \"knee\", \"late_na\"), odds_obs]/dd2_smry[.(\"late_acute\", \"knee\", \"late_dair\"), odds_obs],\n  NA, # ref\n  dd2_smry[.(\"late_acute\", \"knee\", \"late_one\"), odds_obs]/dd2_smry[.(\"late_acute\", \"knee\", \"late_dair\"), odds_obs],\n  dd2_smry[.(\"late_acute\", \"knee\", \"late_two\"), odds_obs]/dd2_smry[.(\"late_acute\", \"knee\", \"late_dair\"), odds_obs],\n  \n  dd2_smry[.(\"late_acute\", \"hip\", \"late_na\"), odds_obs]/dd2_smry[.(\"late_acute\", \"hip\", \"late_dair\"), odds_obs],\n  NA, # ref\n  dd2_smry[.(\"late_acute\", \"hip\", \"late_one\"), odds_obs]/dd2_smry[.(\"late_acute\", \"hip\", \"late_dair\"), odds_obs],\n  dd2_smry[.(\"late_acute\", \"hip\", \"late_two\"), odds_obs]/dd2_smry[.(\"late_acute\", \"hip\", \"late_dair\"), odds_obs],\n  \n  dd2_smry[.(\"chronic\", \"knee\", \"chronic_na\"), odds_obs]/dd2_smry[.(\"chronic\", \"knee\", \"chronic_one\"), odds_obs],\n  NA, # ref\n  dd2_smry[.(\"chronic\", \"knee\", \"chronic_two\"), odds_obs]/dd2_smry[.(\"chronic\", \"knee\", \"chronic_one\"), odds_obs],\n  \n  dd2_smry[.(\"chronic\", \"hip\", \"chronic_na\"), odds_obs]/dd2_smry[.(\"chronic\", \"hip\", \"chronic_one\"), odds_obs],\n  NA, # ref\n  dd2_smry[.(\"chronic\", \"hip\", \"chronic_two\"), odds_obs]/dd2_smry[.(\"chronic\", \"hip\", \"chronic_one\"), odds_obs]\n)\n\n\n\ndd2_smry[, odds_ratio := ors]\n  \n  \n  \n\ngt_tbl &lt;- dd2_smry |&gt; \n  gt(\n    groupname_col = c(\"silo\", \"joint\")\n  ) |&gt; \n  fmt_number(\n    columns = starts_with(\"pr_obs\"),\n    decimals = 2\n  ) |&gt;\n  fmt_number(\n    columns = starts_with(\"odds_obs\"),\n    decimals = 2\n  ) |&gt;\n  fmt_number(\n    columns = starts_with(\"odds_ratio\"),\n    decimals = 2\n  ) |&gt;\n  summary_rows(\n    columns = c(\"N\"),\n    fns = list(\n      SubTotal ~ sum(., na.rm = T)\n    )\n  ) |&gt;\n  grand_summary_rows(\n    columns = c(\"N\"),\n    fns = list(\n      Total ~ sum(., na.rm = T)\n    )\n  )  |&gt;\n  sub_missing(\n    columns = everything(),\n    rows = everything(),\n    missing_text = \"---\"\n) |&gt;\n  opt_table_font(\n    font = list(\n      google_font(name = \"Patrick Hand SC\"),\n      \"Cochin\", \"serif\"\n    )\n  ) |&gt;\n  tab_options(\n    table.font.size = px(14L)\n  )\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n      \n      surg\n      y\n      N\n      pr_obs\n      odds_obs\n      odds_ratio\n    \n  \n  \n    \n      early_acute - knee\n    \n    \nearly_na\n310\n475\n0.65\n1.88\n—\n    SubTotal\n—\n—\n475\n—\n—\n—\n    \n      early_acute - hip\n    \n    \nearly_na\n139\n262\n0.53\n1.13\n—\n    SubTotal\n—\n—\n262\n—\n—\n—\n    \n      late_acute - knee\n    \n    \nlate_na\n20\n37\n0.54\n1.18\n0.80\n    \nlate_dair\n216\n363\n0.60\n1.47\n—\n    \nlate_one\n121\n189\n0.64\n1.78\n1.21\n    \nlate_two\n76\n154\n0.49\n0.97\n0.66\n    SubTotal\n—\n—\n743\n—\n—\n—\n    \n      late_acute - hip\n    \n    \nlate_na\n17\n29\n0.59\n1.42\n2.01\n    \nlate_dair\n95\n230\n0.41\n0.70\n—\n    \nlate_one\n73\n129\n0.57\n1.30\n1.85\n    \nlate_two\n39\n116\n0.34\n0.51\n0.72\n    SubTotal\n—\n—\n504\n—\n—\n—\n    \n      chronic - knee\n    \n    \nchronic_na\n2\n9\n0.22\n0.29\n0.34\n    \nchronic_one\n75\n163\n0.46\n0.85\n—\n    \nchronic_two\n87\n142\n0.61\n1.58\n1.86\n    SubTotal\n—\n—\n314\n—\n—\n—\n    \n      chronic - hip\n    \n    \nchronic_na\n6\n13\n0.46\n0.86\n3.14\n    \nchronic_one\n21\n98\n0.21\n0.27\n—\n    \nchronic_two\n41\n91\n0.45\n0.82\n3.01\n    SubTotal\n—\n—\n202\n—\n—\n—\n    Total\n—\n—\n2500\n—\n—\n—\n  \n  \n  \n\nTable 4:  Demo data - summary by surgery domain \n\n\n\n\n\nAntibiotic duration domain\nSimilarly, for the antibiotic duration domain, there are approx 700 patients in the early silo that would all receive long duration (12 weeks) with no randomisation. Again these would be bundled into a domain-specific early_na category to ensure they do not contribute to the estimation of other 12 week effects.\n\n\n\n\n\n\nNote\n\n\n\nI am actually just calling the duration effects long vs short irrespective of what the duration is because I believe that this might be the intent.\n\n\nIn the late acute group, the large number of late_na (again about 700) for the antibiotic duration domain deserves comment. Allocation to the antibiotic duration group is dependent on allocation within the surgical group. For those that received dair or for those for whom the surgical domain was not an option, there will be no antibiotic duration treatment option and hence they are classified under late_na. Of the approx 1250 in the late acute silo, approx 700 fell under either dair or late_na. There are also likely some small number of additional participants who are independently deem unsuitable for the antibiotic duration domain.\n\n\nCode\ndd2_smry &lt;- dd2[, .(y = sum(y), .N), keyby = .(silo, joint, abdu)]\n\ndd2_smry &lt;- dd2_smry[order(silo, joint, abdu)]\n\ngt_tbl &lt;- dd2_smry |&gt; \n  gt(\n    groupname_col = c(\"silo\", \"joint\")\n  ) |&gt; \n  summary_rows(\n    columns = c(\"N\"),\n    fns = list(\n      SubTotal ~ sum(., na.rm = T)\n    )\n  ) |&gt;\n  grand_summary_rows(\n    columns = c(\"N\"),\n    fns = list(\n      Total ~ sum(., na.rm = T)\n    )\n  )  |&gt;\n  opt_table_font(\n    font = list(\n      google_font(name = \"Patrick Hand SC\"),\n      \"Cochin\", \"serif\"\n    )\n  ) |&gt;\n  tab_options(\n    table.font.size = px(14L)\n  )\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n      \n      abdu\n      y\n      N\n    \n  \n  \n    \n      early_acute - knee\n    \n    \nearly_na\n310\n475\n    SubTotal\n—\n—\n475\n    \n      early_acute - hip\n    \n    \nearly_na\n139\n262\n    SubTotal\n—\n—\n262\n    \n      late_acute - knee\n    \n    \nlate_na\n250\n421\n    \nlate_one_long\n62\n94\n    \nlate_one_short\n48\n80\n    \nlate_two_long\n38\n77\n    \nlate_two_short\n35\n71\n    SubTotal\n—\n—\n743\n    \n      late_acute - hip\n    \n    \nlate_na\n117\n272\n    \nlate_one_long\n33\n56\n    \nlate_one_short\n39\n68\n    \nlate_two_long\n14\n47\n    \nlate_two_short\n21\n61\n    SubTotal\n—\n—\n504\n    \n      chronic - knee\n    \n    \nchronic_na\n10\n18\n    \nchronic_one_long\n38\n78\n    \nchronic_one_short\n34\n81\n    \nchronic_two_long\n43\n65\n    \nchronic_two_short\n39\n72\n    SubTotal\n—\n—\n314\n    \n      chronic - hip\n    \n    \nchronic_na\n10\n26\n    \nchronic_one_long\n7\n44\n    \nchronic_one_short\n12\n47\n    \nchronic_two_long\n29\n48\n    \nchronic_two_short\n10\n37\n    SubTotal\n—\n—\n202\n    Total\n—\n—\n2500\n  \n  \n  \n\nTable 5:  Demo data - summary by ab duration domain \n\n\n\n\n\nAntibiotic type domain\nThe patients that enter into this domain are approximately 50% of the enrolments across all silos and infection sites. This is a simplistic perspective but it is only aiming to capture the essense of the split across groups.\n\n\nCode\ndd2_smry &lt;- dd2[, .(y = sum(y), .N), keyby = .(silo, joint, abty)]\n\ndd2_smry &lt;- dd2_smry[order(silo, joint, abty)]\n\ngt_tbl &lt;- dd2_smry |&gt; \n  gt(\n    groupname_col = c(\"silo\", \"joint\")\n  ) |&gt; \n  summary_rows(\n    columns = c(\"N\"),\n    fns = list(\n      SubTotal ~ sum(., na.rm = T)\n    )\n  ) |&gt;\n  grand_summary_rows(\n    columns = c(\"N\"),\n    fns = list(\n      Total ~ sum(., na.rm = T)\n    )\n  )  |&gt;\n  opt_table_font(\n    font = list(\n      google_font(name = \"Patrick Hand SC\"),\n      \"Cochin\", \"serif\"\n    )\n  ) |&gt;\n  tab_options(\n    table.font.size = px(14L)\n  )\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n      \n      abty\n      y\n      N\n    \n  \n  \n    \n      early_acute - knee\n    \n    \nearly_na\n145\n239\n    \nrif\n87\n117\n    \nsoc\n78\n119\n    SubTotal\n—\n—\n475\n    \n      early_acute - hip\n    \n    \nearly_na\n75\n135\n    \nrif\n35\n57\n    \nsoc\n29\n70\n    SubTotal\n—\n—\n262\n    \n      late_acute - knee\n    \n    \nlate_na\n193\n354\n    \nrif\n137\n207\n    \nsoc\n103\n182\n    SubTotal\n—\n—\n743\n    \n      late_acute - hip\n    \n    \nlate_na\n102\n246\n    \nrif\n62\n135\n    \nsoc\n60\n123\n    SubTotal\n—\n—\n504\n    \n      chronic - knee\n    \n    \nchronic_na\n77\n157\n    \nrif\n50\n81\n    \nsoc\n37\n76\n    SubTotal\n—\n—\n314\n    \n      chronic - hip\n    \n    \nchronic_na\n39\n108\n    \nrif\n14\n41\n    \nsoc\n15\n53\n    SubTotal\n—\n—\n202\n    Total\n—\n—\n2500\n  \n  \n  \n\nTable 6:  Demo data - summary by ab type domain \n\n\n\n\n\nAll domains\nFinally, the following table provides a summary across each of the possible combinations of domain level classifications/assignments.\n\n\nCode\ndd2_smry &lt;- dd2[, .(y = sum(y), .N), keyby = .(silo, joint, surg, abdu, abty)]\ndd2_smry[, surg := factor(surg, levels = c(\n  paste0(c(\"early\", \"late\", \"chronic\"), \"_na\"),\n  paste0(\"late_\", c(\"dair\", \"one\", \"two\")),\n  paste0(\"chronic_\", c(\"one\", \"two\"))\n  ))]\n\ndd2_smry &lt;- dd2_smry[order(silo, joint, surg, abdu, abty)]\n\ngt_tbl &lt;- dd2_smry |&gt; \n  gt(\n    groupname_col = c(\"silo\", \"joint\")\n  ) |&gt; \n  summary_rows(\n    columns = c(\"N\"),\n    fns = list(\n      SubTotal ~ sum(., na.rm = T)\n    )\n  ) |&gt;\n  grand_summary_rows(\n    columns = c(\"N\"),\n    fns = list(\n      Total ~ sum(., na.rm = T)\n    )\n  )  |&gt;\n  opt_table_font(\n    font = list(\n      google_font(name = \"Patrick Hand SC\"),\n      \"Cochin\", \"serif\"\n    )\n  ) |&gt;\n  tab_options(\n    table.font.size = px(14L)\n  )\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n      \n      surg\n      abdu\n      abty\n      y\n      N\n    \n  \n  \n    \n      early_acute - knee\n    \n    \nearly_na\nearly_na\nearly_na\n145\n239\n    \nearly_na\nearly_na\nrif\n87\n117\n    \nearly_na\nearly_na\nsoc\n78\n119\n    SubTotal\n—\n—\n—\n—\n475\n    \n      early_acute - hip\n    \n    \nearly_na\nearly_na\nearly_na\n75\n135\n    \nearly_na\nearly_na\nrif\n35\n57\n    \nearly_na\nearly_na\nsoc\n29\n70\n    SubTotal\n—\n—\n—\n—\n262\n    \n      late_acute - knee\n    \n    \nlate_na\nlate_na\nlate_na\n6\n18\n    \nlate_na\nlate_na\nrif\n11\n15\n    \nlate_na\nlate_na\nsoc\n3\n4\n    \nlate_dair\nlate_na\nlate_na\n102\n174\n    \nlate_dair\nlate_na\nrif\n66\n103\n    \nlate_dair\nlate_na\nsoc\n48\n86\n    \nlate_one\nlate_na\nlate_na\n3\n5\n    \nlate_one\nlate_na\nrif\n6\n6\n    \nlate_one\nlate_na\nsoc\n2\n4\n    \nlate_one\nlate_one_long\nlate_na\n21\n39\n    \nlate_one\nlate_one_long\nrif\n20\n28\n    \nlate_one\nlate_one_long\nsoc\n21\n27\n    \nlate_one\nlate_one_short\nlate_na\n25\n42\n    \nlate_one\nlate_one_short\nrif\n10\n17\n    \nlate_one\nlate_one_short\nsoc\n13\n21\n    \nlate_two\nlate_na\nlate_na\n2\n4\n    \nlate_two\nlate_na\nsoc\n1\n2\n    \nlate_two\nlate_two_long\nlate_na\n20\n38\n    \nlate_two\nlate_two_long\nrif\n12\n22\n    \nlate_two\nlate_two_long\nsoc\n6\n17\n    \nlate_two\nlate_two_short\nlate_na\n14\n34\n    \nlate_two\nlate_two_short\nrif\n12\n16\n    \nlate_two\nlate_two_short\nsoc\n9\n21\n    SubTotal\n—\n—\n—\n—\n743\n    \n      late_acute - hip\n    \n    \nlate_na\nlate_na\nlate_na\n6\n11\n    \nlate_na\nlate_na\nrif\n4\n7\n    \nlate_na\nlate_na\nsoc\n7\n11\n    \nlate_dair\nlate_na\nlate_na\n45\n110\n    \nlate_dair\nlate_na\nrif\n24\n68\n    \nlate_dair\nlate_na\nsoc\n26\n52\n    \nlate_one\nlate_na\nlate_na\n1\n5\n    \nlate_one\nlate_one_long\nlate_na\n14\n23\n    \nlate_one\nlate_one_long\nrif\n11\n17\n    \nlate_one\nlate_one_long\nsoc\n8\n16\n    \nlate_one\nlate_one_short\nlate_na\n19\n35\n    \nlate_one\nlate_one_short\nrif\n10\n16\n    \nlate_one\nlate_one_short\nsoc\n10\n17\n    \nlate_two\nlate_na\nlate_na\n3\n5\n    \nlate_two\nlate_na\nrif\n1\n2\n    \nlate_two\nlate_na\nsoc\n0\n1\n    \nlate_two\nlate_two_long\nlate_na\n5\n22\n    \nlate_two\nlate_two_long\nrif\n6\n11\n    \nlate_two\nlate_two_long\nsoc\n3\n14\n    \nlate_two\nlate_two_short\nlate_na\n9\n35\n    \nlate_two\nlate_two_short\nrif\n6\n14\n    \nlate_two\nlate_two_short\nsoc\n6\n12\n    SubTotal\n—\n—\n—\n—\n504\n    \n      chronic - knee\n    \n    \nchronic_na\nchronic_na\nchronic_na\n1\n6\n    \nchronic_na\nchronic_na\nrif\n0\n1\n    \nchronic_na\nchronic_na\nsoc\n1\n2\n    \nchronic_one\nchronic_na\nchronic_na\n0\n1\n    \nchronic_one\nchronic_na\nrif\n2\n2\n    \nchronic_one\nchronic_na\nsoc\n1\n1\n    \nchronic_one\nchronic_one_long\nchronic_na\n17\n37\n    \nchronic_one\nchronic_one_long\nrif\n10\n19\n    \nchronic_one\nchronic_one_long\nsoc\n11\n22\n    \nchronic_one\nchronic_one_short\nchronic_na\n20\n40\n    \nchronic_one\nchronic_one_short\nrif\n9\n18\n    \nchronic_one\nchronic_one_short\nsoc\n5\n23\n    \nchronic_two\nchronic_na\nchronic_na\n2\n2\n    \nchronic_two\nchronic_na\nrif\n2\n2\n    \nchronic_two\nchronic_na\nsoc\n1\n1\n    \nchronic_two\nchronic_two_long\nchronic_na\n20\n34\n    \nchronic_two\nchronic_two_long\nrif\n11\n16\n    \nchronic_two\nchronic_two_long\nsoc\n12\n15\n    \nchronic_two\nchronic_two_short\nchronic_na\n17\n37\n    \nchronic_two\nchronic_two_short\nrif\n16\n23\n    \nchronic_two\nchronic_two_short\nsoc\n6\n12\n    SubTotal\n—\n—\n—\n—\n314\n    \n      chronic - hip\n    \n    \nchronic_na\nchronic_na\nchronic_na\n5\n9\n    \nchronic_na\nchronic_na\nrif\n1\n3\n    \nchronic_na\nchronic_na\nsoc\n0\n1\n    \nchronic_one\nchronic_na\nchronic_na\n0\n1\n    \nchronic_one\nchronic_na\nrif\n1\n3\n    \nchronic_one\nchronic_na\nsoc\n1\n3\n    \nchronic_one\nchronic_one_long\nchronic_na\n4\n18\n    \nchronic_one\nchronic_one_long\nrif\n1\n11\n    \nchronic_one\nchronic_one_long\nsoc\n2\n15\n    \nchronic_one\nchronic_one_short\nchronic_na\n7\n26\n    \nchronic_one\nchronic_one_short\nrif\n2\n6\n    \nchronic_one\nchronic_one_short\nsoc\n3\n15\n    \nchronic_two\nchronic_na\nchronic_na\n0\n2\n    \nchronic_two\nchronic_na\nrif\n1\n2\n    \nchronic_two\nchronic_na\nsoc\n1\n2\n    \nchronic_two\nchronic_two_long\nchronic_na\n17\n31\n    \nchronic_two\nchronic_two_long\nrif\n7\n9\n    \nchronic_two\nchronic_two_long\nsoc\n5\n8\n    \nchronic_two\nchronic_two_short\nchronic_na\n6\n21\n    \nchronic_two\nchronic_two_short\nrif\n1\n7\n    \nchronic_two\nchronic_two_short\nsoc\n3\n9\n    SubTotal\n—\n—\n—\n—\n202\n    Total\n—\n—\n—\n—\n2500\n  \n  \n  \n\nTable 7:  Demo data - summary by all domains \n\n\n\n\n\nModel\nImplement a model per the earlier specification:\n\n\n// group all your data up first\n// instructions:\ndata{ \n  int N; // total number of records\n  int S; // number of silos\n  int J; // number of joints\n  int O; // number of surgery types\n  int P; // number of abdu types\n  int Q; // number of abty types\n  \n  array[N] int y;\n  array[N] int n;\n\n  array[N] int silo;\n  array[N] int joint;\n  array[N] int surg;\n  array[N] int abdu;\n  array[N] int abty;\n\n  // prior only\n  int prior_only;\n}\ntransformed data{\n  matrix [O,O] XS = diag_matrix(rep_vector(1,O));\n  matrix [O,O-1] XS_qr;\n  matrix [P,P] XD = diag_matrix(rep_vector(1,P));\n  matrix [P,P-1] XD_qr;\n  matrix [Q,Q] XT = diag_matrix(rep_vector(1,Q));\n  matrix [Q,Q-1] XT_qr;\n\n  for(i in 1:(O-1)){ XS[O,i] = -1; }\n  for(i in 1:(P-1)){ XD[P,i] = -1; }\n  for(i in 1:(Q-1)){ XT[Q,i] = -1; }\n\n  XS[O,O] = 0;\n  XD[P,P] = 0;\n  XT[Q,Q] = 0;\n  // The orthogonal matrix in the fat QR decomposition of A,\n  // which implies that the resulting matrix is square with\n  // the same number of rows as A\n  XS_qr = qr_Q(XS)[,1:(O-1)];\n  XD_qr = qr_Q(XD)[,1:(P-1)];\n  XT_qr = qr_Q(XT)[,1:(Q-1)];\n}\nparameters{\n  vector[S] b_silo;\n  real b_joint_raw;\n  vector[O-1] b_surg_raw;\n  vector[P-1] b_abdu_raw;\n  vector[Q-1] b_abty_raw;\n}\ntransformed parameters{\n  // the 3 just scales the prior sd, purely for demonstration\n  vector[J] b_joint;\n  vector[O] b_surg = 3 * XS_qr * b_surg_raw;\n  vector[P] b_abdu = 3 * XD_qr * b_abdu_raw;\n  vector[Q] b_abty = 3 * XT_qr * b_abty_raw;\n\n  b_joint[1] = 0.0;\n  b_joint[2] = b_joint_raw;\n} \nmodel{\n  target += normal_lpdf(b_silo | 0, 1.5);\n  target += normal_lpdf(b_joint_raw | 0, 1);\n  target += normal_lpdf(b_surg_raw | 0, inv(sqrt(1 - inv(O))) );\n  target += normal_lpdf(b_abdu_raw | 0, inv(sqrt(1 - inv(P))) );\n  target += normal_lpdf(b_abty_raw | 0, inv(sqrt(1 - inv(Q))) );\n\n  if(!prior_only){\n    for(i in 1:N){\n      // leave as binomial now so negates the possibility of subject level effects\n      target += binomial_logit_lpmf(y[i] | n[i], \n        b_silo[silo[i]] + b_joint[joint[i]] + \n        b_surg[surg[i]] +\n        b_abdu[abdu[i]] +\n        b_abty[abty[i]]);\n    }\n} }\ngenerated quantities{\n  vector[N] p;\n  for(i in 1:N){\n    p[i] = inv_logit(b_silo[silo[i]] + \n      b_joint[joint[i]] + \n      b_surg[surg[i]] +\n      b_abdu[abdu[i]] +\n      b_abty[abty[i]] \n      );\n  }\n}\n\n\nThe model uses a binomial likelihood so I collect the simulated data by silo, joint, surgery, antibutic duration and type and then derive indexes for the parameters. Once done, we are in a position to fit the model.\n\n\nCode\ndat &lt;- dd2[, .(y = sum(y), n = .N), keyby = .(silo, joint, surg, abdu, abty)]\ndat[, p_obs := y / n]\n\nid_silo &lt;- 1:3\nnames(id_silo) &lt;- g_silo\n\nid_joint &lt;- 1:2\nnames(id_joint) &lt;- g_joint\n\nid_surg &lt;- 1:8\nnames(id_surg) &lt;- c(\n  \"early_na\", \n  \"late_na\", \"late_dair\", \"late_one\", \"late_two\",\n  \"chronic_na\", \"chronic_one\", \"chronic_two\"\n)\n\nid_abdu &lt;- 1:11\nnames(id_abdu) &lt;- c(\n  \"early_na\", \n  \"late_na\", \"late_one_long\", \"late_one_short\", \"late_two_long\", \"late_two_short\",\n  \"chronic_na\", \"chronic_one_long\", \"chronic_one_short\",\"chronic_two_long\", \"chronic_two_short\"\n)\n\nid_abty &lt;- 1:5\nnames(id_abty) &lt;- c(\n  \"early_na\", \"rif\", \"soc\", \n  \"late_na\", \n  \"chronic_na\"\n)\n  \ndat[, id_silo := id_silo[silo]]\ndat[, id_joint := id_joint[joint]]\ndat[, id_surg := id_surg[surg]]\ndat[, id_abdu := id_abdu[abdu]]\ndat[, id_abty := id_abty[abty]]\n\n\nld1 &lt;- list(\n  N = nrow(dat), S = 3, J = 2, \n  O = length(unique(dat$id_surg)),\n  P = length(unique(dat$id_abdu)),\n  Q = length(unique(dat$id_abty)),\n  y = dat$y, n = dat$n,\n  silo = dat$id_silo,\n  joint = dat$id_joint,\n  surg = dat$id_surg,\n  abdu = dat$id_abdu,\n  abty = dat$id_abty  ,\n  prior_only = 0\n)\n \nm2 &lt;- cmdstan_model(stan_file = file.path(\"stan\", \"model03.stan\"))\nf1 &lt;- m2$sample(\n  chains = 2,\n  data = ld1,\n  iter_sampling = 1000,\n  fixed_param = F,\n  refresh = 0\n)\n\n\nRunning MCMC with 2 sequential chains...\n\nChain 1 finished in 4.2 seconds.\nChain 2 finished in 4.2 seconds.\n\nBoth chains finished successfully.\nMean chain execution time: 4.2 seconds.\nTotal execution time: 8.5 seconds.\n\n\nI have set the model up to produced estimates of risk by group, with the mindset that this would allow us to derive relevant causal effects (of whatever form required) by using some kind of empirical weighting. The grouping is obviously not what is intended, but I think it could possibly be useful to try and work through something like this as a means to elicit some more detail on the specification.\n\n\nCode\np1 &lt;- data.table(f1$draws(variables = c(\"p\"), format = \"matrix\")) \np1 &lt;- melt(p1, measure.vars = names(p1), variable.name = \"par\")\n\ndtbl1 &lt;- \n  p1[\n    , .(mu = mean(value), \n        sd = sd(value),\n        q025 = quantile(value, prob = 0.025),\n        q975 = quantile(value, prob = 0.975)),\n  keyby = par]\n\n\ndtbl1 &lt;- cbind(dat[, .(silo, joint, surg, abdu, abty, y, n, p_obs)], dtbl1)\n\ngt_tbl &lt;- dtbl1[, .SD, .SDcols = !c(\"par\")] |&gt; \n  gt(\n    groupname_col = c(\"silo\", \"joint\")\n  ) |&gt; \n  fmt_number(\n    columns = all_of(c(\"p_obs\", \"mu\", \"sd\", \"q025\", \"q975\")),\n    decimals = 2\n  )  |&gt;\n  opt_table_font(\n    font = list(\n      google_font(name = \"Patrick Hand SC\"),\n      \"Cochin\", \"serif\"\n    )\n  ) |&gt;\n  tab_options(\n    table.font.size = px(14L)\n  )\n\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n      surg\n      abdu\n      abty\n      y\n      n\n      p_obs\n      mu\n      sd\n      q025\n      q975\n    \n  \n  \n    \n      early_acute - knee\n    \n    early_na\nearly_na\nearly_na\n145\n239\n0.61\n0.64\n0.03\n0.59\n0.69\n    early_na\nearly_na\nrif\n87\n117\n0.74\n0.72\n0.03\n0.67\n0.77\n    early_na\nearly_na\nsoc\n78\n119\n0.66\n0.64\n0.03\n0.59\n0.70\n    \n      early_acute - hip\n    \n    early_na\nearly_na\nearly_na\n75\n135\n0.56\n0.49\n0.03\n0.44\n0.55\n    early_na\nearly_na\nrif\n35\n57\n0.61\n0.58\n0.03\n0.52\n0.65\n    early_na\nearly_na\nsoc\n29\n70\n0.41\n0.50\n0.03\n0.43\n0.56\n    \n      late_acute - knee\n    \n    late_dair\nlate_na\nlate_na\n102\n174\n0.59\n0.55\n0.03\n0.50\n0.60\n    late_dair\nlate_na\nrif\n66\n103\n0.64\n0.65\n0.03\n0.59\n0.70\n    late_dair\nlate_na\nsoc\n48\n86\n0.56\n0.57\n0.03\n0.51\n0.63\n    late_na\nlate_na\nlate_na\n6\n18\n0.33\n0.59\n0.06\n0.46\n0.71\n    late_na\nlate_na\nrif\n11\n15\n0.73\n0.68\n0.06\n0.56\n0.78\n    late_na\nlate_na\nsoc\n3\n4\n0.75\n0.61\n0.06\n0.48\n0.72\n    late_one\nlate_na\nlate_na\n3\n5\n0.60\n0.60\n0.11\n0.39\n0.80\n    late_one\nlate_na\nrif\n6\n6\n1.00\n0.70\n0.10\n0.49\n0.86\n    late_one\nlate_na\nsoc\n2\n4\n0.50\n0.62\n0.11\n0.41\n0.81\n    late_one\nlate_one_long\nlate_na\n21\n39\n0.54\n0.65\n0.04\n0.57\n0.74\n    late_one\nlate_one_long\nrif\n20\n28\n0.71\n0.74\n0.04\n0.67\n0.81\n    late_one\nlate_one_long\nsoc\n21\n27\n0.78\n0.67\n0.04\n0.59\n0.75\n    late_one\nlate_one_short\nlate_na\n25\n42\n0.60\n0.63\n0.04\n0.54\n0.71\n    late_one\nlate_one_short\nrif\n10\n17\n0.59\n0.72\n0.04\n0.64\n0.80\n    late_one\nlate_one_short\nsoc\n13\n21\n0.62\n0.65\n0.04\n0.55\n0.73\n    late_two\nlate_na\nlate_na\n2\n4\n0.50\n0.56\n0.12\n0.32\n0.79\n    late_two\nlate_na\nsoc\n1\n2\n0.50\n0.58\n0.12\n0.34\n0.81\n    late_two\nlate_two_long\nlate_na\n20\n38\n0.53\n0.44\n0.05\n0.35\n0.53\n    late_two\nlate_two_long\nrif\n12\n22\n0.55\n0.54\n0.05\n0.45\n0.64\n    late_two\nlate_two_long\nsoc\n6\n17\n0.35\n0.46\n0.05\n0.37\n0.56\n    late_two\nlate_two_short\nlate_na\n14\n34\n0.41\n0.46\n0.05\n0.37\n0.56\n    late_two\nlate_two_short\nrif\n12\n16\n0.75\n0.57\n0.05\n0.47\n0.66\n    late_two\nlate_two_short\nsoc\n9\n21\n0.43\n0.48\n0.05\n0.39\n0.58\n    \n      late_acute - hip\n    \n    late_dair\nlate_na\nlate_na\n45\n110\n0.41\n0.40\n0.03\n0.34\n0.45\n    late_dair\nlate_na\nrif\n24\n68\n0.35\n0.50\n0.03\n0.44\n0.57\n    late_dair\nlate_na\nsoc\n26\n52\n0.50\n0.42\n0.03\n0.36\n0.48\n    late_na\nlate_na\nlate_na\n6\n11\n0.55\n0.44\n0.06\n0.31\n0.57\n    late_na\nlate_na\nrif\n4\n7\n0.57\n0.54\n0.07\n0.41\n0.66\n    late_na\nlate_na\nsoc\n7\n11\n0.64\n0.46\n0.07\n0.33\n0.59\n    late_one\nlate_na\nlate_na\n1\n5\n0.20\n0.46\n0.11\n0.26\n0.69\n    late_one\nlate_one_long\nlate_na\n14\n23\n0.61\n0.51\n0.05\n0.42\n0.61\n    late_one\nlate_one_long\nrif\n11\n17\n0.65\n0.61\n0.05\n0.52\n0.70\n    late_one\nlate_one_long\nsoc\n8\n16\n0.50\n0.53\n0.05\n0.44\n0.62\n    late_one\nlate_one_short\nlate_na\n19\n35\n0.54\n0.48\n0.05\n0.39\n0.57\n    late_one\nlate_one_short\nrif\n10\n16\n0.62\n0.59\n0.05\n0.49\n0.68\n    late_one\nlate_one_short\nsoc\n10\n17\n0.59\n0.50\n0.05\n0.41\n0.59\n    late_two\nlate_na\nlate_na\n3\n5\n0.60\n0.42\n0.12\n0.21\n0.67\n    late_two\nlate_na\nrif\n1\n2\n0.50\n0.52\n0.13\n0.29\n0.76\n    late_two\nlate_na\nsoc\n0\n1\n0.00\n0.44\n0.12\n0.22\n0.70\n    late_two\nlate_two_long\nlate_na\n5\n22\n0.23\n0.30\n0.04\n0.23\n0.39\n    late_two\nlate_two_long\nrif\n6\n11\n0.55\n0.40\n0.05\n0.30\n0.49\n    late_two\nlate_two_long\nsoc\n3\n14\n0.21\n0.32\n0.04\n0.24\n0.41\n    late_two\nlate_two_short\nlate_na\n9\n35\n0.26\n0.32\n0.04\n0.24\n0.41\n    late_two\nlate_two_short\nrif\n6\n14\n0.43\n0.42\n0.05\n0.32\n0.52\n    late_two\nlate_two_short\nsoc\n6\n12\n0.50\n0.34\n0.05\n0.25\n0.43\n    \n      chronic - knee\n    \n    chronic_na\nchronic_na\nchronic_na\n1\n6\n0.17\n0.43\n0.11\n0.23\n0.65\n    chronic_na\nchronic_na\nrif\n0\n1\n0.00\n0.50\n0.11\n0.29\n0.73\n    chronic_na\nchronic_na\nsoc\n1\n2\n0.50\n0.42\n0.11\n0.23\n0.65\n    chronic_one\nchronic_na\nchronic_na\n0\n1\n0.00\n0.51\n0.15\n0.22\n0.77\n    chronic_one\nchronic_na\nrif\n2\n2\n1.00\n0.58\n0.14\n0.28\n0.83\n    chronic_one\nchronic_na\nsoc\n1\n1\n1.00\n0.50\n0.14\n0.22\n0.77\n    chronic_one\nchronic_one_long\nchronic_na\n17\n37\n0.46\n0.40\n0.05\n0.30\n0.50\n    chronic_one\nchronic_one_long\nrif\n10\n19\n0.53\n0.48\n0.05\n0.37\n0.59\n    chronic_one\nchronic_one_long\nsoc\n11\n22\n0.50\n0.39\n0.05\n0.30\n0.50\n    chronic_one\nchronic_one_short\nchronic_na\n20\n40\n0.50\n0.39\n0.05\n0.30\n0.49\n    chronic_one\nchronic_one_short\nrif\n9\n18\n0.50\n0.47\n0.06\n0.37\n0.58\n    chronic_one\nchronic_one_short\nsoc\n5\n23\n0.22\n0.39\n0.05\n0.29\n0.49\n    chronic_two\nchronic_na\nchronic_na\n2\n2\n1.00\n0.68\n0.13\n0.39\n0.90\n    chronic_two\nchronic_na\nrif\n2\n2\n1.00\n0.74\n0.12\n0.47\n0.92\n    chronic_two\nchronic_na\nsoc\n1\n1\n1.00\n0.67\n0.13\n0.39\n0.89\n    chronic_two\nchronic_two_long\nchronic_na\n20\n34\n0.59\n0.68\n0.04\n0.59\n0.77\n    chronic_two\nchronic_two_long\nrif\n11\n16\n0.69\n0.75\n0.04\n0.66\n0.83\n    chronic_two\nchronic_two_long\nsoc\n12\n15\n0.80\n0.68\n0.05\n0.58\n0.77\n    chronic_two\nchronic_two_short\nchronic_na\n17\n37\n0.46\n0.48\n0.05\n0.38\n0.59\n    chronic_two\nchronic_two_short\nrif\n16\n23\n0.70\n0.55\n0.06\n0.44\n0.66\n    chronic_two\nchronic_two_short\nsoc\n6\n12\n0.50\n0.47\n0.06\n0.36\n0.58\n    \n      chronic - hip\n    \n    chronic_na\nchronic_na\nchronic_na\n5\n9\n0.56\n0.30\n0.09\n0.14\n0.50\n    chronic_na\nchronic_na\nrif\n1\n3\n0.33\n0.36\n0.11\n0.18\n0.59\n    chronic_na\nchronic_na\nsoc\n0\n1\n0.00\n0.29\n0.09\n0.14\n0.51\n    chronic_one\nchronic_na\nchronic_na\n0\n1\n0.00\n0.37\n0.14\n0.13\n0.65\n    chronic_one\nchronic_na\nrif\n1\n3\n0.33\n0.44\n0.14\n0.18\n0.72\n    chronic_one\nchronic_na\nsoc\n1\n3\n0.33\n0.37\n0.13\n0.13\n0.65\n    chronic_one\nchronic_one_long\nchronic_na\n4\n18\n0.22\n0.27\n0.04\n0.19\n0.36\n    chronic_one\nchronic_one_long\nrif\n1\n11\n0.09\n0.33\n0.05\n0.24\n0.43\n    chronic_one\nchronic_one_long\nsoc\n2\n15\n0.13\n0.26\n0.04\n0.19\n0.35\n    chronic_one\nchronic_one_short\nchronic_na\n7\n26\n0.27\n0.26\n0.04\n0.18\n0.35\n    chronic_one\nchronic_one_short\nrif\n2\n6\n0.33\n0.33\n0.05\n0.24\n0.43\n    chronic_one\nchronic_one_short\nsoc\n3\n15\n0.20\n0.26\n0.04\n0.18\n0.35\n    chronic_two\nchronic_na\nchronic_na\n0\n2\n0.00\n0.55\n0.15\n0.26\n0.83\n    chronic_two\nchronic_na\nrif\n1\n2\n0.50\n0.62\n0.14\n0.33\n0.87\n    chronic_two\nchronic_na\nsoc\n1\n2\n0.50\n0.54\n0.15\n0.25\n0.82\n    chronic_two\nchronic_two_long\nchronic_na\n17\n31\n0.55\n0.54\n0.05\n0.44\n0.65\n    chronic_two\nchronic_two_long\nrif\n7\n9\n0.78\n0.62\n0.05\n0.51\n0.72\n    chronic_two\nchronic_two_long\nsoc\n5\n8\n0.62\n0.54\n0.06\n0.43\n0.65\n    chronic_two\nchronic_two_short\nchronic_na\n6\n21\n0.29\n0.34\n0.05\n0.25\n0.44\n    chronic_two\nchronic_two_short\nrif\n1\n7\n0.14\n0.41\n0.06\n0.30\n0.52\n    chronic_two\nchronic_two_short\nsoc\n3\n9\n0.33\n0.33\n0.05\n0.23\n0.43\n  \n  \n  \n\nTable 8:  Demo - summary of joint posterior, estimates of risk by strata and\nallocation"
  },
  {
    "objectID": "notebooks/modelling.html#discussion-points",
    "href": "notebooks/modelling.html#discussion-points",
    "title": "Modelling approaches",
    "section": "Discussion points",
    "text": "Discussion points\n\nRelevance to estimands of interest\nLimitations, alternatives:\n\nCollapse across some strata\nCommon parameters\nPooling nested parameters\nPartial pooling estimates, e.g. revision broken up into one and two stage\n\nComplications associated with additional adjustment (time, site, prognostic, design effects)\nCompatibility with varying randomisation weights\nMeasures of effect\n\n\nIndependent domain models\nBubble, todo\n\n\nShared models\nBubble, todo\n\nForms of pooling\nBubble, todo"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Welcome",
    "section": "",
    "text": "Notes, data summaries and simulation results for ROADMAP."
  },
  {
    "objectID": "notebooks/about.html#repository-status",
    "href": "notebooks/about.html#repository-status",
    "title": "About",
    "section": "Repository status",
    "text": "Repository status\nDetails on GitHub repository files, tags, commits follow:\n\n\nCode\nrepo &lt;- git2r::repository(path = \".\")\nsummary(repo)\n\n\nLocal:    main /Users/mark/Documents/project/roadmap/src/roadmap-sim\nRemote:   main @ origin (https://github.com/maj-biostat/roadmap-sim.git)\nHead:     [95ec688] 2023-12-05: Add discussion points\n\nBranches:         2\nTags:             0\nCommits:         10\nContributors:     1\nStashes:          0\nIgnored files:    5\nUntracked files:  6\nUnstaged files:   0\nStaged files:     0\n\nLatest commits:\n[95ec688] 2023-12-05: Add discussion points\n[d0c18ff] 2023-12-05: Add discussion points\n[9127ae8] 2023-12-05: Minor editorial\n[19f9757] 2023-12-05: Just added repo details\n[b13f415] 2023-12-05: Reordered menu"
  },
  {
    "objectID": "notebooks/data-01.html#data-summaries",
    "href": "notebooks/data-01.html#data-summaries",
    "title": "Simulated data summaries",
    "section": "Data summaries",
    "text": "Data summaries\nThe following tables provides indicative patient numbers per treatment under each domain (surgical, antibiotic duration, antibiotic type) with notes on assignment mechanism.\n\n\nCode\ndb &lt;- dbConnect(RSQLite::SQLite(), g_cfg$db_name)\nd_qry &lt;- dbSendQuery(db, \"SELECT * FROM v_surg WHERE sim = ?\")\ndbBind(d_qry, list(1))\nd &lt;- data.table(dbFetch(d_qry))\ndbClearResult(d_qry)\ndbDisconnect(db)\n\nd &lt;- d[, .(silo, surg, y, N, note)]\n\ncols &lt;- c(\"Response\", \"N\", \"Note\")\nnames(cols) &lt;- c(\"y\", \"N\", \"note\")\n\ngt_tbl &lt;- d |&gt; \n  gt(\n    rowname_col = \"surg\",\n    groupname_col = \"silo\"\n  ) |&gt;\n  grand_summary_rows(\n    columns = c(\"y\", \"N\"),\n    fns = list(\n      Total ~ sum(., na.rm = T)\n    )\n  ) |&gt; \n  cols_width(\n    starts_with(\"surg\") ~ px(150)\n  ) |&gt; \n  cols_label(.list = cols) \n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n    \n    \n  \n  \n    \n    \n      \n      Response\n      N\n      Note\n    \n  \n  \n    \n      chronic\n    \n    one\n174\n253\nRandomised\n    two\n190\n273\nRandomised\n    \n      early_acute\n    \n    dair\n551\n761\nNot randomised\n    \n      late_acute\n    \n    dair\n435\n625\nRandomised\n    one\n207\n292\nRandomised as revision\n    two\n211\n296\nRandomised as revision\n    Total\n1768\n2500\n—\n  \n  \n  \n\nTable 1:  Surgical domain - patients and outcomes by silo and treatment. \n\n\n\n\n\nCode\ndb &lt;- dbConnect(RSQLite::SQLite(), g_cfg$db_name)\nd_qry &lt;- dbSendQuery(db, \"SELECT * FROM v_abdu WHERE sim = ?\")\ndbBind(d_qry, list(1))\nd &lt;- data.table(dbFetch(d_qry))\ndbClearResult(d_qry)\ndbDisconnect(db)\n\nd &lt;- d[, .(silo, surg, abdu, y, N, note)]\n\ncols &lt;- c(\"Response\", \"N\", \"Note\")\nnames(cols) &lt;- c(\"y\", \"N\", \"note\")\n\ngt_tbl &lt;- d |&gt; \n  gt(\n    rowname_col = \"abdu\",\n    groupname_col = c(\"silo\", \"surg\")\n  ) |&gt;\n  grand_summary_rows(\n    columns = c(\"y\", \"N\"),\n    fns = list(\n      Total ~ sum(., na.rm = T)\n    )\n  ) |&gt; \n  cols_width(\n    starts_with(\"abdu\") ~ px(150)\n  ) |&gt; \n  cols_label(.list = cols)\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n    \n    \n  \n  \n    \n    \n      \n      Response\n      N\n      Note\n    \n  \n  \n    \n      chronic - one\n    \n    long\n89\n127\nRandomised\n    shrt\n85\n126\nRandomised\n    \n      chronic - two\n    \n    long\n97\n144\nRandomised\n    shrt\n93\n129\nRandomised\n    \n      early_acute - dair\n    \n    long\n551\n761\nNot randomised\n    \n      late_acute - dair\n    \n    long\n435\n625\nNot randomised\n    \n      late_acute - one\n    \n    long\n101\n140\nRandomised\n    shrt\n106\n152\nRandomised\n    \n      late_acute - two\n    \n    long\n102\n134\nRandomised\n    shrt\n109\n162\nRandomised\n    Total\n1768\n2500\n—\n  \n  \n  \n\nTable 2:  Antibiotic duration domain (conditional on surgical procedure for\nlate acute) - patients and outcomes by silo and treatment. \n\n\n\n\n\nCode\ndb &lt;- dbConnect(RSQLite::SQLite(), g_cfg$db_name)\nd_qry &lt;- dbSendQuery(db, \"SELECT * FROM v_abty WHERE sim = ?\")\ndbBind(d_qry, list(1))\nd &lt;- data.table(dbFetch(d_qry))\ndbClearResult(d_qry)\ndbDisconnect(db)\n\nd &lt;- d[, .(silo, abty, y, N, note)]\n\ncols &lt;- c(\"Response\", \"N\", \"Note\")\nnames(cols) &lt;- c(\"y\", \"N\", \"note\")\n\ngt_tbl &lt;- d |&gt; \n  gt(\n    rowname_col = \"abty\",\n    groupname_col = c(\"silo\")\n  ) |&gt;\n  grand_summary_rows(\n    columns = c(\"y\", \"N\"),\n    fns = list(\n      Total ~ sum(., na.rm = T)\n    )\n  ) |&gt; \n  cols_width(\n    starts_with(\"abty\") ~ px(150)\n  ) |&gt; \n  cols_label(.list = cols)\n\ngt_tbl\n\n\n\n\n\n\n\n  \n    \n    \n    \n    \n  \n  \n    \n    \n      \n      Response\n      N\n      Note\n    \n  \n  \n    \n      chronic\n    \n    rif\n92\n134\nRandomised (gram pos)\n    soc\n87\n133\nRandomised (gram pos)\n    \n      early_acute\n    \n    rif\n139\n182\nRandomised (gram pos)\n    soc\n127\n189\nRandomised (gram pos)\n    \n      late_acute\n    \n    rif\n207\n286\nRandomised (gram pos)\n    soc\n240\n332\nRandomised (gram pos)\n    Total\n892\n1256\n—\n  \n  \n  \n\nTable 3:  Antibiotic type domain (conditional on gram status) - patients and\noutcomes by silo and treatment. \n\n\n\nThe choice of treatment effect (e.g. absolute vs relative) leads to different characterisations of the same phenomenon and implies different heterogeneity."
  }
]
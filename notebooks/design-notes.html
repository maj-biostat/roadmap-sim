<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.542">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-02-02">

<title>ROADMAP - design notes and simulations - Design Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ROADMAP - design notes and simulations</span>
    </a>
  </div>
        <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/maj-biostat/roadmap-sim">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/maj-biostat/roadmap-sim/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks/population-structure.html">Design</a></li><li class="breadcrumb-item"><a href="../notebooks/design-notes.html">Design Notes</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/population-structure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Population structure</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/model-spec.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model specification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/decision-rules.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Decision rules</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/simulation-pars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/trial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulated trial data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/model-implementation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Model implementation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/example-trials.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Example trials</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/sim-design1-results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation results 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/sim-design2-results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation results 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/sim-design3-results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation results 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/sim-design4-results.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simulation results 4</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/design-notes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Design Notes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/misc-notes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Reminders</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../notebooks/about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#surgery" id="toc-surgery" class="nav-link active" data-scroll-target="#surgery">Surgery</a>
  <ul>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  <li><a href="#covariate" id="toc-covariate" class="nav-link" data-scroll-target="#covariate">Covariate</a>
  <ul>
  <li><a href="#example-1" id="toc-example-1" class="nav-link" data-scroll-target="#example-1">Example</a></li>
  </ul></li>
  <li><a href="#unmeasured-confounder" id="toc-unmeasured-confounder" class="nav-link" data-scroll-target="#unmeasured-confounder">Unmeasured Confounder</a></li>
  <li><a href="#checkpoint" id="toc-checkpoint" class="nav-link" data-scroll-target="#checkpoint">Checkpoint</a></li>
  <li><a href="#duration" id="toc-duration" class="nav-link" data-scroll-target="#duration">Duration</a></li>
  <li><a href="#other-domains" id="toc-other-domains" class="nav-link" data-scroll-target="#other-domains">Other Domains</a></li>
  <li><a href="#silos" id="toc-silos" class="nav-link" data-scroll-target="#silos">Silos</a></li>
  <li><a href="#revision-type" id="toc-revision-type" class="nav-link" data-scroll-target="#revision-type">Revision Type</a></li>
  <li><a href="#randomisation-reveal" id="toc-randomisation-reveal" class="nav-link" data-scroll-target="#randomisation-reveal">Randomisation reveal</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../notebooks/population-structure.html">Design</a></li><li class="breadcrumb-item"><a href="../notebooks/design-notes.html">Design Notes</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Design Notes</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 2, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">February 23, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<div class="cell">
<details class="code-fold">
<summary>Setup</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">source</span>(<span class="st">"./R/init.R"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">log_info</span>(<span class="st">"Called design-notes notebook"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Why bother with any of this? One reason is to identify the variables that are relevant to the design and how they relate. This helps us formulate a picture of the joint probability distribution which allows us to simulate data from the assumed data generation process. It also allows us to determine which causal effects we can identify. Even if we model all the domains separately, we still need some kind of joint view of the distribution in order to simulate the data properly and share parameters.</p>
</div>
</div>
</div>
<p>Start by saying we were doing a trial in just the late acute patients. We are interested in surgery (DAIR/revision) and antibiotic duration (long/short), but we are limited in that, for whatever reason, we can not ethically randomise the <em>type</em> of revision surgery, only revision surgery itself.</p>
<p>Choice of antibiotic duration is conditional on the type of revision surgery used, so surgery type needs to be considered in any joint analysis (alternatively, analyse separately).</p>
<p>I just want to work through from a basic scenario to more involved ones to check understanding of potential issues. The following will ignore much of the complexity, but just want to get some basics down as a reference.</p>
<section id="surgery" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="surgery">Surgery</h2>
<p>As a starting point, consider the following:</p>
<ul>
<li>R: randomised surgery - 0: DAIR, 1: revision</li>
<li>S: preferred revision - 0: one-stage, 1: two-stage</li>
<li>A: allocated surgery - 0: DAIR, 1: one-stage, 2: two-stage</li>
<li>Y: treatment success - 0: no, 1: yes</li>
</ul>
<p>Patients are randomised to a surgery type, <span class="math inline">\(R\)</span>: DAIR or revision. For every patient, if they <em>were</em> to have been allocated to revision, there is some preference/plan for one/two stage, <span class="math inline">\(S\)</span>. The value of <span class="math inline">\(S\)</span> is determined by the surgeon/patient and I’m considering it here as just an attribute of the patient.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The above determination is actually dependent on the surgeon’s position as well as patient characteristics. In fact, one may dominate the other. For example, would a surgeon choose two-stage for all their patients simply because they have more experience or sucess with that approach, whereas another might choose one-stage for all theirs?</p>
<p>Note to self - in practice, I actually think that what matters is that we know what selection is rather than what process occurs to decide. Additionally, later we see that this consideration becomes redundant.</p>
</div>
</div>
</div>
<p>The actual allocated treatment is a deterministic function of <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>, i.e.&nbsp;<span class="math inline">\(A = R \times (S + 1)\)</span>. Note that I’m assuming that <span class="math inline">\(S\)</span> is known for <em>every</em> patient before <span class="math inline">\(R\)</span> is revealed to the surgeon, irrespective of whether they are eventually assigned to DAIR or revision (if that it <em>isn’t the case</em> then perhaps some issues might arise, but I don’t think that it matters too much for what’s being considered here given randomisation).</p>
<div class="cell page-columns page-full" data-layout-align="default">
<div class="cell-output-display page-columns page-full">
<div id="fig-scenario-1" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-scenario-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-scenario-1">%%{
  init:{
    "flowchart":{"htmlLabels": "true"},
    "securityLevel": "loose",
    "theme": "base"
}}%%
flowchart LR
  R --&gt; A --&gt; Y
  S --&gt; A 
  S --&gt; Y
  US((U&lt;sub&gt;S)) -.-&gt; S
  UR((U&lt;sub&gt;R)) -.-&gt; R
  UY((U&lt;sub&gt;Y)) -.-&gt; Y
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-scenario-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Scenario 1, the <span class="math inline">\(U\)</span> denote independent exogenous variables
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>There are no back-door paths for the above, hence no open back-door paths</li>
<li><span class="math inline">\(Y\)</span> is caused by/depends on some function of <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>: <span class="math inline">\(Y = f(R,S)\)</span></li>
<li>Assuming <span class="math inline">\(S\)</span> causes <span class="math inline">\(Y\)</span> a weaker/safer assumption than excluding that link.</li>
<li>Maybe there should be some shared <span class="math inline">\(U\)</span> that influences both <span class="math inline">\(S\)</span> and <span class="math inline">\(Y\)</span> rather than assuming <span class="math inline">\(S\)</span> causes <span class="math inline">\(Y\)</span>?</li>
<li>The graph implies:
<ul>
<li><span class="math inline">\(S\)</span> and <span class="math inline">\(R\)</span> are independent; <span class="math inline">\(S \mathrel{\unicode{x2AEB}} R\)</span></li>
<li><span class="math inline">\(Y\)</span> is conditionally independent of <span class="math inline">\(R\)</span> given <span class="math inline">\(A\)</span> and <span class="math inline">\(S\)</span>; <span class="math inline">\(Y \mathrel{\unicode{x2AEB}} R | A, S\)</span></li>
</ul></li>
<li>We can estimate the total effect of <span class="math inline">\(R\)</span> on <span class="math inline">\(Y\)</span> where <span class="math inline">\(R = 1\)</span> is loosely defined as revision with expert selection of one-stage or two-stage procedure (or something along those lines)</li>
<li>Think planned/intended procedure should be recorded prior to any elements of randomisation being revealed.</li>
<li>No adjustment is required to estimate the total effect of <span class="math inline">\(R\)</span> on <span class="math inline">\(Y\)</span></li>
</ul>
</div>
</div>
</div>
<p>Our <em>intervention</em> is on <span class="math inline">\(R\)</span>, everything down stream from that (revision type, antibiotic use, physiotherapy, complications) is a consequence of the intervention. It’s the overall effect of allocation to <span class="math inline">\(R=0\)</span> or <span class="math inline">\(R=1\)</span> that we are trying to (the only thing we can, not necessarily want to) compare.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Isn’t revision-type independent of intervention? I don’t think I understand why it is downstream.</li>
<li>Not really sure what is meant by the statement <em>the only thing we can, not necessarily want to compare</em></li>
</ul>
</div>
</div>
</div>
<p>If <span class="math inline">\(Y(a)\)</span> is the potential outcome of a patient under surgery of type <span class="math inline">\(a\)</span> (dair, one-stage, two-stage), then:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}[Y(a)] &amp;= \mathbb{E}[Y(a)|R=0] \\
&amp;= \mathbb{E}[Y(a) | R=1] \\
&amp;= \mathbb{E}[Y(a) | A = 0] \\
&amp;= \mathbb{E}[Y(a) | A \in \{1,2\}] \\
&amp;\ne \mathbb{E}[Y(a) | A = j], \quad j\in\{1,2\} \\
\end{aligned}
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<ul>
<li>Above we establish exchangeability assumptions, which are a partial requirement for identifying causal effects, i.e.&nbsp;it gets you to <span class="math inline">\(\mathbb{E}[Y(1)] = \mathbb{E}[Y|A=1]\)</span> and <span class="math inline">\(\mathbb{E}[Y(0)] = \mathbb{E}[Y|A=0]\)</span> whereby you are learning about the potential outcomes from the observed data.</li>
<li>All come about due to randomisation of <span class="math inline">\(R\)</span>.</li>
<li>Where independence holds (as above for the majority of the cases) knowing the conditioning variable tells you nothing about <span class="math inline">\(Y(a)\)</span> (the term on the LHS of the conditioning).</li>
<li>For example <span class="math inline">\(\mathbb{E}[Y(a)] = \mathbb{E}[Y(a)|R=0]\)</span> tells us that the potential outcomes of <span class="math inline">\(Y(a)\)</span> in those receive dair have the same distribution as those that do not.</li>
<li>For <span class="math inline">\(\mathbb{E}[Y(a)] \ne \mathbb{E}[Y(a) | A = 1]\)</span> and <span class="math inline">\(\mathbb{E}[Y(a)] \ne \mathbb{E}[Y(a) | A = 2]\)</span> we are saying that the distribution of potential outcomes in those for whom one-stage is planned do not share the same distribtion as for those for whom one-stage is not planned. And this is by virtue of the fact that revision type is selected rather than randomised.</li>
</ul>
</div>
</div>
</div>
<p>The only randomised comparison we can make is <span class="math inline">\(R=1\)</span> vs <span class="math inline">\(R=0\)</span>, but, given we want to eventually condition on which revision type is selected, we want to include terms for preferred revision type in the model. Assume logistic regression is the true model and specify</p>
<p><span id="eq-dn-1"><span class="math display">\[
\begin{align}
\mathbb{E}[Y | R] &amp;= Pr(Y = 1 | R) = \text{expit}(\alpha_0 + \alpha_1R) \\
\end{align}
\tag{1}\]</span></span></p>
<p><span id="eq-dn-2"><span class="math display">\[
\begin{align}
\mathbb{E}[Y | A] &amp;= Pr(Y = 1 | A) = \text{expit}(\beta_0 + \beta_1\mathbb{I}(A=1) + \beta_2\mathbb{I}(A=2)) \\
\end{align}
\tag{2}\]</span></span></p>
<p>Equivalently, state in terms of <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>.</p>
<p><span id="eq-dn-3"><span class="math display">\[
\mathbb{E}[Y | R, S] = \text{expit}(\beta_0 + \beta_1R + \beta_2RS) \\
\tag{3}\]</span></span></p>
<p><a href="#eq-dn-1" class="quarto-xref">Equation&nbsp;1</a> targets the thing we actually want to compare, the log-odds ratio of revision versus DAIR. <a href="#eq-dn-3" class="quarto-xref">Equation&nbsp;3</a> splits this out into one and two stage which we would need to combine to get the overall revision effect. In <a href="#eq-dn-3" class="quarto-xref">Equation&nbsp;3</a>, the <span class="math inline">\(\beta_1\)</span> gives the effect of revision under a one-stage procedure and the <span class="math inline">\(\beta_2\)</span> gives the increment on that term when a two-stage procedure is undertaken. Some weighted combination of these terms will give us a view of the aggregated effect of revision.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>What isn’t directly stated above is that the (primary?) reason we need to split <span class="math inline">\(R\)</span> into one-stage and two-stage effects is so that we can incorporate the duration domain within a single model. The randomised interventions for duration are 12 weeks vs 6 weeks antibiotics for those receiving one-stage surgery and 12 weeks vs 7 days for those receiving two-stage surgery. If a patient received one-stage, the duration intervention parameters associated with two-stage are mostly irrelevant to estimating the log-odds of treatment success for this patient. Moreover, the response for the one-stage patient does not inform the two-stage duration intervention effects. To accommodate this, the one-stage and two-stage duration parameters enter the model independently, e.g.</p>
<p><span class="math display">\[
\mathbb{E}[Y | R, S] = \text{expit}(\beta_0 + \beta_1 \mathbb{I}(R = \text{one-stage} \land D = short) + \beta_2 \mathbb{I}(R = \text{two-stage} \land D = short)) \\
\]</span></p>
<p>However, this means that the duration domain reference group for the one-stage and two-stage duration effects have the same log-odds of treatment success and this is very unlikely to be the case. Thus, by splitting <span class="math inline">\(R\)</span> into one-stage and two-stage effects we allow the reference groups for the one-stage and two-stage duration effects to vary.</p>
</div>
</div>
</div>
<p>These models could also adjust for <span class="math inline">\(S\)</span>, i.e.&nbsp;in addition to any actual <em>effect</em> of one/two stage revision, the patients for whom a two-stage would be preferred may differ from those for who a one-stage is the preference. Interpretation of model parameters then changes of course.</p>
<p><span id="eq-dn-4"><span class="math display">\[
\mathbb{E}[Y | R, S] = \text{expit}(\beta_0 + \beta_1R + \beta_2RS + \beta_3S) \\
\tag{4}\]</span></span></p>
<p>We don’t really care about the difference due to <span class="math inline">\(S\)</span>, as the revision type effects may still be confounded by other factors anyway. Due to the randomisation, I think that both the version with and without <span class="math inline">\(S\)</span> are targeting the same estimand for revision vs.&nbsp;DAIR (the distribution of <span class="math inline">\(S\)</span> is the same (in expectation) amongst DAIR and revision patients, so is not a confounder, but obviously, <span class="math inline">\(S\)</span> is known exactly to be <span class="math inline">\(A-1\)</span> when <span class="math inline">\(R=1\)</span>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>I think what you are proposing for the <span class="math inline">\(\beta_3\)</span> term (the effect of <span class="math inline">\(S\)</span>) boils down to the following:</p>
<ol type="1">
<li>the effect of <span class="math inline">\(S\)</span>, clinical selection of one-stage vs two-stage may be confounded and we can probably do very little about that</li>
<li>however, the estimate we obtain for <span class="math inline">\(\beta_3\)</span> would be the same in the group that received revision as the group that did not due to the fact that dair vs revision was randomised</li>
</ol>
<p>Probably incorrectly, I think the selection effect is meaningless in the sense that receiving dair contradicts the possibility of a selection. It is analogous to a model for number of children whereby you make an adjustment for (randomised) marriage and (self-selected) age of marriage. The main effect of age of marriage is excluded, on the basis that it has no counterpart in reality and therefore no way to inform the effect.</p>
<p>What is the counter-argument? Perhaps something along the lines of:</p>
<p>To justify the inclusion of <span class="math inline">\(\beta_3\)</span> we argue that the married and the non-married groups are balanced across age (and all other characteristics). Therefore, the married and unmarried groups are similar and the effect for age of married in the group is portable to the group that were <em>not</em> randomised to marriage, in the counterfactual world where they had been.</p>
<p>Ok, think I have convinced myself (if perhaps no-one else) that it makes sense.</p>
</div>
</div>
</div>
<p>For the second model above, in terms of <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>, without adjustment for <span class="math inline">\(S\)</span></p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}[Y | R] &amp;= \mathbb{E}[\mathbb{E}[Y | S, R] | R] \\
&amp;= \sum_{s=0}^1 \text{expit}(\beta_0 + \beta_1R + \beta_2Rs)\mathbb{P}(S = s | R) \\
\mathbb{E}[Y|R =0] &amp;= \text{expit}(\beta_0) \\
\mathbb{E}[Y|R = 1] &amp;=  \text{expit}(\beta_0 + \beta_1)\mathbb{P}(S=0|R=1) \\
&amp; \quad \ + \text{expit}(\beta_0 + \beta_1 + \beta_2)\mathbb{P}(S=1|R=1)
\end{aligned}
\]</span></p>
<p>so the log-odds ratio for the marginal success probability for revision vs.&nbsp;DAIR is</p>
<p><span id="eq-dn-5"><span class="math display">\[
\begin{aligned}
\ln\frac{\text{odds}(Y|R=1)}{\text{odds}(Y|R=0)} &amp;= \text{logit}[\text{expit}(\beta_0 + \beta_1)\mathbb{P}(S=0|R=1) + \\  
&amp; \quad \quad \ \text{expit}(\beta_0 + \beta_1 + \beta_2)\mathbb{P}(S=1|R=1)] -  \beta_0
\end{aligned}
\tag{5}\]</span></span></p>
<p>We don’t know <span class="math inline">\(\mathbb{P}(S=s|R)\)</span> so estimate it from the sample. Due to randomisation <span class="math inline">\(\mathbb{P}(S=s|R) = \mathbb{P}(S=s)\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Which is just creating a standardised probability of treatment success under revision based on a weighted version of the probability of treatment success for each of the selection groups (one-stage and two-stage) where the weights are formed from the (unknown) distribution of <span class="math inline">\(S\)</span> (estimated from the sample). The standardised probability of treatment success under revision is then converted to the log odds of treatment success and the reference group (DAIR) log-odds of treatment success is subtracted to come up with the log-OR.</p>
<p>The final line in the above derivation is just saying that we can assume that the probability distribution of <span class="math inline">\(S\)</span> is independent to treatment group membership and so can be estimated from the full sample rather than condition on <span class="math inline">\(R\)</span>. Note that <span class="math inline">\(\mathbb{P}(S=s)\)</span> is not necessarily indicative of the probability distribution of <span class="math inline">\(S\)</span> in the population because of our convenience sample, but this is true for all inference here and in the majority of trials.</p>
</div>
</div>
</div>
<p>An alternative to the above is to consider the “average” conditional log-odds ratio rather than the odds ratio of the marginal probabilities.</p>
<p><span id="eq-dn-6"><span class="math display">\[
\mathbb{E}\left[\ln\frac{\text{odds}(Y|R=1,S)}{\text{odds}(Y|R=0,S)}\right] = \mathbb{E}[\beta_1 + \beta_2S] = \beta_1 + \beta_2\mathbb{E}[S]
\tag{6}\]</span></span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The expectation of <span class="math inline">\(S\)</span> above is across the sample, but below the weighting is taken from the revision group. Would it not be preferable to use the mean derived from the full sample or am I thinking about it incorrectly?</p>
</div>
</div>
</div>
<p>If the model also adjusts for <span class="math inline">\(S\)</span>, then</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}[Y | R] &amp;= \mathbb{E}[\mathbb{E}[Y | S, R] | R] \\
&amp;= \sum_{s=0}^1 \text{expit}(\beta_0 + \beta_1R + \beta_2Rs + \beta_3s)\mathbb{P}(S = s | R) \\
\mathbb{E}[Y|R = 0] &amp;= \text{expit}(\beta_0)\mathbb{P}(S = 0 | R=0) + \text{expit}(\beta_0 + \beta_3)\mathbb{P}(S=1|R=0)\\
\mathbb{E}[Y|R = 1] &amp;= \text{expit}(\beta_0 + \beta_1)\mathbb{P}(S = 0 | R = 1) + \text{expit}(\beta_0 + \beta_1 + \beta_2 + \beta_3)\mathbb{P}(S=1 | R = 1) \\
\ln\frac{\text{odds}(Y|R=1)}{\text{odds}(Y|R=0)} &amp;= \text{logit}(\mathbb{E}[Y|R = 1]) - \text{logit}(\mathbb{E}[Y|R = 0])
\end{aligned}
\]</span></p>
<p>With the introduction of a main effect for <span class="math inline">\(S\)</span> we can still report on the average conditional log-odds ratio in the same form as previously:</p>
<p><span class="math display">\[
\mathbb{E}\left[\ln\frac{\text{odds}(Y|R=1,S)}{\text{odds}(Y|R=0,S)}\right] = \mathbb{E}[\beta_1 + \beta_2S] = \beta_1 + \beta_2\mathbb{E}[S]
\]</span></p>
<p>i.e.&nbsp;with the same terms as without adjustment for <span class="math inline">\(S\)</span>. However, the treatment effect parameter estimates produced from the model that includes the main effect for <span class="math inline">\(S\)</span> (and the interaction term) and the model that only has the interaction term, are likely be different.</p>
<section id="example" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>Herein I am just assuming <span class="math inline">\(n\approx \infty\)</span>, i.e.&nbsp;checking consistency.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Consistency is simply about whether the estimator produces an estimate that gets closer towards the true value as the sample size gets bigger; a consistent estimator does not negate the possibility of bias. For example, <span class="math inline">\(\frac{1}{N-1}\sum_i (x_i)\)</span> is a consistent but biased estimator of the mean for a random vector, <span class="math inline">\(x\)</span>.</p>
<p>The default parameterisation for the data generating mechanism is to adopt the functional form from <a href="#eq-dn-4" class="quarto-xref">Equation&nbsp;4</a>, which includes terms for <span class="math inline">\(R\)</span>, <span class="math inline">\(S\)</span> and an interaction between <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Generate data scenario 1</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Assume ~ infinite population as just checking consistency</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># Precision will of course vary by approach at small sample sizes</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>generate_data_1 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="at">n =</span> <span class="dv">1000000</span>,</span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="at">f =</span> <span class="cf">function</span>(r, s, x){<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> s <span class="sc">+</span> <span class="fl">0.25</span> <span class="sc">*</span> r <span class="sc">+</span> <span class="fl">0.25</span> <span class="sc">*</span> r <span class="sc">*</span> s}) {</span>
<span id="cb2-6"><a href="#cb2-6"></a>  s <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.7</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a>  r <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb2-8"><a href="#cb2-8"></a>  x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.25</span>)</span>
<span id="cb2-9"><a href="#cb2-9"></a>  a <span class="ot">&lt;-</span> r <span class="sc">*</span> (s <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb2-10"><a href="#cb2-10"></a>  y0 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="fu">f</span>(<span class="dv">0</span>, s, x)))</span>
<span id="cb2-11"><a href="#cb2-11"></a>  y1 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="fu">f</span>(<span class="dv">1</span>, s, x)))</span>
<span id="cb2-12"><a href="#cb2-12"></a>  y <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> r) <span class="sc">*</span> y0 <span class="sc">+</span> r <span class="sc">*</span> y1</span>
<span id="cb2-13"><a href="#cb2-13"></a>  w <span class="ot">&lt;-</span> <span class="fu">mean</span>(s) <span class="co"># Selection probability</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>  D <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">r =</span> r, <span class="at">x =</span> x, <span class="at">s =</span> s, <span class="at">a =</span> a, <span class="at">y0 =</span> y0, <span class="at">y1 =</span> y1, <span class="at">y =</span> y)[</span>
<span id="cb2-15"><a href="#cb2-15"></a>    ,</span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb2-17"><a href="#cb2-17"></a>      <span class="at">r_fac =</span> <span class="fu">factor</span>(r),</span>
<span id="cb2-18"><a href="#cb2-18"></a>      <span class="at">a_fac =</span> <span class="fu">factor</span>(a),</span>
<span id="cb2-19"><a href="#cb2-19"></a>      <span class="at">s_fac =</span> <span class="fu">factor</span>(s),</span>
<span id="cb2-20"><a href="#cb2-20"></a>      <span class="at">a_cen =</span> r <span class="sc">*</span> (a <span class="sc">-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">mean</span>(a[r <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>)),</span>
<span id="cb2-21"><a href="#cb2-21"></a>      <span class="at">s_cen =</span> s <span class="sc">-</span> <span class="fu">mean</span>(s)</span>
<span id="cb2-22"><a href="#cb2-22"></a>    )</span>
<span id="cb2-23"><a href="#cb2-23"></a>  ]</span>
<span id="cb2-24"><a href="#cb2-24"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Simulate null effect</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>D <span class="ot">&lt;-</span> <span class="fu">generate_data_1</span>(<span class="at">f =</span> <span class="cf">function</span>(r, s, x){<span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> s})</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># Eqn 1</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># Eqn 3</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> r<span class="sc">:</span>s, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb3-9"><a href="#cb3-9"></a></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="co"># Eqn 6?</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>fit1s <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> s, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="co"># Eqn 4</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>fit2s <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> s, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>In the use of “true” below, what is meant is the empirical log-odds ratios in the population (approximated by a very large sample) that we observe. We estimate the effects directly from the data by calculating the difference in the log-odds of treatment success in the strata of interest for those in the treated vs control groups.</p>
<p>The table just tries to line up the quantities, like with like as there were some minor differences in the naming.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Null effect quantities</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>w <span class="ot">&lt;-</span> <span class="fu">mean</span>(D<span class="sc">$</span>a <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">mean</span>(D<span class="sc">$</span>a <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb4-2"><a href="#cb4-2"></a>w_s1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>s <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>w_s2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>s <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a>b1 <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">coef</span>(fit1))</span>
<span id="cb4-6"><a href="#cb4-6"></a>b2 <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">coef</span>(fit2))</span>
<span id="cb4-7"><a href="#cb4-7"></a>b1s <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">coef</span>(fit1s))</span>
<span id="cb4-8"><a href="#cb4-8"></a>b2s <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">coef</span>(fit2s))</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a>EY_R0_2 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2[<span class="dv">1</span>])</span>
<span id="cb4-11"><a href="#cb4-11"></a>EY_R1_2 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> <span class="fu">expit</span>(b2[<span class="dv">1</span>] <span class="sc">+</span> b2[<span class="dv">2</span>]) <span class="sc">+</span> w <span class="sc">*</span> <span class="fu">expit</span>(b2[<span class="dv">1</span>] <span class="sc">+</span> b2[<span class="dv">2</span>] <span class="sc">+</span> b2[<span class="dv">3</span>])</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a>EY_R0_1_S0 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b1s[<span class="dv">1</span>])</span>
<span id="cb4-14"><a href="#cb4-14"></a>EY_R0_1_S1 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b1s[<span class="dv">1</span>] <span class="sc">+</span> b1s[<span class="dv">3</span>])</span>
<span id="cb4-15"><a href="#cb4-15"></a>EY_R1_1_S0 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b1s[<span class="dv">1</span>] <span class="sc">+</span> b1s[<span class="dv">2</span>])</span>
<span id="cb4-16"><a href="#cb4-16"></a>EY_R1_1_S1 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b1s[<span class="dv">1</span>] <span class="sc">+</span> b1s[<span class="dv">2</span>] <span class="sc">+</span> b1s[<span class="dv">3</span>])</span>
<span id="cb4-17"><a href="#cb4-17"></a>EY_R0_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_s1) <span class="sc">*</span> EY_R0_1_S0 <span class="sc">+</span> w_s1 <span class="sc">*</span> EY_R0_1_S1</span>
<span id="cb4-18"><a href="#cb4-18"></a>EY_R1_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_s2) <span class="sc">*</span> EY_R1_1_S0 <span class="sc">+</span> w_s2 <span class="sc">*</span> EY_R1_1_S1</span>
<span id="cb4-19"><a href="#cb4-19"></a></span>
<span id="cb4-20"><a href="#cb4-20"></a>EY_R0_2s_S0 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2s[<span class="dv">1</span>])</span>
<span id="cb4-21"><a href="#cb4-21"></a>EY_R0_2s_S1 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2s[<span class="dv">1</span>] <span class="sc">+</span> b2s[<span class="dv">3</span>])</span>
<span id="cb4-22"><a href="#cb4-22"></a>EY_R1_2s_S0 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2s[<span class="dv">1</span>] <span class="sc">+</span> b2s[<span class="dv">2</span>]) <span class="co"># Pr(A = 2 | S = 0) = 0</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>EY_R1_2s_S1 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2s[<span class="dv">1</span>] <span class="sc">+</span> b2s[<span class="dv">2</span>] <span class="sc">+</span> b2s[<span class="dv">3</span>] <span class="sc">+</span> b2s[<span class="dv">4</span>]) <span class="co"># Pr(A = 2 | S = 1) = 1</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>EY_R0_2s <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_s1) <span class="sc">*</span> EY_R0_2s_S0 <span class="sc">+</span> w_s1 <span class="sc">*</span> EY_R0_2s_S1</span>
<span id="cb4-25"><a href="#cb4-25"></a>EY_R1_2s <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_s2) <span class="sc">*</span> EY_R1_2s_S0 <span class="sc">+</span> w_s2 <span class="sc">*</span> EY_R1_2s_S1</span>
<span id="cb4-26"><a href="#cb4-26"></a></span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="fu">rbind</span>(</span>
<span id="cb4-28"><a href="#cb4-28"></a>  <span class="st">"True conditional (S = 0) log-odds ratio"</span> <span class="ot">=</span></span>
<span id="cb4-29"><a href="#cb4-29"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb4-30"><a href="#cb4-30"></a>  <span class="st">"True conditional (S = 1) log-odds ratio"</span> <span class="ot">=</span></span>
<span id="cb4-31"><a href="#cb4-31"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)),</span>
<span id="cb4-32"><a href="#cb4-32"></a>  <span class="st">"True marginal log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb4-33"><a href="#cb4-33"></a>  <span class="st">"True weighted log-odds ratio"</span> <span class="ot">=</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>    (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[a <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">+</span> w <span class="sc">*</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[a <span class="sc">==</span> <span class="dv">2</span>]<span class="sc">$</span>y)) <span class="sc">-</span></span>
<span id="cb4-35"><a href="#cb4-35"></a>      <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb4-36"><a href="#cb4-36"></a>  <span class="st">"True average weighted log-odds ratio"</span> <span class="ot">=</span></span>
<span id="cb4-37"><a href="#cb4-37"></a>    (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> (<span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y))) <span class="sc">+</span></span>
<span id="cb4-38"><a href="#cb4-38"></a>      w <span class="sc">*</span> (<span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y))),</span>
<span id="cb4-39"><a href="#cb4-39"></a>  <span class="st">"fit1 marginal log-odds ratio"</span> <span class="ot">=</span> b1[<span class="dv">2</span>],</span>
<span id="cb4-40"><a href="#cb4-40"></a>  <span class="st">"fit2 marginal log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_2) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2),</span>
<span id="cb4-41"><a href="#cb4-41"></a>  <span class="st">"fit2 conditional (weighted) log-odds ratio"</span> <span class="ot">=</span> b2[<span class="dv">2</span>] <span class="sc">+</span> w <span class="sc">*</span> b2[<span class="dv">3</span>],</span>
<span id="cb4-42"><a href="#cb4-42"></a>  <span class="st">"fit1s conditional log-odds ratio"</span> <span class="ot">=</span> b1s[<span class="dv">2</span>], <span class="co"># Don't know what this targets</span></span>
<span id="cb4-43"><a href="#cb4-43"></a>  <span class="st">"fit1s marginal log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_1) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_1),</span>
<span id="cb4-44"><a href="#cb4-44"></a>  <span class="st">"fit2s conditional (S = 0) log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_2s_S0) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s_S0),</span>
<span id="cb4-45"><a href="#cb4-45"></a>  <span class="st">"fit2s conditional (S = 1) log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_2s_S1) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s_S1),</span>
<span id="cb4-46"><a href="#cb4-46"></a>  <span class="st">"fit2s marginal log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_2s) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s),</span>
<span id="cb4-47"><a href="#cb4-47"></a>  <span class="st">"fit2s average (weighted) log-odds ratio"</span> <span class="ot">=</span> b2s[<span class="dv">2</span>] <span class="sc">+</span> w <span class="sc">*</span> b2s[<span class="dv">4</span>]</span>
<span id="cb4-48"><a href="#cb4-48"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                   [,1]
True conditional (S = 0) log-odds ratio    -0.003882742
True conditional (S = 1) log-odds ratio     0.003222299
True marginal log-odds ratio                0.002568068
True weighted log-odds ratio               -0.018727631
True average weighted log-odds ratio        0.001097800
fit1 marginal log-odds ratio                0.002568068
fit2 marginal log-odds ratio                0.002568068
fit2 conditional (weighted) log-odds ratio -0.018727631
fit1s conditional log-odds ratio            0.001436139
fit1s marginal log-odds ratio               0.002568068
fit2s conditional (S = 0) log-odds ratio   -0.003882742
fit2s conditional (S = 1) log-odds ratio    0.003222299
fit2s marginal log-odds ratio               0.002568068
fit2s average (weighted) log-odds ratio     0.001097800</code></pre>
</div>
<details class="code-fold">
<summary>Null effect quantities</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>d_out <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="at">desc =</span> <span class="fu">c</span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="st">"conditional (S = 0) log-OR"</span>,</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="st">"conditional (S = 1) log-OR"</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="st">"conditional log-OR (?)"</span>,</span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="st">"conditional (weighted) log-OR"</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="st">"marginal log-OR"</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>    <span class="st">"weighted log-OR"</span>,</span>
<span id="cb6-9"><a href="#cb6-9"></a>    <span class="st">"average (weighted) log-OR"</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>  ),</span>
<span id="cb6-11"><a href="#cb6-11"></a>  <span class="at">true =</span> <span class="fu">c</span>(</span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)),</span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="cn">NA</span>,  </span>
<span id="cb6-15"><a href="#cb6-15"></a>    <span class="cn">NA</span>,</span>
<span id="cb6-16"><a href="#cb6-16"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb6-17"><a href="#cb6-17"></a>    (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[a <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">+</span> w <span class="sc">*</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[a <span class="sc">==</span> <span class="dv">2</span>]<span class="sc">$</span>y)) <span class="sc">-</span></span>
<span id="cb6-18"><a href="#cb6-18"></a>      <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb6-19"><a href="#cb6-19"></a>    (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> (<span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y))) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20"></a>      w <span class="sc">*</span> (<span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)))</span>
<span id="cb6-21"><a href="#cb6-21"></a>  ),</span>
<span id="cb6-22"><a href="#cb6-22"></a>  <span class="at">fit_1 =</span> <span class="fu">c</span>(</span>
<span id="cb6-23"><a href="#cb6-23"></a>    <span class="cn">NA</span>, </span>
<span id="cb6-24"><a href="#cb6-24"></a>    <span class="cn">NA</span>,  </span>
<span id="cb6-25"><a href="#cb6-25"></a>    <span class="cn">NA</span>,</span>
<span id="cb6-26"><a href="#cb6-26"></a>    <span class="cn">NA</span>, </span>
<span id="cb6-27"><a href="#cb6-27"></a>    b1[<span class="dv">2</span>], </span>
<span id="cb6-28"><a href="#cb6-28"></a>    <span class="cn">NA</span>, </span>
<span id="cb6-29"><a href="#cb6-29"></a>    <span class="cn">NA</span></span>
<span id="cb6-30"><a href="#cb6-30"></a>  ),</span>
<span id="cb6-31"><a href="#cb6-31"></a>  <span class="at">fit_2 =</span> <span class="fu">c</span>(</span>
<span id="cb6-32"><a href="#cb6-32"></a>    <span class="cn">NA</span>, </span>
<span id="cb6-33"><a href="#cb6-33"></a>    <span class="cn">NA</span>,</span>
<span id="cb6-34"><a href="#cb6-34"></a>    <span class="cn">NA</span>, </span>
<span id="cb6-35"><a href="#cb6-35"></a>    b2[<span class="dv">2</span>] <span class="sc">+</span> w <span class="sc">*</span> b2[<span class="dv">3</span>], </span>
<span id="cb6-36"><a href="#cb6-36"></a>    <span class="fu">qlogis</span>(EY_R1_2) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2), </span>
<span id="cb6-37"><a href="#cb6-37"></a>    <span class="cn">NA</span>,</span>
<span id="cb6-38"><a href="#cb6-38"></a>    <span class="cn">NA</span></span>
<span id="cb6-39"><a href="#cb6-39"></a>  ),</span>
<span id="cb6-40"><a href="#cb6-40"></a>  <span class="at">fit_1s =</span> <span class="fu">c</span>(</span>
<span id="cb6-41"><a href="#cb6-41"></a>    <span class="cn">NA</span>, </span>
<span id="cb6-42"><a href="#cb6-42"></a>    <span class="cn">NA</span>, </span>
<span id="cb6-43"><a href="#cb6-43"></a>    b1s[<span class="dv">2</span>],</span>
<span id="cb6-44"><a href="#cb6-44"></a>    <span class="cn">NA</span>,</span>
<span id="cb6-45"><a href="#cb6-45"></a>    <span class="fu">qlogis</span>(EY_R1_1) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_1), </span>
<span id="cb6-46"><a href="#cb6-46"></a>    <span class="cn">NA</span>,</span>
<span id="cb6-47"><a href="#cb6-47"></a>    <span class="cn">NA</span></span>
<span id="cb6-48"><a href="#cb6-48"></a>  ),</span>
<span id="cb6-49"><a href="#cb6-49"></a>  <span class="at">fit_2s =</span> <span class="fu">c</span>(</span>
<span id="cb6-50"><a href="#cb6-50"></a>    <span class="fu">qlogis</span>(EY_R1_2s_S0) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s_S0), </span>
<span id="cb6-51"><a href="#cb6-51"></a>    <span class="fu">qlogis</span>(EY_R1_2s_S1) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s_S1), </span>
<span id="cb6-52"><a href="#cb6-52"></a>    <span class="cn">NA</span>, </span>
<span id="cb6-53"><a href="#cb6-53"></a>    <span class="cn">NA</span>,</span>
<span id="cb6-54"><a href="#cb6-54"></a>    <span class="fu">qlogis</span>(EY_R1_2s) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s),</span>
<span id="cb6-55"><a href="#cb6-55"></a>    <span class="cn">NA</span>,</span>
<span id="cb6-56"><a href="#cb6-56"></a>    b2s[<span class="dv">2</span>] <span class="sc">+</span> w <span class="sc">*</span> b2s[<span class="dv">4</span>]</span>
<span id="cb6-57"><a href="#cb6-57"></a>  )</span>
<span id="cb6-58"><a href="#cb6-58"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Tabulate effect quantities</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>gt_tbl <span class="ot">&lt;-</span> d_out <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="fu">c</span>(<span class="st">"desc"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">"right"</span>, <span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">decimals =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="fu">sub_missing</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">missing_text =</span> <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="st">"80%"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r"</span>,</span>
<span id="cb7-9"><a href="#cb7-9"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit_1)</span>
<span id="cb7-10"><a href="#cb7-10"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + r:s"</span>,</span>
<span id="cb7-13"><a href="#cb7-13"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit_2)</span>
<span id="cb7-14"><a href="#cb7-14"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb7-16"><a href="#cb7-16"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + s"</span>,</span>
<span id="cb7-17"><a href="#cb7-17"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit_1s)</span>
<span id="cb7-18"><a href="#cb7-18"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-19"><a href="#cb7-19"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb7-20"><a href="#cb7-20"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + r:s + s"</span>,</span>
<span id="cb7-21"><a href="#cb7-21"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit_2s)</span>
<span id="cb7-22"><a href="#cb7-22"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb7-23"><a href="#cb7-23"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb7-24"><a href="#cb7-24"></a>    <span class="at">footnote =</span> <span class="fu">md</span>(<span class="st">"Should be labelled *conditional (weighted) log-OR*?"</span>),</span>
<span id="cb7-25"><a href="#cb7-25"></a>    <span class="at">locations =</span> <span class="fu">cells_stub</span>(<span class="at">rows =</span> <span class="fu">c</span>(</span>
<span id="cb7-26"><a href="#cb7-26"></a>      <span class="st">"weighted log-OR"</span></span>
<span id="cb7-27"><a href="#cb7-27"></a>    ))</span>
<span id="cb7-28"><a href="#cb7-28"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-29"><a href="#cb7-29"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb7-30"><a href="#cb7-30"></a>    <span class="at">footnote =</span> <span class="fu">md</span>(<span class="st">"log-OR for R term in model, but interpretation unclear"</span>),</span>
<span id="cb7-31"><a href="#cb7-31"></a>    <span class="at">locations =</span> <span class="fu">cells_stub</span>(<span class="at">rows =</span> <span class="fu">c</span>(</span>
<span id="cb7-32"><a href="#cb7-32"></a>      <span class="st">"conditional log-OR (?)"</span>))</span>
<span id="cb7-33"><a href="#cb7-33"></a>  )</span>
<span id="cb7-34"><a href="#cb7-34"></a>gt_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-dn-null" class="cell quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-dn-null-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="ddidvylqwr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ddidvylqwr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ddidvylqwr thead, #ddidvylqwr tbody, #ddidvylqwr tfoot, #ddidvylqwr tr, #ddidvylqwr td, #ddidvylqwr th {
  border-style: none;
}

#ddidvylqwr p {
  margin: 0;
  padding: 0;
}

#ddidvylqwr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ddidvylqwr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ddidvylqwr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ddidvylqwr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ddidvylqwr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ddidvylqwr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddidvylqwr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ddidvylqwr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ddidvylqwr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ddidvylqwr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ddidvylqwr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ddidvylqwr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ddidvylqwr .gt_spanner_row {
  border-bottom-style: hidden;
}

#ddidvylqwr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ddidvylqwr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ddidvylqwr .gt_from_md > :first-child {
  margin-top: 0;
}

#ddidvylqwr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ddidvylqwr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ddidvylqwr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ddidvylqwr .gt_row_group_first td {
  border-top-width: 2px;
}

#ddidvylqwr .gt_row_group_first th {
  border-top-width: 2px;
}

#ddidvylqwr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ddidvylqwr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ddidvylqwr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddidvylqwr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ddidvylqwr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ddidvylqwr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ddidvylqwr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddidvylqwr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ddidvylqwr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ddidvylqwr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_left {
  text-align: left;
}

#ddidvylqwr .gt_center {
  text-align: center;
}

#ddidvylqwr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ddidvylqwr .gt_font_normal {
  font-weight: normal;
}

#ddidvylqwr .gt_font_bold {
  font-weight: bold;
}

#ddidvylqwr .gt_font_italic {
  font-style: italic;
}

#ddidvylqwr .gt_super {
  font-size: 65%;
}

#ddidvylqwr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ddidvylqwr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ddidvylqwr .gt_indent_1 {
  text-indent: 5px;
}

#ddidvylqwr .gt_indent_2 {
  text-indent: 10px;
}

#ddidvylqwr .gt_indent_3 {
  text-indent: 15px;
}

#ddidvylqwr .gt_indent_4 {
  text-indent: 20px;
}

#ddidvylqwr .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="true" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">true</th>
<th id="fit_1<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit_1<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="fit_2<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>2</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit_2<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span></th>
<th id="fit_1s<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>3</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit_1s<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>3</sup></span></th>
<th id="fit_2s<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>4</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit_2s<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>4</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">conditional (S = 0) log-OR</td>
<td class="gt_row gt_right" headers="stub_1_1 true">−0.004</td>
<td class="gt_row gt_right" headers="stub_1_1 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_1 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_1 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_1 fit_2s">−0.004</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">conditional (S = 1) log-OR</td>
<td class="gt_row gt_right" headers="stub_1_2 true">0.003</td>
<td class="gt_row gt_right" headers="stub_1_2 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_2 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_2 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_2 fit_2s">0.003</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">conditional log-OR (?)<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>5</sup></span></td>
<td class="gt_row gt_right" headers="stub_1_3 true"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_3 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_3 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_3 fit_1s">0.001</td>
<td class="gt_row gt_right" headers="stub_1_3 fit_2s"><br>
</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">conditional (weighted) log-OR</td>
<td class="gt_row gt_right" headers="stub_1_4 true"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_4 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_4 fit_2">−0.019</td>
<td class="gt_row gt_right" headers="stub_1_4 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_4 fit_2s"><br>
</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">marginal log-OR</td>
<td class="gt_row gt_right" headers="stub_1_5 true">0.003</td>
<td class="gt_row gt_right" headers="stub_1_5 fit_1">0.003</td>
<td class="gt_row gt_right" headers="stub_1_5 fit_2">0.003</td>
<td class="gt_row gt_right" headers="stub_1_5 fit_1s">0.003</td>
<td class="gt_row gt_right" headers="stub_1_5 fit_2s">0.003</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">weighted log-OR<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>6</sup></span></td>
<td class="gt_row gt_right" headers="stub_1_6 true">−0.019</td>
<td class="gt_row gt_right" headers="stub_1_6 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_6 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_6 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_6 fit_2s"><br>
</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">average (weighted) log-OR</td>
<td class="gt_row gt_right" headers="stub_1_7 true">0.001</td>
<td class="gt_row gt_right" headers="stub_1_7 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_7 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_7 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_7 fit_2s">0.001</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="even">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> y ~ r</td>
</tr>
<tr class="odd">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span> y ~ r + r:s</td>
</tr>
<tr class="even">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>3</sup></span> y ~ r + s</td>
</tr>
<tr class="odd">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>4</sup></span> y ~ r + r:s + s</td>
</tr>
<tr class="even">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>5</sup></span> log-OR for R term in model, but interpretation unclear</td>
</tr>
<tr class="odd">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>6</sup></span> Should be labelled <em>conditional (weighted) log-OR</em>?</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-dn-null-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Null effects
</figcaption>
</figure>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Simulate effect</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a>D <span class="ot">&lt;-</span> <span class="fu">generate_data_1</span>()</span>
<span id="cb8-3"><a href="#cb8-3"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb8-4"><a href="#cb8-4"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> r<span class="sc">:</span>s, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb8-5"><a href="#cb8-5"></a>fit1s <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> s, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb8-6"><a href="#cb8-6"></a>fit2s <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> s, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-12-contents" aria-controls="callout-12" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-12" class="callout-12-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Simulate from <a href="#eq-dn-4" class="quarto-xref">Equation&nbsp;4</a> with a baseline probability of treatment success equal to 0.27 together with <span class="math inline">\(\beta_1 = 0.25\)</span>, <span class="math inline">\(\beta_2 = 0.25\)</span> and <span class="math inline">\(\beta_3 = 1\)</span> for the log-ORs associated with treatment, the interaction between treatment and selection and selection, respectively.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Effect quantities</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>w <span class="ot">&lt;-</span> <span class="fu">mean</span>(D<span class="sc">$</span>a <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">mean</span>(D<span class="sc">$</span>a <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb9-2"><a href="#cb9-2"></a>w_s1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>s <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>w_s2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>s <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a>b1 <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">coef</span>(fit1))</span>
<span id="cb9-6"><a href="#cb9-6"></a>b2 <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">coef</span>(fit2))</span>
<span id="cb9-7"><a href="#cb9-7"></a>b1s <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">coef</span>(fit1s))</span>
<span id="cb9-8"><a href="#cb9-8"></a>b2s <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">coef</span>(fit2s))</span>
<span id="cb9-9"><a href="#cb9-9"></a></span>
<span id="cb9-10"><a href="#cb9-10"></a>EY_R0_2 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2[<span class="dv">1</span>])</span>
<span id="cb9-11"><a href="#cb9-11"></a>EY_R1_2 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> <span class="fu">expit</span>(b2[<span class="dv">1</span>] <span class="sc">+</span> b2[<span class="dv">2</span>]) <span class="sc">+</span> w <span class="sc">*</span> <span class="fu">expit</span>(b2[<span class="dv">1</span>] <span class="sc">+</span> b2[<span class="dv">2</span>] <span class="sc">+</span> b2[<span class="dv">3</span>])</span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a>EY_R0_1_S0 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b1s[<span class="dv">1</span>])</span>
<span id="cb9-14"><a href="#cb9-14"></a>EY_R0_1_S1 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b1s[<span class="dv">1</span>] <span class="sc">+</span> b1s[<span class="dv">3</span>])</span>
<span id="cb9-15"><a href="#cb9-15"></a>EY_R1_1_S0 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b1s[<span class="dv">1</span>] <span class="sc">+</span> b1s[<span class="dv">2</span>])</span>
<span id="cb9-16"><a href="#cb9-16"></a>EY_R1_1_S1 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b1s[<span class="dv">1</span>] <span class="sc">+</span> b1s[<span class="dv">2</span>] <span class="sc">+</span> b1s[<span class="dv">3</span>])</span>
<span id="cb9-17"><a href="#cb9-17"></a>EY_R0_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_s1) <span class="sc">*</span> EY_R0_1_S0 <span class="sc">+</span> w_s1 <span class="sc">*</span> EY_R0_1_S1</span>
<span id="cb9-18"><a href="#cb9-18"></a>EY_R1_1 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_s2) <span class="sc">*</span> EY_R1_1_S0 <span class="sc">+</span> w_s2 <span class="sc">*</span> EY_R1_1_S1</span>
<span id="cb9-19"><a href="#cb9-19"></a></span>
<span id="cb9-20"><a href="#cb9-20"></a>EY_R0_2s_S0 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2s[<span class="dv">1</span>])</span>
<span id="cb9-21"><a href="#cb9-21"></a>EY_R0_2s_S1 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2s[<span class="dv">1</span>] <span class="sc">+</span> b2s[<span class="dv">3</span>])</span>
<span id="cb9-22"><a href="#cb9-22"></a>EY_R1_2s_S0 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2s[<span class="dv">1</span>] <span class="sc">+</span> b2s[<span class="dv">2</span>]) <span class="co"># Pr(A = 2 | S = 0) = 0</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>EY_R1_2s_S1 <span class="ot">&lt;-</span> <span class="fu">expit</span>(b2s[<span class="dv">1</span>] <span class="sc">+</span> b2s[<span class="dv">2</span>] <span class="sc">+</span> b2s[<span class="dv">3</span>] <span class="sc">+</span> b2s[<span class="dv">4</span>]) <span class="co"># Pr(A = 2 | S = 1) = 1</span></span>
<span id="cb9-24"><a href="#cb9-24"></a>EY_R0_2s <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_s1) <span class="sc">*</span> EY_R0_2s_S0 <span class="sc">+</span> w_s1 <span class="sc">*</span> EY_R0_2s_S1</span>
<span id="cb9-25"><a href="#cb9-25"></a>EY_R1_2s <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> w_s2) <span class="sc">*</span> EY_R1_2s_S0 <span class="sc">+</span> w_s2 <span class="sc">*</span> EY_R1_2s_S1</span>
<span id="cb9-26"><a href="#cb9-26"></a></span>
<span id="cb9-27"><a href="#cb9-27"></a><span class="fu">rbind</span>(</span>
<span id="cb9-28"><a href="#cb9-28"></a>  <span class="st">"True conditional (S = 0) log-odds ratio"</span> <span class="ot">=</span></span>
<span id="cb9-29"><a href="#cb9-29"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb9-30"><a href="#cb9-30"></a>  <span class="st">"True conditional (S = 1) log-odds ratio"</span> <span class="ot">=</span></span>
<span id="cb9-31"><a href="#cb9-31"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)),</span>
<span id="cb9-32"><a href="#cb9-32"></a>  <span class="st">"True marginal log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb9-33"><a href="#cb9-33"></a>  <span class="st">"True weighted log-odds ratio"</span> <span class="ot">=</span></span>
<span id="cb9-34"><a href="#cb9-34"></a>    (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[a <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">+</span> w <span class="sc">*</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[a <span class="sc">==</span> <span class="dv">2</span>]<span class="sc">$</span>y)) <span class="sc">-</span></span>
<span id="cb9-35"><a href="#cb9-35"></a>      <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb9-36"><a href="#cb9-36"></a>  <span class="st">"True average (weighted) log-odds ratio"</span> <span class="ot">=</span></span>
<span id="cb9-37"><a href="#cb9-37"></a>    (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> (<span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y))) <span class="sc">+</span></span>
<span id="cb9-38"><a href="#cb9-38"></a>      w <span class="sc">*</span> (<span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y))),</span>
<span id="cb9-39"><a href="#cb9-39"></a>  <span class="st">"fit1 marginal log-odds ratio"</span> <span class="ot">=</span> b1[<span class="dv">2</span>],</span>
<span id="cb9-40"><a href="#cb9-40"></a>  <span class="st">"fit2 marginal log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_2) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2),</span>
<span id="cb9-41"><a href="#cb9-41"></a>  <span class="st">"fit2 conditional (weighted) log-odds ratio"</span> <span class="ot">=</span> b2[<span class="dv">2</span>] <span class="sc">+</span> w <span class="sc">*</span> b2[<span class="dv">3</span>],</span>
<span id="cb9-42"><a href="#cb9-42"></a>  <span class="st">"fit1s conditional log-odds ratio"</span> <span class="ot">=</span> b1s[<span class="dv">2</span>], <span class="co"># Don't know what this targets</span></span>
<span id="cb9-43"><a href="#cb9-43"></a>  <span class="st">"fit1s marginal log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_1) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_1),</span>
<span id="cb9-44"><a href="#cb9-44"></a>  <span class="st">"fit2s conditional (S = 0) log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_2s_S0) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s_S0),</span>
<span id="cb9-45"><a href="#cb9-45"></a>  <span class="st">"fit2s conditional (S = 1) log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_2s_S1) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s_S1),</span>
<span id="cb9-46"><a href="#cb9-46"></a>  <span class="st">"fit2s marginal log-odds ratio"</span> <span class="ot">=</span> <span class="fu">qlogis</span>(EY_R1_2s) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s),</span>
<span id="cb9-47"><a href="#cb9-47"></a>  <span class="st">"fit2s average (weighted) log-odds ratio"</span> <span class="ot">=</span> b2s[<span class="dv">2</span>] <span class="sc">+</span> w <span class="sc">*</span> b2s[<span class="dv">4</span>]</span>
<span id="cb9-48"><a href="#cb9-48"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                [,1]
True conditional (S = 0) log-odds ratio    0.2462550
True conditional (S = 1) log-odds ratio    0.4944007
True marginal log-odds ratio               0.4038167
True weighted log-odds ratio               0.4003765
True average (weighted) log-odds ratio     0.4202020
fit1 marginal log-odds ratio               0.4038167
fit2 marginal log-odds ratio               0.4038167
fit2 conditional (weighted) log-odds ratio 0.4003765
fit1s conditional log-odds ratio           0.4285063
fit1s marginal log-odds ratio              0.4038167
fit2s conditional (S = 0) log-odds ratio   0.2462550
fit2s conditional (S = 1) log-odds ratio   0.4944007
fit2s marginal log-odds ratio              0.4038167
fit2s average (weighted) log-odds ratio    0.4202020</code></pre>
</div>
<details class="code-fold">
<summary>Effect quantities</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>d_out <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="at">desc =</span> <span class="fu">c</span>(</span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="st">"conditional (S = 0) log-OR"</span>,</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="st">"conditional (S = 1) log-OR"</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>    <span class="st">"conditional log-OR (?)"</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="st">"conditional (weighted) log-OR"</span>,</span>
<span id="cb11-7"><a href="#cb11-7"></a>    <span class="st">"marginal log-OR"</span>,</span>
<span id="cb11-8"><a href="#cb11-8"></a>    <span class="st">"weighted log-OR"</span>,</span>
<span id="cb11-9"><a href="#cb11-9"></a>    <span class="st">"average (weighted) log-OR"</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>  ),</span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="at">true =</span> <span class="fu">c</span>(</span>
<span id="cb11-12"><a href="#cb11-12"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb11-13"><a href="#cb11-13"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)),</span>
<span id="cb11-14"><a href="#cb11-14"></a>    <span class="cn">NA</span>,  </span>
<span id="cb11-15"><a href="#cb11-15"></a>    <span class="cn">NA</span>,</span>
<span id="cb11-16"><a href="#cb11-16"></a>    <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb11-17"><a href="#cb11-17"></a>    (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[a <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">+</span> w <span class="sc">*</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[a <span class="sc">==</span> <span class="dv">2</span>]<span class="sc">$</span>y)) <span class="sc">-</span></span>
<span id="cb11-18"><a href="#cb11-18"></a>      <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb11-19"><a href="#cb11-19"></a>    (<span class="dv">1</span> <span class="sc">-</span> w) <span class="sc">*</span> (<span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y))) <span class="sc">+</span></span>
<span id="cb11-20"><a href="#cb11-20"></a>      w <span class="sc">*</span> (<span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> s <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)))</span>
<span id="cb11-21"><a href="#cb11-21"></a>  ),</span>
<span id="cb11-22"><a href="#cb11-22"></a>  <span class="at">fit_1 =</span> <span class="fu">c</span>(</span>
<span id="cb11-23"><a href="#cb11-23"></a>    <span class="cn">NA</span>, </span>
<span id="cb11-24"><a href="#cb11-24"></a>    <span class="cn">NA</span>,   </span>
<span id="cb11-25"><a href="#cb11-25"></a>    <span class="cn">NA</span>,</span>
<span id="cb11-26"><a href="#cb11-26"></a>    <span class="cn">NA</span>, </span>
<span id="cb11-27"><a href="#cb11-27"></a>    b1[<span class="dv">2</span>], </span>
<span id="cb11-28"><a href="#cb11-28"></a>    <span class="cn">NA</span>, </span>
<span id="cb11-29"><a href="#cb11-29"></a>    <span class="cn">NA</span></span>
<span id="cb11-30"><a href="#cb11-30"></a>  ),</span>
<span id="cb11-31"><a href="#cb11-31"></a>  <span class="at">fit_2 =</span> <span class="fu">c</span>(</span>
<span id="cb11-32"><a href="#cb11-32"></a>    <span class="cn">NA</span>, </span>
<span id="cb11-33"><a href="#cb11-33"></a>    <span class="cn">NA</span>, </span>
<span id="cb11-34"><a href="#cb11-34"></a>    <span class="cn">NA</span>, </span>
<span id="cb11-35"><a href="#cb11-35"></a>    b2[<span class="dv">2</span>] <span class="sc">+</span> w <span class="sc">*</span> b2[<span class="dv">3</span>], </span>
<span id="cb11-36"><a href="#cb11-36"></a>    <span class="fu">qlogis</span>(EY_R1_2) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2), </span>
<span id="cb11-37"><a href="#cb11-37"></a>    <span class="cn">NA</span>,</span>
<span id="cb11-38"><a href="#cb11-38"></a>    <span class="cn">NA</span></span>
<span id="cb11-39"><a href="#cb11-39"></a>  ),</span>
<span id="cb11-40"><a href="#cb11-40"></a>  <span class="at">fit_1s =</span> <span class="fu">c</span>(</span>
<span id="cb11-41"><a href="#cb11-41"></a>    <span class="cn">NA</span>, </span>
<span id="cb11-42"><a href="#cb11-42"></a>    <span class="cn">NA</span>, </span>
<span id="cb11-43"><a href="#cb11-43"></a>    b1s[<span class="dv">2</span>],</span>
<span id="cb11-44"><a href="#cb11-44"></a>    <span class="cn">NA</span>,</span>
<span id="cb11-45"><a href="#cb11-45"></a>    <span class="fu">qlogis</span>(EY_R1_1) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_1), </span>
<span id="cb11-46"><a href="#cb11-46"></a>    <span class="cn">NA</span>,</span>
<span id="cb11-47"><a href="#cb11-47"></a>    <span class="cn">NA</span></span>
<span id="cb11-48"><a href="#cb11-48"></a>  ),</span>
<span id="cb11-49"><a href="#cb11-49"></a>  <span class="at">fit_2s =</span> <span class="fu">c</span>(</span>
<span id="cb11-50"><a href="#cb11-50"></a>    <span class="fu">qlogis</span>(EY_R1_2s_S0) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s_S0), </span>
<span id="cb11-51"><a href="#cb11-51"></a>    <span class="fu">qlogis</span>(EY_R1_2s_S1) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s_S1),  </span>
<span id="cb11-52"><a href="#cb11-52"></a>    <span class="cn">NA</span>, </span>
<span id="cb11-53"><a href="#cb11-53"></a>    <span class="cn">NA</span>,</span>
<span id="cb11-54"><a href="#cb11-54"></a>    <span class="fu">qlogis</span>(EY_R1_2s) <span class="sc">-</span> <span class="fu">qlogis</span>(EY_R0_2s),</span>
<span id="cb11-55"><a href="#cb11-55"></a>    <span class="cn">NA</span>,</span>
<span id="cb11-56"><a href="#cb11-56"></a>    b2s[<span class="dv">2</span>] <span class="sc">+</span> w <span class="sc">*</span> b2s[<span class="dv">4</span>]</span>
<span id="cb11-57"><a href="#cb11-57"></a>  )</span>
<span id="cb11-58"><a href="#cb11-58"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Tabulate effect quantities</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>gt_tbl <span class="ot">&lt;-</span> d_out <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="fu">c</span>(<span class="st">"desc"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">"right"</span>, <span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">decimals =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="fu">sub_missing</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">missing_text =</span> <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="st">"80%"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb12-8"><a href="#cb12-8"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r"</span>,</span>
<span id="cb12-9"><a href="#cb12-9"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit_1)</span>
<span id="cb12-10"><a href="#cb12-10"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb12-12"><a href="#cb12-12"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + r:s"</span>,</span>
<span id="cb12-13"><a href="#cb12-13"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit_2)</span>
<span id="cb12-14"><a href="#cb12-14"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-15"><a href="#cb12-15"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb12-16"><a href="#cb12-16"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + s"</span>,</span>
<span id="cb12-17"><a href="#cb12-17"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit_1s)</span>
<span id="cb12-18"><a href="#cb12-18"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-19"><a href="#cb12-19"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb12-20"><a href="#cb12-20"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + r:s + s"</span>,</span>
<span id="cb12-21"><a href="#cb12-21"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit_2s)</span>
<span id="cb12-22"><a href="#cb12-22"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb12-23"><a href="#cb12-23"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb12-24"><a href="#cb12-24"></a>    <span class="at">footnote =</span> <span class="fu">md</span>(<span class="st">"Should be labelled *conditional (weighted) log-OR*?"</span>),</span>
<span id="cb12-25"><a href="#cb12-25"></a>    <span class="at">locations =</span> <span class="fu">cells_stub</span>(<span class="at">rows =</span> <span class="fu">c</span>(</span>
<span id="cb12-26"><a href="#cb12-26"></a>      <span class="st">"weighted log-OR"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb12-27"><a href="#cb12-27"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb12-28"><a href="#cb12-28"></a>    <span class="at">footnote =</span> <span class="fu">md</span>(<span class="st">"log-OR for R term in model, but interpretation unclear"</span>),</span>
<span id="cb12-29"><a href="#cb12-29"></a>    <span class="at">locations =</span> <span class="fu">cells_stub</span>(<span class="at">rows =</span> <span class="fu">c</span>(</span>
<span id="cb12-30"><a href="#cb12-30"></a>      <span class="st">"conditional log-OR (?)"</span>))</span>
<span id="cb12-31"><a href="#cb12-31"></a>  )</span>
<span id="cb12-32"><a href="#cb12-32"></a></span>
<span id="cb12-33"><a href="#cb12-33"></a>gt_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-dn-eff" class="cell quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-dn-eff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="ddidvylqwr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ddidvylqwr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ddidvylqwr thead, #ddidvylqwr tbody, #ddidvylqwr tfoot, #ddidvylqwr tr, #ddidvylqwr td, #ddidvylqwr th {
  border-style: none;
}

#ddidvylqwr p {
  margin: 0;
  padding: 0;
}

#ddidvylqwr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ddidvylqwr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ddidvylqwr .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ddidvylqwr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ddidvylqwr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ddidvylqwr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddidvylqwr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ddidvylqwr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ddidvylqwr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ddidvylqwr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ddidvylqwr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ddidvylqwr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ddidvylqwr .gt_spanner_row {
  border-bottom-style: hidden;
}

#ddidvylqwr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ddidvylqwr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ddidvylqwr .gt_from_md > :first-child {
  margin-top: 0;
}

#ddidvylqwr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ddidvylqwr .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ddidvylqwr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ddidvylqwr .gt_row_group_first td {
  border-top-width: 2px;
}

#ddidvylqwr .gt_row_group_first th {
  border-top-width: 2px;
}

#ddidvylqwr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ddidvylqwr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ddidvylqwr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddidvylqwr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ddidvylqwr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ddidvylqwr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ddidvylqwr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ddidvylqwr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ddidvylqwr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ddidvylqwr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ddidvylqwr .gt_left {
  text-align: left;
}

#ddidvylqwr .gt_center {
  text-align: center;
}

#ddidvylqwr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ddidvylqwr .gt_font_normal {
  font-weight: normal;
}

#ddidvylqwr .gt_font_bold {
  font-weight: bold;
}

#ddidvylqwr .gt_font_italic {
  font-style: italic;
}

#ddidvylqwr .gt_super {
  font-size: 65%;
}

#ddidvylqwr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ddidvylqwr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ddidvylqwr .gt_indent_1 {
  text-indent: 5px;
}

#ddidvylqwr .gt_indent_2 {
  text-indent: 10px;
}

#ddidvylqwr .gt_indent_3 {
  text-indent: 15px;
}

#ddidvylqwr .gt_indent_4 {
  text-indent: 20px;
}

#ddidvylqwr .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="true" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">true</th>
<th id="fit_1<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit_1<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="fit_2<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>2</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit_2<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span></th>
<th id="fit_1s<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>3</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit_1s<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>3</sup></span></th>
<th id="fit_2s<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>4</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit_2s<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>4</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">conditional (S = 0) log-OR</td>
<td class="gt_row gt_right" headers="stub_1_1 true">0.246</td>
<td class="gt_row gt_right" headers="stub_1_1 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_1 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_1 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_1 fit_2s">0.246</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">conditional (S = 1) log-OR</td>
<td class="gt_row gt_right" headers="stub_1_2 true">0.494</td>
<td class="gt_row gt_right" headers="stub_1_2 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_2 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_2 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_2 fit_2s">0.494</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">conditional log-OR (?)<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>5</sup></span></td>
<td class="gt_row gt_right" headers="stub_1_3 true"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_3 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_3 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_3 fit_1s">0.429</td>
<td class="gt_row gt_right" headers="stub_1_3 fit_2s"><br>
</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">conditional (weighted) log-OR</td>
<td class="gt_row gt_right" headers="stub_1_4 true"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_4 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_4 fit_2">0.400</td>
<td class="gt_row gt_right" headers="stub_1_4 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_4 fit_2s"><br>
</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">marginal log-OR</td>
<td class="gt_row gt_right" headers="stub_1_5 true">0.404</td>
<td class="gt_row gt_right" headers="stub_1_5 fit_1">0.404</td>
<td class="gt_row gt_right" headers="stub_1_5 fit_2">0.404</td>
<td class="gt_row gt_right" headers="stub_1_5 fit_1s">0.404</td>
<td class="gt_row gt_right" headers="stub_1_5 fit_2s">0.404</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">weighted log-OR<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>6</sup></span></td>
<td class="gt_row gt_right" headers="stub_1_6 true">0.400</td>
<td class="gt_row gt_right" headers="stub_1_6 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_6 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_6 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_6 fit_2s"><br>
</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">average (weighted) log-OR</td>
<td class="gt_row gt_right" headers="stub_1_7 true">0.420</td>
<td class="gt_row gt_right" headers="stub_1_7 fit_1"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_7 fit_2"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_7 fit_1s"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_7 fit_2s">0.420</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="even">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> y ~ r</td>
</tr>
<tr class="odd">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span> y ~ r + r:s</td>
</tr>
<tr class="even">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>3</sup></span> y ~ r + s</td>
</tr>
<tr class="odd">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>4</sup></span> y ~ r + r:s + s</td>
</tr>
<tr class="even">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>5</sup></span> log-OR for R term in model, but interpretation unclear</td>
</tr>
<tr class="odd">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>6</sup></span> Should be labelled <em>conditional (weighted) log-OR</em>?</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-dn-eff-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Effects
</figcaption>
</figure>
</div>
</div>
<p>So in the basic case, as <span class="math inline">\(n\to\infty\)</span>, these models are all in a sense equivalent, in that they are consistent for the treatment effects of interest.</p>
<p>More generally, can just use g-computation rather than analytic expressions</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>m <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="st">"G-comp marginal mean"</span> <span class="ot">=</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>    <span class="fu">c</span>(<span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)<span class="sc">$</span>estimate, <span class="cn">NA_real_</span>),</span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="st">"G-comp marginal mean (adjust s)"</span> <span class="ot">=</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="fu">c</span>(<span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)<span class="sc">$</span>estimate, <span class="cn">NA_real_</span>),</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="st">"G-comp average log-odds"</span> <span class="ot">=</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="fu">c</span>(<span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>)<span class="sc">$</span>estimate, <span class="cn">NA_real_</span>),</span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="st">"G-comp average log-odds (adjust s)"</span> <span class="ot">=</span> </span>
<span id="cb13-9"><a href="#cb13-9"></a>    <span class="fu">c</span>(<span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>)<span class="sc">$</span>estimate, <span class="cn">NA_real_</span>),</span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="st">"G-comp conditional (S) average log-odds"</span> <span class="ot">=</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>    <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>, <span class="at">by =</span> <span class="st">"s"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="st">"G-comp conditional (S) average log-odds (adjust s)"</span> <span class="ot">=</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>    <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>, <span class="at">by =</span> <span class="st">"s"</span>)<span class="sc">$</span>estimate</span>
<span id="cb13-14"><a href="#cb13-14"></a>)</span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"S = 0"</span>, <span class="st">"S = 1"</span>)</span>
<span id="cb13-16"><a href="#cb13-16"></a>m</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                        S = 0     S = 1
G-comp marginal mean                                0.4030520        NA
G-comp marginal mean (adjust s)                     0.4024538        NA
G-comp average log-odds                             0.3995870        NA
G-comp average log-odds (adjust s)                  0.4200453        NA
G-comp conditional (S) average log-odds            -0.4764725 0.7744050
G-comp conditional (S) average log-odds (adjust s)  0.2462550 0.4944007</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>I think that the above are basically making predictions for the comparison of interest at each of the rows in the data set and then averaging to give a marginalised view.</p>
<p>The definitional differences between <code>lnoravg</code> and <code>lnor</code> amount to:</p>
<p><code>lnor   \(hi, lo) log((hi/(1 - hi))/(lo/(1 - lo)))</code></p>
<p>vs.</p>
<p><code>lnoravg    \(hi, lo) log((mean(hi)/(1 - mean(hi)))/(mean(lo)/(1 - mean(lo)))</code></p>
<p>so (I think but need to confirm) one is doing the calculation on every row and then averaging whereas the other averages first.</p>
</div>
</div>
</div>
</section>
</section>
<section id="covariate" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="covariate">Covariate</h2>
<p>Suppose we introduce a covariate <span class="math inline">\(X\)</span> because it’s predictive of the outcome, e.g.&nbsp;sex. Our model, which does not adjust for <span class="math inline">\(S\)</span>, is</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}[Y|R,S,X] &amp;= \text{expit}(\beta_0 + \beta_1R + \beta_2RS + \beta_3X) \\
\mathbb{E}[Y|R,X] &amp;= \mathbb{E}[\mathbb{E}[Y|R,S,X]|R,X] \\
&amp;= \sum_{s=0}^1 \text{expit}(\beta_0 + \beta_1R + \beta_2Rs + \beta_3X)\mathbb{P}(S=s|R,X) \\
\mathbb{E}[Y|R=0,X] &amp;= \text{expit}(\beta_0 + \beta_3X) \\
\mathbb{E}[Y|R=1,X] &amp;= \text{expit}(\beta_0 + \beta_1 + \beta_3X)\mathbb{P}(S=0|R=1,X)  \\
&amp;\quad \ + \text{expit}(\beta_0 + \beta_1 + \beta_2 + \beta_3X)\mathbb{P}(S=1|R=1,X)
\end{aligned}
\]</span></p>
<p>The conditional (on <span class="math inline">\(X\)</span>) log-odds ratio of marginal success probability for revision versus DAIR depends on the value of <span class="math inline">\(X\)</span> (i.e.&nbsp;is not the same effect for every <span class="math inline">\(X=x\)</span>) and cannot be simplified. It is</p>
<p><span class="math display">\[
\text{logit}(\mathbb{E}[Y|R=1,X]) - (\beta_0 + \beta_3X).
\]</span></p>
<p>By marginalising over type of revision type (which is necessary for the comparison we want), we lose our one number summary. No way to avoid that other than perhaps considering fitting separate models for surgery and duration.</p>
<p>To maintain a one-number-summary, again an alternative is to consider the average conditional log-odds</p>
<p><span class="math display">\[
\mathbb{E}\left[\ln\frac{\text{odds}(Y|R=1|S,X)}{\text{odds}(Y|R=0|S,X)}\right] = \beta_1 + \beta_2\mathbb{E}[S].
\]</span></p>
<p>If <span class="math inline">\(S\)</span> has an effect, say in truth,</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}[Y|S,R,X] &amp;= \text{expit}(\beta_0 + \beta_1R + \beta_2RS + \beta_3S + \beta_4X) \\
\mathbb{E}[Y|R,X] &amp;= \mathbb{E}[\mathbb{E}[Y|S,R,X]|R,X] \\
&amp;= \sum_{s=0}^1 \mathbb{E}[Y|S=s,R,X]\mathbb{P}(S=s|R,X)
\end{aligned}
\]</span></p>
<p>Then if our model does condition on <span class="math inline">\(S\)</span>,</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}[Y|R,X] &amp;= \mathbb{E}[\mathbb{E}[Y|R,X,S]|R,X] \\
&amp;= \sum_{s=0}^1
\text{expit}(\beta_0 + \beta_1R + \beta_2Rs + \beta_3s+\beta_4X)
\mathbb{P}(S=s|R,X) \\
\mathbb{E}[Y|R=0,X] &amp;= \text{expit}(\beta_0 + \beta_4X)\mathbb{P}(S=0|R=0,X) +
\text{expit}(\beta_0 + \beta_3 + \beta_4X)\mathbb{P}(S=1|R=0,X) \\
\mathbb{E}[Y|R=1,X] &amp;= \text{expit}(\beta_0 + \beta_1 + \beta_4X)\mathbb{P}(S=0|R=0,X) +
\text{expit}(\beta_0 + \beta_1 + \beta_2 + \beta_3 + \beta_4X)\mathbb{P}(S=1|R=0,X) \\
\ln\frac{\text{odds}(Y|R=1,X)}{\text{odds}(Y|R=0,X)} &amp;= \text{logit}(\mathbb{E}[Y|R=1,X]) - \text{logit}(\mathbb{E}[Y|R=0,X])
\end{aligned}
\]</span></p>
<p>Due to randomisation, <span class="math inline">\(\mathbb{P}(S=s|R,X) = \mathbb{P}(S=s|X)\)</span>.</p>
<p>The model without adjustment for <span class="math inline">\(S\)</span> assumes</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}[Y|R,S,X] &amp;= \text{expit}(\alpha_0 + \alpha_1R + \alpha_2RS + \alpha_3X) \\
&amp;= \sum_{s=0}^1 \text{expit}(\beta_0 + \beta_1R + \beta_2RS + \beta_3X + \beta_4s)\mathbb{P}(S=s|R,X)
\end{aligned}
\]</span></p>
<section id="example-1" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="example-1">Example</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-14-contents" aria-controls="callout-14" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-14" class="callout-14-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>By definition, <span class="math inline">\(x\)</span> has a 25% chance of occurrence in the sample data.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Generate data with covariate</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="fu">set.seed</span>(<span class="dv">6124</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a>D <span class="ot">&lt;-</span> <span class="fu">generate_data_1</span>(</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="at">f =</span> <span class="cf">function</span>(r, s, x){ <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> s <span class="sc">+</span> x <span class="sc">+</span> <span class="fl">0.25</span> <span class="sc">*</span> r <span class="sc">+</span> <span class="fl">0.25</span> <span class="sc">*</span> r <span class="sc">*</span> s}</span>
<span id="cb15-4"><a href="#cb15-4"></a>)</span>
<span id="cb15-5"><a href="#cb15-5"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> x, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb15-6"><a href="#cb15-6"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> x, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb15-7"><a href="#cb15-7"></a>fit1s <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> s <span class="sc">+</span> x, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb15-8"><a href="#cb15-8"></a>fit2s <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> r <span class="sc">+</span> s <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> x, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Using G-computation to marginalise over <span class="math inline">\(S\)</span> and <span class="math inline">\(X\)</span>.</p>
<div class="cell">
<details class="code-fold">
<summary>Effect quantities</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>tt <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="cn">NA</span>,</span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> x <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> x <span class="sc">==</span> <span class="dv">0</span>]<span class="sc">$</span>y)),</span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> x <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(D[r <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> x <span class="sc">==</span> <span class="dv">1</span>]<span class="sc">$</span>y))</span>
<span id="cb16-6"><a href="#cb16-6"></a>)</span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="fu">rownames</span>(tt) <span class="ot">&lt;-</span> <span class="st">"True"</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>m1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb16-9"><a href="#cb16-9"></a>  <span class="fu">avg_comparisons</span>(fit1, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb16-10"><a href="#cb16-10"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb16-11"><a href="#cb16-11"></a>  <span class="fu">avg_comparisons</span>(fit1s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb16-12"><a href="#cb16-12"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)<span class="sc">$</span>estimate</span>
<span id="cb16-13"><a href="#cb16-13"></a>)</span>
<span id="cb16-14"><a href="#cb16-14"></a>m2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb16-15"><a href="#cb16-15"></a>  <span class="fu">avg_comparisons</span>(fit1, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb16-16"><a href="#cb16-16"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb16-17"><a href="#cb16-17"></a>  <span class="fu">avg_comparisons</span>(fit1s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb16-18"><a href="#cb16-18"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>)<span class="sc">$</span>estimate</span>
<span id="cb16-19"><a href="#cb16-19"></a>)</span>
<span id="cb16-20"><a href="#cb16-20"></a>m3 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb16-21"><a href="#cb16-21"></a>  <span class="fu">avg_comparisons</span>(fit1, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>, <span class="at">by =</span> <span class="st">"x"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb16-22"><a href="#cb16-22"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>, <span class="at">by =</span> <span class="st">"x"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb16-23"><a href="#cb16-23"></a>  <span class="fu">avg_comparisons</span>(fit1s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>, <span class="at">by =</span> <span class="st">"x"</span>)<span class="sc">$</span>estimate,</span>
<span id="cb16-24"><a href="#cb16-24"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>, <span class="at">by =</span> <span class="st">"x"</span>)<span class="sc">$</span>estimate</span>
<span id="cb16-25"><a href="#cb16-25"></a>)</span>
<span id="cb16-26"><a href="#cb16-26"></a>m <span class="ot">&lt;-</span> <span class="fu">cbind</span>(m1, m2, m3)</span>
<span id="cb16-27"><a href="#cb16-27"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Marginal log-odds ratio"</span>, <span class="st">"Average log-odds ratio"</span>, <span class="st">"Conditional (X = 0)"</span>, <span class="st">"Conditional (X = 1)"</span>)</span>
<span id="cb16-28"><a href="#cb16-28"></a><span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> cols</span>
<span id="cb16-29"><a href="#cb16-29"></a><span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"fit1"</span>, <span class="st">"fit2"</span>, <span class="st">"fit1s"</span>, <span class="st">"fit2s"</span>)</span>
<span id="cb16-30"><a href="#cb16-30"></a><span class="fu">round</span>(<span class="fu">rbind</span>(tt, m), <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      Marginal log-odds ratio Average log-odds ratio Conditional (X = 0)
True                    0.376                     NA               0.397
fit1                    0.377                  0.391               0.391
fit2                    0.378                  0.405               0.408
fit1s                   0.378                  0.418               0.393
fit2s                   0.378                  0.416               0.398
      Conditional (X = 1)
True                0.367
fit1                0.391
fit2                0.334
fit1s               0.392
fit2s               0.371</code></pre>
</div>
</div>
<div class="cell page-columns page-full">
<details class="code-fold">
<summary>Tabulate effect quantities</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>d_out <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="fu">t</span>(<span class="fu">round</span>(<span class="fu">rbind</span>(tt, m), <span class="dv">3</span>)))</span>
<span id="cb18-2"><a href="#cb18-2"></a>d_out[, desc <span class="sc">:</span><span class="er">=</span> cols]</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="fu">setcolorder</span>(d_out, <span class="st">"desc"</span>)</span>
<span id="cb18-4"><a href="#cb18-4"></a></span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a>gt_tbl <span class="ot">&lt;-</span> d_out <span class="sc">|&gt;</span> </span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="fu">gt</span>(<span class="at">rowname_col =</span> <span class="fu">c</span>(<span class="st">"desc"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb18-9"><a href="#cb18-9"></a>  <span class="fu">cols_align</span>(<span class="at">align =</span> <span class="st">"right"</span>, <span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb18-10"><a href="#cb18-10"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">decimals =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>  <span class="fu">sub_missing</span>(<span class="at">columns =</span> <span class="fu">everything</span>(), <span class="at">missing_text =</span> <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>  <span class="fu">tab_options</span>(<span class="at">table.font.size =</span> <span class="st">"80%"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb18-14"><a href="#cb18-14"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + x"</span>,</span>
<span id="cb18-15"><a href="#cb18-15"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit1)</span>
<span id="cb18-16"><a href="#cb18-16"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb18-18"><a href="#cb18-18"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + r:s + x"</span>,</span>
<span id="cb18-19"><a href="#cb18-19"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit2)</span>
<span id="cb18-20"><a href="#cb18-20"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-21"><a href="#cb18-21"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb18-22"><a href="#cb18-22"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + s + x"</span>,</span>
<span id="cb18-23"><a href="#cb18-23"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit1s)</span>
<span id="cb18-24"><a href="#cb18-24"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-25"><a href="#cb18-25"></a>  <span class="fu">tab_footnote</span>(</span>
<span id="cb18-26"><a href="#cb18-26"></a>    <span class="at">footnote =</span> <span class="st">"y ~ r + r:s + s + x"</span>,</span>
<span id="cb18-27"><a href="#cb18-27"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>(<span class="at">columns =</span> fit2s)</span>
<span id="cb18-28"><a href="#cb18-28"></a>    ) </span>
<span id="cb18-29"><a href="#cb18-29"></a></span>
<span id="cb18-30"><a href="#cb18-30"></a>gt_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-dn-eff-cov" class="cell quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-dn-eff-cov-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="bbqipmsuqz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#bbqipmsuqz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#bbqipmsuqz thead, #bbqipmsuqz tbody, #bbqipmsuqz tfoot, #bbqipmsuqz tr, #bbqipmsuqz td, #bbqipmsuqz th {
  border-style: none;
}

#bbqipmsuqz p {
  margin: 0;
  padding: 0;
}

#bbqipmsuqz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 80%;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bbqipmsuqz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bbqipmsuqz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bbqipmsuqz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bbqipmsuqz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bbqipmsuqz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bbqipmsuqz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bbqipmsuqz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bbqipmsuqz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bbqipmsuqz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bbqipmsuqz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bbqipmsuqz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bbqipmsuqz .gt_spanner_row {
  border-bottom-style: hidden;
}

#bbqipmsuqz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bbqipmsuqz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bbqipmsuqz .gt_from_md > :first-child {
  margin-top: 0;
}

#bbqipmsuqz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bbqipmsuqz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bbqipmsuqz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bbqipmsuqz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bbqipmsuqz .gt_row_group_first td {
  border-top-width: 2px;
}

#bbqipmsuqz .gt_row_group_first th {
  border-top-width: 2px;
}

#bbqipmsuqz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bbqipmsuqz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bbqipmsuqz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bbqipmsuqz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bbqipmsuqz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bbqipmsuqz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bbqipmsuqz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#bbqipmsuqz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bbqipmsuqz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bbqipmsuqz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bbqipmsuqz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bbqipmsuqz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bbqipmsuqz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bbqipmsuqz .gt_left {
  text-align: left;
}

#bbqipmsuqz .gt_center {
  text-align: center;
}

#bbqipmsuqz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bbqipmsuqz .gt_font_normal {
  font-weight: normal;
}

#bbqipmsuqz .gt_font_bold {
  font-weight: bold;
}

#bbqipmsuqz .gt_font_italic {
  font-style: italic;
}

#bbqipmsuqz .gt_super {
  font-size: 65%;
}

#bbqipmsuqz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#bbqipmsuqz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bbqipmsuqz .gt_indent_1 {
  text-indent: 5px;
}

#bbqipmsuqz .gt_indent_2 {
  text-indent: 10px;
}

#bbqipmsuqz .gt_indent_3 {
  text-indent: 15px;
}

#bbqipmsuqz .gt_indent_4 {
  text-indent: 20px;
}

#bbqipmsuqz .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="True" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">True</th>
<th id="fit1<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>1</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit1<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span></th>
<th id="fit2<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>2</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit2<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span></th>
<th id="fit1s<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>3</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit1s<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>3</sup></span></th>
<th id="fit2s<span class=&quot;gt_footnote_marks&quot; style=&quot;white-space:nowrap;font-style:italic;font-weight:normal;&quot;><sup>4</sup></span>" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">fit2s<span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>4</sup></span></th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Marginal log-odds ratio</td>
<td class="gt_row gt_right" headers="stub_1_1 True">0.376</td>
<td class="gt_row gt_right" headers="stub_1_1 fit1">0.377</td>
<td class="gt_row gt_right" headers="stub_1_1 fit2">0.378</td>
<td class="gt_row gt_right" headers="stub_1_1 fit1s">0.378</td>
<td class="gt_row gt_right" headers="stub_1_1 fit2s">0.378</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Average log-odds ratio</td>
<td class="gt_row gt_right" headers="stub_1_2 True"><br>
</td>
<td class="gt_row gt_right" headers="stub_1_2 fit1">0.391</td>
<td class="gt_row gt_right" headers="stub_1_2 fit2">0.405</td>
<td class="gt_row gt_right" headers="stub_1_2 fit1s">0.418</td>
<td class="gt_row gt_right" headers="stub_1_2 fit2s">0.416</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Conditional (X = 0)</td>
<td class="gt_row gt_right" headers="stub_1_3 True">0.397</td>
<td class="gt_row gt_right" headers="stub_1_3 fit1">0.391</td>
<td class="gt_row gt_right" headers="stub_1_3 fit2">0.408</td>
<td class="gt_row gt_right" headers="stub_1_3 fit1s">0.393</td>
<td class="gt_row gt_right" headers="stub_1_3 fit2s">0.398</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row">Conditional (X = 1)</td>
<td class="gt_row gt_right" headers="stub_1_4 True">0.367</td>
<td class="gt_row gt_right" headers="stub_1_4 fit1">0.391</td>
<td class="gt_row gt_right" headers="stub_1_4 fit2">0.334</td>
<td class="gt_row gt_right" headers="stub_1_4 fit1s">0.392</td>
<td class="gt_row gt_right" headers="stub_1_4 fit2s">0.371</td>
</tr>
</tbody><tfoot class="gt_footnotes">
<tr class="odd">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>1</sup></span> y ~ r + x</td>
</tr>
<tr class="even">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>2</sup></span> y ~ r + r:s + x</td>
</tr>
<tr class="odd">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>3</sup></span> y ~ r + s + x</td>
</tr>
<tr class="even">
<td colspan="6" class="gt_footnote"><span class="gt_footnote_marks" style="white-space:nowrap;font-style:italic;font-weight:normal;"><sup>4</sup></span> y ~ r + r:s + s + x</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-dn-eff-cov-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: G-computation estimates in presence of prognostic covariate
</figcaption>
</figure>
</div>
</div>
</section>
</section>
<section id="unmeasured-confounder" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="unmeasured-confounder">Unmeasured Confounder</h2>
<p>The above hides some complexity because we assume everything is correctly specified. Suppose we introduce some unmeasured factor which influences which patients are preferred for a given revision type. Consider the following:</p>
<ul>
<li>R: randomised surgery - 0: DAIR, 1: revision</li>
<li>S: preferred revision - 0: one-stage, 1: two-stage</li>
<li>A: allocated surgery - 0: DAIR, 1: one-stage, 2: two-stage</li>
<li>Y: treatment success - 0: no, 1: yes</li>
<li>Z: unmeasured factor, patient attributes/type - continuous</li>
</ul>
<p>We assume <span class="math inline">\(Z\)</span> is some immeasurable combination of factors which partly determines a patients risk of failure. We also think that this <span class="math inline">\(Z\)</span> partly determines the surgeons choice of one/two stage. Say patients with higher values of <span class="math inline">\(Z\)</span> are less likely to have successful treatment. However, the surgeon has some knowledge/experience/expertise/intuition which means that they are more likely to prefer a two-stage revision for patients with higher values of <span class="math inline">\(Z\)</span>, as they expect those types of patients will have better outcomes under two-stage. The allocated treatment and the underlying patient risk determines the patients outcome, <span class="math inline">\(Y\)</span>.</p>
<div class="cell page-columns page-full" data-layout-align="default">
<div class="cell-output-display page-columns page-full">
<div id="fig-scenario-2" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-scenario-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-scenario-2">%%{
  init:{
    "flowchart":{"htmlLabels": "true"},
    "securityLevel": "loose",
    "theme": "base"
}}%%
flowchart LR
  R --&gt; A --&gt; Y
  S --&gt; A
  Z(Z) --&gt; S &amp; A &amp; Y
  US((U&lt;sub&gt;S)) -.-&gt; S
  UR((U&lt;sub&gt;R)) -.-&gt; R
  UY((U&lt;sub&gt;Y)) -.-&gt; Y
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-scenario-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Scenario 2, the <span class="math inline">\(U\)</span> denote independent exogenous variables,
</figcaption>
</figure>
</div>
</div>
</div>
<p>Given the randomisation, this does not really change anything, except making explicit that differences between one/two stage may just be due to confounding rather than effect of treatment. We can’t tell which without adjusting for all confounders.</p>
</section>
<section id="checkpoint" class="level2">
<h2 class="anchored" data-anchor-id="checkpoint">Checkpoint</h2>
<p>So, perhaps the easiest quantity to consider is the average conditional log-odds, i.e.</p>
<p><span class="math display">\[
\mathbb{E}\left[\ln\frac{\text{odds}(Y|R=1,S,X,...)}{\text{odds}(Y|R=0,S,X,...)}\right] = \beta_1 + \beta_2\mathbb{E}[S].
\]</span></p>
<p>Is this sufficiently meaningful?</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-15-contents" aria-controls="callout-15" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-15" class="callout-15-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>I think what you are saying is to adopt <a href="#eq-dn-4" class="quarto-xref">Equation&nbsp;4</a> and then report our effect estimate for revision at the sample mean of observed selection, which is this case fully characterises the distribution anyway.</p>
<p>The terminology used for effects seems to vary a bit throughout, but my label would probably be more explicit <em>conditional log-OR evaluated at the mean selection</em> or something like that, whereas I think it has been previously referred to as conditional (weighted) log-OR earlier and average (weighted) log-OR earlier, probably because that is how they have been computed.</p>
</div>
</div>
</div>
</section>
<section id="duration" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="duration">Duration</h2>
<p>Duration, <span class="math inline">\(D\)</span>, is randomised, however, the duration options depends upon assignment to revision <span class="math inline">\(R\)</span>, and the chosen revision type, <span class="math inline">\(S\)</span>. So it is random conditional on <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>. Nothing else alters the distribution of <span class="math inline">\(D\)</span>. We expect that duration has an effect on the outcome.</p>
<p>Below we just use <span class="math inline">\(D=0\)</span> for long and <span class="math inline">\(D=1\)</span> for short, but note that the meaning of these is conditional on <span class="math inline">\(R/S\)</span> (i.e.&nbsp;short for one-stage different to short for two-stage and only applies to revision)</p>
<div class="cell page-columns page-full" data-layout-align="default">
<div class="cell-output-display page-columns page-full">
<div id="fig-scenario-3" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-scenario-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-scenario-3">%%{
  init:{
    "flowchart":{"htmlLabels": "true"},
    "securityLevel": "loose",
    "theme": "base"
}}%%
flowchart LR
  R --&gt; A --&gt; Y
  S --&gt; A &amp; D
  R --&gt; D
  D --&gt; Y
  UD((U&lt;sub&gt;D)) -.-&gt; D
  US((U&lt;sub&gt;S)) -.-&gt; S
  UR((U&lt;sub&gt;R)) -.-&gt; R
  UY((U&lt;sub&gt;Y)) -.-&gt; Y
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-scenario-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Scenario 3, the <span class="math inline">\(U\)</span> denote independent exogenous variables,
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>There might be alternative representations of the above and also the potential for direct and indirect effects of <span class="math inline">\(S\)</span>, see below:</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-scenario-3a" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure" aria-labelledby="fig-scenario-3a-caption">
<div aria-describedby="fig-scenario-3a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-scenario-3a">%%{
  init:{
    "flowchart":{"htmlLabels": "true"},
    "securityLevel": "loose",
    "theme": "base"
}}%%
flowchart LR
  R --&gt; A --&gt; Y
  S --&gt; A
  S --&gt; Y
  A --&gt; D
  D --&gt; Y
  UD((U&lt;sub&gt;D)) -.-&gt; D
  US((U&lt;sub&gt;S)) -.-&gt; S
  UR((U&lt;sub&gt;R)) -.-&gt; R
  UY((U&lt;sub&gt;Y)) -.-&gt; Y
</pre>
</div>
</div>

</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-scenario-3b" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure" aria-labelledby="fig-scenario-3b-caption">
<div aria-describedby="fig-scenario-3b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-scenario-3b">%%{
  init:{
    "flowchart":{"htmlLabels": "true"},
    "securityLevel": "loose",
    "theme": "base"
}}%%
flowchart LR
  R --&gt; D
  S --&gt; D
  S --&gt; Y
  D --&gt; Y
  UD((U&lt;sub&gt;D)) -.-&gt; D
  US((U&lt;sub&gt;S)) -.-&gt; S
  UR((U&lt;sub&gt;R)) -.-&gt; R
  UY((U&lt;sub&gt;Y)) -.-&gt; Y
</pre>
</div>
</div>

</figure>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="fig-scenario-3a-caption" class="margin-figure-caption column-margin callout-16-contents callout-collapse collapse show callout-margin-content">
Figure&nbsp;4
</div><div id="fig-scenario-3b-caption" class="margin-figure-caption column-margin callout-16-contents callout-collapse collapse show callout-margin-content">
Figure&nbsp;5
</div><p>Now there are two interventions: <span class="math inline">\(R\)</span> which has downstream unknown effects partly due to the unknown revision type, <span class="math inline">\(S\)</span>, which is selected, and <span class="math inline">\(D\)</span> which is randomised.</p>
<p>The simplest approach is to analyse these separately. First, restrict the analysis to those patients who were assigned to one-stage and have an RCT for duration in embedded in that subset. Then, restrict analysis to only those assigned to two-stage and have an RCT for duration in that subset. However, we would like to have a joint model so that other effects can be shared (other domains/site/surgeon/age/whatever else). In the joint model, duration effect needs to be conditional on revision type.</p>
<p>Say the true model were something like</p>
<p><span id="eq-dn-7"><span class="math display">\[
\mathbb{E}[Y|R,S,D] = \text{expit}(\beta_0 + \beta_1S + \beta_2R + \beta_3RS + \beta_4RD + \beta_5RDS)
\tag{7}\]</span></span></p>
<p>so</p>
<ul>
<li><span class="math inline">\(\beta_2\)</span> is the shift associated with revision and long duration (assuming long-duration is the refrence group)</li>
<li><span class="math inline">\(\beta_3\)</span> the additional shift associated with two-stage long duration,</li>
<li><span class="math inline">\(\beta_4\)</span> the relative shift for short duration given revision,</li>
<li><span class="math inline">\(\beta_5\)</span> the relative shift for short duration given two-stage.</li>
</ul>
<p>We might choose to setup the design matrix so that it is orthonormal so that a-priori we don’t assign more uncertainty to a specific revision type. E.g.</p>
<p><span class="math display">\[
\mathbb{E}[Y|R,S] = \text{expit}(\beta_0 + \beta_1(S - 0.5) + \beta_2R + \beta_3R(S-0.5) + \beta_4R(D-0.5) + \beta_5R(D-0.5)(S-0.5)
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-17-contents" aria-controls="callout-17" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-17" class="callout-17-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Is the above missing a <span class="math inline">\(D\)</span> from the conditioning?</p>
</div>
</div>
</div>
<p>but for simplicity, not doing this here.</p>
<p>From the above, and with a focus on the surgical domain, we could compare (randomised comparison) any of:</p>
<ol type="1">
<li>revision long vs.&nbsp;DAIR</li>
<li>revision short vs.&nbsp;DAIR, but no other combinations of revision.</li>
<li>one-stage short + two-stage long vs.&nbsp;DAIR</li>
<li>two-stage short + one-stage long vs.&nbsp;DAIR</li>
</ol>
<p>Where (1) and (2) are the likely the most relevant comparisons of interest, but nothing precludes the comparisons stated in (3) and (4). The key point is the explicit statement of the duration type at which the comparison is made, which again is averaged over the empircal distribution of surgical procedure type (one-stage/two-stage).</p>
<p>However, we always needs to marginalise over <span class="math inline">\(S\)</span> (selection/plan):</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}[Y|R=0] &amp;= \sum_{s=0}^1 \text{expit}(\beta_0 + \beta_1s)\mathbb{P}(S=s|R=0) \\
\mathbb{E}[Y|R=1,D=0] &amp;= \sum_{s=0}^1 \text{expit}(\beta_0 + \beta_1s + \beta_2 + \beta_3s)\mathbb{P}(S=s|R=1,D=0) \\
\mathbb{E}[Y|R=1,D=1] &amp;= \sum_{s=0}^1 \text{expit}(\beta_0 + \beta_1s + \beta_2 + \beta_3s + \beta_4 + \beta_5s)\mathbb{P}(S=s|R=1,D=1)
\end{aligned}
\]</span></p>
<p>Again, can alternatively consider the average conditional log-odds ratio</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}\left[\ln\frac{\text{odds}(Y|R=1,S,D)}{\text{odds}(Y|R=0,S,D)}|D_0,D_1\right] &amp;= \beta_2+\beta_3\mathbb{E}[S] + \beta_4D_0 + \beta_5D_1\mathbb{E}[S]
\end{aligned}
\]</span></p>
<p>where I’ve made it explicit that <span class="math inline">\(D_0\)</span> (one-stage short) and <span class="math inline">\(D_1\)</span> (two-stage short) may differ. However, in practice, these would likely be set to the same level.</p>
<p>The default data generating mechanism has the functional form:</p>
<p><span class="math display">\[
\mathbb{E}[Y|R,S,D] = \text{expit}(\beta_0 + \beta_1X + \beta_1S + \beta_2R + \beta_3RS + \beta_4RD + \beta_5RSD)
\]</span></p>
<p>specified with non-zero effects on all terms.</p>
<div class="cell">
<details class="code-fold">
<summary>Generate duration data</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>generate_data_2 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb19-2"><a href="#cb19-2"></a>    <span class="at">n =</span> <span class="dv">1000000</span>,</span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="at">f =</span> <span class="cf">function</span>(x, r, s, d){ <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> x <span class="sc">+</span> s <span class="sc">+</span> r <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> r <span class="sc">*</span> s <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> r <span class="sc">*</span> d <span class="sc">-</span> <span class="fl">0.25</span> <span class="sc">*</span> r <span class="sc">*</span> s <span class="sc">*</span> d}) {</span>
<span id="cb19-4"><a href="#cb19-4"></a>  x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.25</span>)</span>
<span id="cb19-5"><a href="#cb19-5"></a>  s <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.7</span>)</span>
<span id="cb19-6"><a href="#cb19-6"></a>  r <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb19-7"><a href="#cb19-7"></a>  a <span class="ot">&lt;-</span> r <span class="sc">*</span> (s <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb19-8"><a href="#cb19-8"></a>  d <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>((a <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">*</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb19-9"><a href="#cb19-9"></a>  y0 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="fu">f</span>(x, <span class="dv">0</span>, s, <span class="dv">0</span>)))</span>
<span id="cb19-10"><a href="#cb19-10"></a>  y10 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="fu">f</span>(x, <span class="dv">1</span>, s, <span class="dv">0</span>)))</span>
<span id="cb19-11"><a href="#cb19-11"></a>  y11 <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="fu">f</span>(x, <span class="dv">1</span>, s, <span class="dv">1</span>)))</span>
<span id="cb19-12"><a href="#cb19-12"></a>  y <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> r) <span class="sc">*</span> y0 <span class="sc">+</span> r <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> d) <span class="sc">*</span> y10 <span class="sc">+</span> d <span class="sc">*</span> y11)</span>
<span id="cb19-13"><a href="#cb19-13"></a>  D <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> x, <span class="at">r =</span> r, <span class="at">s =</span> s, <span class="at">a =</span> a, <span class="at">d =</span> d, <span class="at">y0 =</span> y0, <span class="at">y10 =</span> y10, <span class="at">y11 =</span> y11, <span class="at">y =</span> y)[</span>
<span id="cb19-14"><a href="#cb19-14"></a>    ,</span>
<span id="cb19-15"><a href="#cb19-15"></a>    <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(</span>
<span id="cb19-16"><a href="#cb19-16"></a>      <span class="at">a1d1 =</span> <span class="fu">as.numeric</span>(a <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb19-17"><a href="#cb19-17"></a>      <span class="at">a2d1 =</span> <span class="fu">as.numeric</span>(a <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> d <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb19-18"><a href="#cb19-18"></a>      <span class="at">r_fac =</span> <span class="fu">factor</span>(r),</span>
<span id="cb19-19"><a href="#cb19-19"></a>      <span class="at">a_fac =</span> <span class="fu">factor</span>(a),</span>
<span id="cb19-20"><a href="#cb19-20"></a>      <span class="at">s_fac =</span> <span class="fu">factor</span>(s),</span>
<span id="cb19-21"><a href="#cb19-21"></a>      <span class="at">a_cen =</span> r <span class="sc">*</span> (a <span class="sc">-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">mean</span>(a[r <span class="sc">==</span> <span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>)),</span>
<span id="cb19-22"><a href="#cb19-22"></a>      <span class="at">s_cen =</span> s <span class="sc">-</span> <span class="fu">mean</span>(s),</span>
<span id="cb19-23"><a href="#cb19-23"></a>      <span class="at">s_ort =</span> s <span class="sc">-</span> <span class="fl">0.5</span></span>
<span id="cb19-24"><a href="#cb19-24"></a>    )</span>
<span id="cb19-25"><a href="#cb19-25"></a>  ]</span>
<span id="cb19-26"><a href="#cb19-26"></a>}</span>
<span id="cb19-27"><a href="#cb19-27"></a><span class="fu">set.seed</span>(<span class="dv">1246</span>)</span>
<span id="cb19-28"><a href="#cb19-28"></a>D <span class="ot">&lt;-</span> <span class="fu">generate_data_2</span>(<span class="at">f =</span> <span class="cf">function</span>(x, r, s, d){ <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> s <span class="sc">+</span> x})</span>
<span id="cb19-29"><a href="#cb19-29"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x <span class="sc">+</span> r <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> r<span class="sc">:</span>d <span class="sc">+</span> r<span class="sc">:</span>s<span class="sc">:</span>d, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb19-30"><a href="#cb19-30"></a>fit2s <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x <span class="sc">+</span> s <span class="sc">+</span> r <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> r<span class="sc">:</span>d <span class="sc">+</span> r<span class="sc">:</span>s<span class="sc">:</span>d, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-18-contents" aria-controls="callout-18" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-18" class="callout-18-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>In the following examples estimation under null effects is considered wherein the true data generation mechanism was <span class="math inline">\(\mathbb{E}[Y|S,X] = \text{expit}(-1 + S + X)\)</span>. That is, where there are no treatment effects in either the surgical or duration domains.</p>
<p>The estimates use G-computation. Specifically, all of the following average over all terms bar the comparison of interest.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Revision vs.&nbsp;DAIR</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Revision vs. DAIR</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">rbind</span>(</span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb20-5"><a href="#cb20-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast Estimate Std. Error     z Pr(&gt;|z|)   S   2.5 %
    r ln(odds(1) / odds(0)) -0.00856    0.00410 -2.09   0.0370 4.8 -0.0166
    r ln(odds(1) / odds(0)) -0.00836    0.00406 -2.06   0.0396 4.7 -0.0163
    97.5 %
 -0.000515
 -0.000400

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Revision (long) vs.&nbsp;DAIR and Revision (short) vs.&nbsp;DAIR</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Revision (long) vs. DAIR and Revision (short) vs. DAIR</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">rbind</span>(</span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="st">"d"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="st">"d"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb22-5"><a href="#cb22-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast d Estimate Std. Error     z Pr(&gt;|z|)   S   2.5 %
    r ln(odds(1) / odds(0)) 0 -0.00864    0.00473 -1.83   0.0676 3.9 -0.0179
    r ln(odds(1) / odds(0)) 1 -0.00832    0.00473 -1.76   0.0785 3.7 -0.0176
    r ln(odds(1) / odds(0)) 0 -0.00863    0.00469 -1.84   0.0658 3.9 -0.0178
    r ln(odds(1) / odds(0)) 1 -0.00755    0.00469 -1.61   0.1074 3.2 -0.0167
   97.5 %
 0.000627
 0.000949
 0.000562
 0.001641

Columns: term, contrast, d, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Conditional on X</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Conditional on X</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">rbind</span>(</span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"x"</span>), <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"x"</span>), <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb24-5"><a href="#cb24-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast d x Estimate Std. Error      z Pr(&gt;|z|)    S
    r ln(odds(1) / odds(0)) 0 0  0.00267    0.00493  0.541   0.5884  0.8
    r ln(odds(1) / odds(0)) 0 1 -0.04726    0.00496 -9.525   &lt;0.001 69.0
    r ln(odds(1) / odds(0)) 1 0  0.00270    0.00493  0.547   0.5842  0.8
    r ln(odds(1) / odds(0)) 1 1 -0.04602    0.00496 -9.277   &lt;0.001 65.6
    r ln(odds(1) / odds(0)) 0 0 -0.00895    0.00490 -1.829   0.0675  3.9
    r ln(odds(1) / odds(0)) 0 1 -0.00909    0.00494 -1.841   0.0656  3.9
    r ln(odds(1) / odds(0)) 1 0 -0.00822    0.00489 -1.680   0.0930  3.4
    r ln(odds(1) / odds(0)) 1 1 -0.00667    0.00494 -1.350   0.1771  2.5
    2.5 %    97.5 %
 -0.00700  0.012332
 -0.05699 -0.037538
 -0.00696  0.012360
 -0.05575 -0.036301
 -0.01855  0.000643
 -0.01878  0.000588
 -0.01782  0.001370
 -0.01635  0.003014

Columns: term, contrast, d, x, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Short vs Long (one-stage) and short vs.&nbsp;long (two-stage)</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Short vs Long (one-stage) and short vs. long (two-stage)</span></span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="fu">rbind</span>(</span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="st">"s"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="st">"s"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast s Estimate Std. Error      z Pr(&gt;|z|)   S    2.5 %
    d ln(odds(1) / odds(0)) 0  0.00603    0.00491  1.228    0.220 2.2 -0.00359
    d ln(odds(1) / odds(0)) 1 -0.00174    0.00330 -0.528    0.597 0.7 -0.00821
    d ln(odds(1) / odds(0)) 0  0.00664    0.00538  1.234    0.217 2.2 -0.00390
    d ln(odds(1) / odds(0)) 1 -0.00176    0.00333 -0.527    0.598 0.7 -0.00829
  97.5 %
 0.01565
 0.00472
 0.01718
 0.00478

Columns: term, contrast, s, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Short vs long conditional on x</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Short vs long conditional on x</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"s"</span>, <span class="st">"x"</span>), <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast s x Estimate Std. Error      z Pr(&gt;|z|)   S
    d ln(odds(1) / odds(0)) 0 0  0.00599    0.00488  1.228    0.220 2.2
    d ln(odds(1) / odds(0)) 0 1  0.00712    0.00580  1.228    0.220 2.2
    d ln(odds(1) / odds(0)) 1 0 -0.00184    0.00349 -0.528    0.597 0.7
    d ln(odds(1) / odds(0)) 1 1 -0.00172    0.00326 -0.528    0.597 0.7
    2.5 %  97.5 %
 -0.00357 0.01555
 -0.00425 0.01850
 -0.00868 0.00499
 -0.00812 0.00467

Columns: term, contrast, s, x, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-19-contents" aria-controls="callout-19" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-19" class="callout-19-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>And now consider estimation under effects for all surgery and duration.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Data generation assuming effects in both domains</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>D <span class="ot">&lt;-</span> <span class="fu">generate_data_2</span>()</span>
<span id="cb30-2"><a href="#cb30-2"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x <span class="sc">+</span> r <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> r<span class="sc">:</span>d <span class="sc">+</span> r<span class="sc">:</span>s<span class="sc">:</span>d, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb30-3"><a href="#cb30-3"></a>fit2s <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x <span class="sc">+</span> s <span class="sc">+</span> r <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> r<span class="sc">:</span>d <span class="sc">+</span> r<span class="sc">:</span>s<span class="sc">:</span>d, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Revision vs.&nbsp;DAIR</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Revision vs. DAIR</span></span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="fu">rbind</span>(</span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb31-5"><a href="#cb31-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 % 97.5 %
    r ln(odds(1) / odds(0))     1.03    0.00427 240   &lt;0.001 Inf  1.02   1.03
    r ln(odds(1) / odds(0))     1.03    0.00423 243   &lt;0.001 Inf  1.02   1.03

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Revision (long) vs.&nbsp;DAIR and Revision (short) vs.&nbsp;DAIR</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Revision (long) vs. DAIR and Revision (short) vs. DAIR</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="fu">rbind</span>(</span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="st">"d"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="st">"d"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb33-5"><a href="#cb33-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast d Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 % 97.5 %
    r ln(odds(1) / odds(0)) 0    1.184    0.00518 228   &lt;0.001 Inf 1.174  1.194
    r ln(odds(1) / odds(0)) 1    0.607    0.00482 126   &lt;0.001 Inf 0.598  0.617
    r ln(odds(1) / odds(0)) 0    1.184    0.00515 230   &lt;0.001 Inf 1.174  1.194
    r ln(odds(1) / odds(0)) 1    0.607    0.00478 127   &lt;0.001 Inf 0.598  0.616

Columns: term, contrast, d, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Conditional on X</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># Conditional on X</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">rbind</span>(</span>
<span id="cb35-3"><a href="#cb35-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"x"</span>), <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"d"</span>, <span class="st">"x"</span>), <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb35-5"><a href="#cb35-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast d x Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 %
    r ln(odds(1) / odds(0)) 0 0    1.239    0.00532 233   &lt;0.001 Inf 1.228
    r ln(odds(1) / odds(0)) 0 1    1.153    0.00554 208   &lt;0.001 Inf 1.142
    r ln(odds(1) / odds(0)) 1 0    0.645    0.00499 129   &lt;0.001 Inf 0.635
    r ln(odds(1) / odds(0)) 1 1    0.573    0.00510 112   &lt;0.001 Inf 0.563
    r ln(odds(1) / odds(0)) 0 0    1.230    0.00528 233   &lt;0.001 Inf 1.219
    r ln(odds(1) / odds(0)) 0 1    1.191    0.00554 215   &lt;0.001 Inf 1.180
    r ln(odds(1) / odds(0)) 1 0    0.635    0.00495 128   &lt;0.001 Inf 0.625
    r ln(odds(1) / odds(0)) 1 1    0.610    0.00509 120   &lt;0.001 Inf 0.600
 97.5 %
  1.249
  1.163
  0.655
  0.583
  1.240
  1.202
  0.645
  0.620

Columns: term, contrast, d, x, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Short vs Long (one-stage) and short vs.&nbsp;long (two-stage)</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Short vs Long (one-stage) and short vs. long (two-stage)</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="fu">rbind</span>(</span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="st">"s"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb37-4"><a href="#cb37-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="st">"s"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb37-5"><a href="#cb37-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast s Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 %
    d ln(odds(1) / odds(0)) 0   -0.235    0.00504 -46.6   &lt;0.001 Inf -0.245
    d ln(odds(1) / odds(0)) 1   -0.264    0.00295 -89.7   &lt;0.001 Inf -0.270
    d ln(odds(1) / odds(0)) 0   -0.242    0.00520 -46.6   &lt;0.001 Inf -0.252
    d ln(odds(1) / odds(0)) 1   -0.277    0.00309 -89.7   &lt;0.001 Inf -0.283
 97.5 %
 -0.225
 -0.258
 -0.232
 -0.271

Columns: term, contrast, s, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Short vs long conditional on x</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Short vs long conditional on x</span></span>
<span id="cb39-2"><a href="#cb39-2"></a><span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"s"</span>, <span class="st">"x"</span>), <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast s x Estimate Std. Error     z Pr(&gt;|z|)   S  2.5 %
    d ln(odds(1) / odds(0)) 0 0   -0.246    0.00527 -46.6   &lt;0.001 Inf -0.256
    d ln(odds(1) / odds(0)) 0 1   -0.243    0.00523 -46.5   &lt;0.001 Inf -0.253
    d ln(odds(1) / odds(0)) 1 0   -0.286    0.00319 -89.7   &lt;0.001 Inf -0.292
    d ln(odds(1) / odds(0)) 1 1   -0.212    0.00241 -87.9   &lt;0.001 Inf -0.217
 97.5 %
 -0.235
 -0.233
 -0.280
 -0.207

Columns: term, contrast, s, x, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
</section>
<section id="other-domains" class="level2">
<h2 class="anchored" data-anchor-id="other-domains">Other Domains</h2>
<p>The desire for a single model is incorporation of multiple silos and domains. Suppose we introduce the antibiotic type (rifampicin) domain, which is denoted by <span class="math inline">\(F\)</span>. Assume everyone were eligible. Our base model would be</p>
<p><span class="math display">\[
\mathbb{E}[Y|R,S,D,F] = \text{expit}(\beta_0 + \beta_1S + \beta_2R + \beta_3RS + \beta_4RD + \beta_5RDS + \beta_6F)
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p><span class="math inline">\(\beta_2\)</span> is now the shift for revision (under long duration irrespective of surgical type)</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Generate rifampicin data</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>generate_data_3 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb41-2"><a href="#cb41-2"></a>    <span class="at">n =</span> <span class="dv">1000000</span>,</span>
<span id="cb41-3"><a href="#cb41-3"></a>    <span class="at">g =</span> <span class="cf">function</span>(x, r, s, d, f){ <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> x <span class="sc">+</span> s <span class="sc">+</span> r <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> r <span class="sc">*</span> s <span class="sc">-</span> <span class="fl">0.25</span> <span class="sc">*</span> r <span class="sc">*</span> d <span class="sc">-</span> <span class="fl">0.15</span> <span class="sc">*</span> r <span class="sc">*</span> s <span class="sc">*</span> d <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> f}) {</span>
<span id="cb41-4"><a href="#cb41-4"></a>  x <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.25</span>)</span>
<span id="cb41-5"><a href="#cb41-5"></a>  s <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.7</span>)</span>
<span id="cb41-6"><a href="#cb41-6"></a>  r <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb41-7"><a href="#cb41-7"></a>  f <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb41-8"><a href="#cb41-8"></a>  a <span class="ot">&lt;-</span> r <span class="sc">*</span> (s <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb41-9"><a href="#cb41-9"></a>  d <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>((a <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">*</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb41-10"><a href="#cb41-10"></a>  y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="fu">g</span>(x, r, s, d, f)))</span>
<span id="cb41-11"><a href="#cb41-11"></a>  D <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> x, <span class="at">r =</span> r, <span class="at">s =</span> s, <span class="at">a =</span> a, <span class="at">d =</span> d, <span class="at">f =</span> f, <span class="at">y =</span> y)</span>
<span id="cb41-12"><a href="#cb41-12"></a>}</span>
<span id="cb41-13"><a href="#cb41-13"></a><span class="fu">set.seed</span>(<span class="dv">1246</span>)</span>
<span id="cb41-14"><a href="#cb41-14"></a>D <span class="ot">&lt;-</span> <span class="fu">generate_data_3</span>()</span>
<span id="cb41-15"><a href="#cb41-15"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x <span class="sc">+</span> r <span class="sc">+</span> f <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> r<span class="sc">:</span>d <span class="sc">+</span> r<span class="sc">:</span>s<span class="sc">:</span>d, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb41-16"><a href="#cb41-16"></a>fit2s <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> x <span class="sc">+</span> s <span class="sc">+</span> r <span class="sc">+</span> f <span class="sc">+</span> r<span class="sc">:</span>s <span class="sc">+</span> r<span class="sc">:</span>d <span class="sc">+</span> r<span class="sc">:</span>s<span class="sc">:</span>d, <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Revision vs.&nbsp;DAIR</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># Revision vs. DAIR</span></span>
<span id="cb42-2"><a href="#cb42-2"></a><span class="fu">rbind</span>(</span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb42-5"><a href="#cb42-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 % 97.5 %
    r ln(odds(1) / odds(0))      1.1    0.00441 250   &lt;0.001 Inf   1.1   1.11
    r ln(odds(1) / odds(0))      1.1    0.00437 253   &lt;0.001 Inf   1.1   1.11

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted 
Type:  response </code></pre>
</div>
<details class="code-fold">
<summary>Revision vs.&nbsp;DAIR</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="fu">rbind</span>(</span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>),</span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>)</span>
<span id="cb44-4"><a href="#cb44-4"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 % 97.5 %
    r ln(odds(1) / odds(0))     1.25    0.00508 247   &lt;0.001 Inf  1.24   1.26
    r ln(odds(1) / odds(0))     1.26    0.00512 246   &lt;0.001 Inf  1.25   1.27

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Revision vs.&nbsp;DAIR conditional</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># Revision vs. DAIR conditional</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">rbind</span>(</span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"x"</span>, <span class="st">"d"</span>), <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"f"</span>, <span class="st">"x"</span>, <span class="st">"d"</span>), <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb46-5"><a href="#cb46-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast f x d Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 %
    r ln(odds(1) / odds(0)) 0 0 0    1.245    0.00542 230   &lt;0.001 Inf 1.234
    r ln(odds(1) / odds(0)) 0 0 1    0.945    0.00519 182   &lt;0.001 Inf 0.935
    r ln(odds(1) / odds(0)) 0 1 0    1.159    0.00561 206   &lt;0.001 Inf 1.148
    r ln(odds(1) / odds(0)) 0 1 1    0.861    0.00532 162   &lt;0.001 Inf 0.850
    r ln(odds(1) / odds(0)) 1 0 0    1.225    0.00543 226   &lt;0.001 Inf 1.215
    r ln(odds(1) / odds(0)) 1 0 1    0.926    0.00518 179   &lt;0.001 Inf 0.916
    r ln(odds(1) / odds(0)) 1 1 0    1.145    0.00567 202   &lt;0.001 Inf 1.134
    r ln(odds(1) / odds(0)) 1 1 1    0.852    0.00537 158   &lt;0.001 Inf 0.841
    r ln(odds(1) / odds(0)) 0 0 0    1.232    0.00538 229   &lt;0.001 Inf 1.222
    r ln(odds(1) / odds(0)) 0 0 1    0.931    0.00515 181   &lt;0.001 Inf 0.921
    r ln(odds(1) / odds(0)) 0 1 0    1.192    0.00560 213   &lt;0.001 Inf 1.181
    r ln(odds(1) / odds(0)) 0 1 1    0.896    0.00531 169   &lt;0.001 Inf 0.886
    r ln(odds(1) / odds(0)) 1 0 0    1.221    0.00539 227   &lt;0.001 Inf 1.210
    r ln(odds(1) / odds(0)) 1 0 1    0.922    0.00514 179   &lt;0.001 Inf 0.912
    r ln(odds(1) / odds(0)) 1 1 0    1.188    0.00569 209   &lt;0.001 Inf 1.177
    r ln(odds(1) / odds(0)) 1 1 1    0.894    0.00538 166   &lt;0.001 Inf 0.883
 97.5 %
  1.256
  0.955
  1.170
  0.871
  1.236
  0.936
  1.156
  0.862
  1.243
  0.941
  1.203
  0.907
  1.231
  0.932
  1.200
  0.905

Columns: term, contrast, f, x, d, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Revision (long) vs.&nbsp;DAIR and Revision (short) vs.&nbsp;DAIR</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># Revision (long) vs. DAIR and Revision (short) vs. DAIR</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="fu">rbind</span>(</span>
<span id="cb48-3"><a href="#cb48-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="st">"d"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb48-4"><a href="#cb48-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">by =</span> <span class="st">"d"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb48-5"><a href="#cb48-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast d Estimate Std. Error   z Pr(&gt;|z|)   S 2.5 % 97.5 %
    r ln(odds(1) / odds(0)) 0    1.182    0.00528 224   &lt;0.001 Inf 1.171  1.192
    r ln(odds(1) / odds(0)) 1    0.889    0.00502 177   &lt;0.001 Inf 0.879  0.899
    r ln(odds(1) / odds(0)) 0    1.182    0.00525 225   &lt;0.001 Inf 1.171  1.192
    r ln(odds(1) / odds(0)) 1    0.890    0.00499 178   &lt;0.001 Inf 0.880  0.899

Columns: term, contrast, d, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Rifampicin vs not</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># Rifampicin vs not</span></span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="fu">rbind</span>(</span>
<span id="cb50-3"><a href="#cb50-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"f"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb50-4"><a href="#cb50-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"f"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb50-5"><a href="#cb50-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast Estimate Std. Error    z Pr(&gt;|z|)   S 2.5 % 97.5 %
    f ln(odds(1) / odds(0))    0.168    0.00387 43.4   &lt;0.001 Inf 0.161  0.176
    f ln(odds(1) / odds(0))    0.168    0.00382 44.0   &lt;0.001 Inf 0.160  0.175

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Short vs Long (one-stage) and short vs.&nbsp;long (two-stage)</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># Short vs Long (one-stage) and short vs. long (two-stage)</span></span>
<span id="cb52-2"><a href="#cb52-2"></a><span class="fu">rbind</span>(</span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="st">"s"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>),</span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="fu">avg_comparisons</span>(fit2s, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="st">"s"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span>
<span id="cb52-5"><a href="#cb52-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast s Estimate Std. Error     z Pr(&gt;|z|)     S  2.5 %
    d ln(odds(1) / odds(0)) 0   -0.119    0.00505 -23.6   &lt;0.001 406.7 -0.129
    d ln(odds(1) / odds(0)) 1   -0.121    0.00284 -42.6   &lt;0.001   Inf -0.127
    d ln(odds(1) / odds(0)) 0   -0.120    0.00508 -23.6   &lt;0.001 407.5 -0.130
    d ln(odds(1) / odds(0)) 1   -0.129    0.00302 -42.6   &lt;0.001   Inf -0.134
 97.5 %
 -0.109
 -0.115
 -0.110
 -0.123

Columns: term, contrast, s, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Short vs long conditional on x</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># Short vs long conditional on x</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"s"</span>, <span class="st">"x"</span>), <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast s x Estimate Std. Error     z Pr(&gt;|z|)     S
    d ln(odds(1) / odds(0)) 0 0  -0.1250    0.00530 -23.6   &lt;0.001 406.9
    d ln(odds(1) / odds(0)) 0 1  -0.1210    0.00513 -23.6   &lt;0.001 406.4
    d ln(odds(1) / odds(0)) 1 0  -0.1309    0.00307 -42.6   &lt;0.001   Inf
    d ln(odds(1) / odds(0)) 1 1  -0.0946    0.00223 -42.4   &lt;0.001   Inf
   2.5 %  97.5 %
 -0.1354 -0.1146
 -0.1310 -0.1109
 -0.1370 -0.1249
 -0.0989 -0.0902

Columns: term, contrast, s, x, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
</section>
<section id="silos" class="level2">
<h2 class="anchored" data-anchor-id="silos">Silos</h2>
<p>The above has considered the late-acute silo in isolation. Suppose we also had a chronic silo with the same limitations: randomise to DAIR vs.&nbsp;revision, then revision type is determined by the surgeon/patient, duration is randomised. In the new setting, nothing really changes, we can just introduce silo-specific parameters.</p>
<p>For lack of letters, let <span class="math inline">\(G\)</span> denote group (silo). Then</p>
<p><span class="math display">\[
\mathbb{E}[Y|G=g,R,S,D] = \text{expit}(\beta_{0,g} + \beta_{1,g}R + \beta_{2,g}S + \beta_{3,g}RS + \beta_{4,g}RD + \beta_{5,g}RSD + \gamma_g^\mathsf{T}X)
\]</span></p>
<p>We might choose to assume that some of the conditional effects are equal across groups. E.g. <span class="math inline">\(\gamma_g=\gamma\)</span> for all <span class="math inline">\(g\)</span>. Or <span class="math inline">\(\beta_{4,g} = \beta_4\)</span> and <span class="math inline">\(\beta_{5,g}=\beta_5\)</span>. Depends how realistic we think these assumptions may be and whether we have sufficient data to meaningfully estimate silo-specific effects.</p>
<p>Perhaps the only new issue is that now <span class="math inline">\(\mathbb{P}(S=s|G=1)\ne\mathbb{P}(S=s|G=2)\)</span>, so need to weight things within silo.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>The other thing to consider here is that in the early silo, there is no information contributed to parameters characterising the surgical intervention effects. I am not sure that the above model addresses this in that <span class="math inline">\(\beta_{1,g}\)</span> for <span class="math inline">\(g = early\)</span> would not be defined.</p>
</div>
</div>
</div>
</section>
<section id="revision-type" class="level2">
<h2 class="anchored" data-anchor-id="revision-type">Revision Type</h2>
<p>In all the above I’ve been assuming that the revision type, <span class="math inline">\(S\)</span>, is an attribute of the patient. E.g. all surgeons would choose the same <span class="math inline">\(S\)</span> for the same patient. More realistically, <span class="math inline">\(S\)</span> might also partly depend on the surgeon (e.g.&nbsp;say a surgeon would choose <span class="math inline">\(S=1\)</span> for all patients, but another would choose <span class="math inline">\(S=0\)</span> for all patients, now <span class="math inline">\(S\)</span> is conditional on the surgeon rather than the patient). Assume <span class="math inline">\(S\)</span> is an attribute of the patient/surgeon combination rather than either alone. Do we need to change anything? How to interpret “revision effect”? An average effect over patients and surgeons?</p>
<p>Already expect that we should at least condition on the site/surgeon, but do we need anything extra to account for <span class="math inline">\(S\)</span>? Distribution of <span class="math inline">\(S\)</span> conditional on surgeon?</p>
</section>
<section id="randomisation-reveal" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="randomisation-reveal">Randomisation reveal</h2>
<p>A number of simplifying assumptions have been made that result in an incomplete representation of the design. For example, at the start of the discussion on the duration domain, we assumed that duration is randomised, but depends on both <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>. However, note:</p>
<ol type="1">
<li><span class="math inline">\(R\)</span> presupposes eligibility and reveal for the surgical domain, which is not the general case, e.g.&nbsp;early stage infection silo.</li>
<li>Patients may enter into the study without having being entered for a randomised comparison in the surgical domain (e.g.&nbsp;patients with early stage infection) in which case the allocated surgery (<span class="math inline">\(R_A\)</span>) would have been determined entirely by clinician selection.</li>
<li>Patients enter into the duration domain based on the surgical procedure <strong>that occurred</strong>. This is expected to usually align with the allocated procedure <span class="math inline">\(R_A\)</span>, but may deviate from that.</li>
<li><span class="math inline">\(D\)</span> is random, conditional solely on <span class="math inline">\(R_P\)</span> rather than both <span class="math inline">\(R\)</span> and <span class="math inline">\(S_{R_A}\)</span> (as stated in the duration section).</li>
<li><span class="math inline">\(D\)</span> exists only for <span class="math inline">\(R_P \in \{\text{one-stage}, \text{two-stage}\}\)</span> otherwise reveal never occurs and duration allocated <span class="math inline">\(D_A\)</span> is determined by clinician selection</li>
<li>While the duration domain for one-stage and two-stage both contain <em>long</em> (reference) vs <em>short</em> levels for duration of antibiotic, the levels are distinct for each procedure.</li>
</ol>
<p>To incorporate some of these ideas, start with the following definitions:</p>
<ul>
<li><span class="math inline">\(E_R\)</span> reveal for surgical domain - 0: no, 1: yes</li>
<li><span class="math inline">\(E_D\)</span> reveal for duration domain - 0: no, 1: yes</li>
<li><span class="math inline">\(E_F\)</span> reveal for choice domain - 0: no, 1: yes</li>
<li><span class="math inline">\(R\)</span> randomised surgery - 0: DAIR, 1: revision</li>
<li><span class="math inline">\(S_R\)</span> revision type preference (pre-randomisation) - 0: DAIR, 1: one-stage, 2: two-stage</li>
<li><span class="math inline">\(R_A\)</span> allocated surgery - 0: DAIR, 1: one-stage, 2: two-stage</li>
<li><span class="math inline">\(R_P\)</span> performed surgery - 0: DAIR, 1: revision</li>
<li><span class="math inline">\(S_{R_P}\)</span> revision type performed (post-randomisation) - 0: one-stage, 1: two-stage</li>
<li><span class="math inline">\(D\)</span> randomised duration - 0: long, 1: short</li>
<li><span class="math inline">\(D_A\)</span> allocated duration - 0: long, 1: short, 2: other</li>
<li><span class="math inline">\(S_D\)</span> selected duration - 0: long, 1: short, 2: other</li>
<li><span class="math inline">\(F\)</span> randomised choice - 0: norif, 1: rif</li>
<li><span class="math inline">\(F_A\)</span> allocated choice - 0: norif, 1: rif, 2: other</li>
<li><span class="math inline">\(S_F\)</span> selected choice - 0: norif, 1: rif, 2: other</li>
<li><span class="math inline">\(Y\)</span> treatment success - 0: no, 1: yes</li>
</ul>
<p>In practice, we expect the allocated <span class="math inline">\(R_A\)</span> and actual <span class="math inline">\(R_P\)</span> surgical procedure performed will align, but in some cases they may not.</p>
<p><strong>Contrived) example one</strong>: revision was randomised and the original surgeon only performs two-stage revision. The original surgeon becomes unavailable to do the procedure and another surgeon (who only performs one-stage revision) takes over the case. The patient enters into the duration domain for comparisons within the setting of one-stage revision.</p>
<p><strong>Contrived) example two</strong>: revision was randomised and the surgeon intends to perform a two-stage revision. On the operating table, the surgeon switches to dair, for unknown reasons and the patient will no longer enter into randomised comparisons for the duration domain.</p>
<p><span class="math inline">\(R_A\)</span> (allocation) is now determined by additional variables:</p>
<p><span class="math display">\[
R_A = (1-E_R) S_R + E_R R S_R
\]</span></p>
<p>so that when we have no revealed randomisation for the surgical domain, <span class="math inline">\(R_A\)</span> aligns with the preferred procedure out of all those possible (dair, one-stage, two-stage). When randomisation revealed for the surgical domain, the first term disappears and for <span class="math inline">\(R = 0\)</span>, the allocation is dair, irrespective of preferred surgery, whereas when <span class="math inline">\(R = 1\)</span> we get whatever one of one-stage (<span class="math inline">\(S_R = 1\)</span>) or two-stage (<span class="math inline">\(S_R = 2\)</span>) is preferred.</p>
<p>For duration allocated <span class="math inline">\(D_A\)</span>:</p>
<p><span class="math display">\[
D_A = (1-E_D) S_D + E_D D
\]</span></p>
<p>when no reveal, <span class="math inline">\(E_D = 1\)</span> and <span class="math inline">\(D_A = S_D\)</span> (long/short/other duration) and when revealed, <span class="math inline">\(D_A = D\)</span> (long/short duration).</p>
<p>For choice allocated <span class="math inline">\(F_A\)</span>:</p>
<p><span class="math display">\[
F_A = (1 - E_F) S_F + E_F F
\]</span></p>
<p>when no reveal, <span class="math inline">\(F_A = S_F\)</span> (norif/rif/other) and when revealed, <span class="math inline">\(F_A = F\)</span> (norif/rif).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Above, I am assuming that you can randomise someone within a domain without first assessing their eligibility status or knowing anything about them other than they want to enter the platform, which I believe is the intention. Randomisation is only revealed if eligibility is confirmed and this process is independent to the randomisation process.</p>
</div>
</div>
</div>
<p>The edited DAG is shown below, which still has a number of simplications relative to the intended approach but is intended to represent a generalised silo and site of infection, implicitly acknowledging that the outcome will be dependent on both these factors. Patients may contribute to some or all domains, which influences the treatment regimen (combination of treatments across the domains) they receive and which suggests the various causal effects that are identifiable.</p>
<div class="cell page-columns page-full" data-layout-align="default">
<div class="cell-output-display page-columns page-full">
<div id="fig-scenario-4" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-scenario-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-scenario-4">%%{
  init:{
    "flowchart":{"htmlLabels": "true"},
    "securityLevel": "loose",
    "theme": "base"
}}%%
flowchart LR
  ER(E&lt;sub&gt;R) --&gt; RA(R&lt;sub&gt;A) 
  ER --&gt; SR(S&lt;sub&gt;R)
  ED(E&lt;sub&gt;D) --&gt; DA(D&lt;sub&gt;A) 
  SR --&gt; RA 
  SD(S&lt;sub&gt;D) --&gt; DA 
  R --&gt; RA
  RA --&gt; RP(R&lt;sub&gt;P) 
  SRP(S&lt;sub&gt;R&lt;sub&gt;P) --&gt; RP
  RA --&gt; Y
  RP --&gt; ED
  D --&gt; DA(D&lt;sub&gt;A)
  DA --&gt; Y
  F --&gt; FA(F&lt;sub&gt;A)
  EF(E&lt;sub&gt;F) --&gt; FA
  SF(S&lt;sub&gt;F) --&gt; FA 
  FA --&gt; Y
  UER((U&lt;sub&gt;E&lt;sub&gt;R)) -.-&gt; ER
  UED((U&lt;sub&gt;E&lt;sub&gt;D)) -.-&gt; ED
  UEF((U&lt;sub&gt;E&lt;sub&gt;F)) -.-&gt; EF
  UF((U&lt;sub&gt;F)) -.-&gt; F
  URP((U&lt;sub&gt;R&lt;sub&gt;P)) -.-&gt; SRP
  UD((U&lt;sub&gt;D)) -.-&gt; D
  USR((U&lt;sub&gt;S&lt;sub&gt;R)) -.-&gt; SR
  UR((U&lt;sub&gt;R)) -.-&gt; R
  USD((U&lt;sub&gt;S&lt;sub&gt;D)) -.-&gt; SD
  USF((U&lt;sub&gt;S&lt;sub&gt;F)) -.-&gt; SF
  UY((U&lt;sub&gt;Y)) -.-&gt; Y
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-scenario-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Scenario 4, the <span class="math inline">\(U\)</span> denote independent exogenous variables,
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-23-contents" aria-controls="callout-23" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-23" class="callout-23-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>There is potentially a direct as well as the indirect effect of both <span class="math inline">\(S_R\)</span> on <span class="math inline">\(Y\)</span> and <span class="math inline">\(S_{R_P}\)</span> on <span class="math inline">\(Y\)</span> but these have been left out of the DAG for now. <span class="math inline">\(S_R\)</span> is actually representing multiple ideas:</p>
<ol type="1">
<li>when the surgical domain is not applicable (randomisation never revealed) e.g.&nbsp;for the chronic patients, then <span class="math inline">\(S_R\)</span> is the selection from dair, one-stage, two-stage</li>
<li>when surgical domain is applicable (randomisation is revealed) then <span class="math inline">\(S_R\)</span> is the option between one-stage and two-stage that is most prefered.</li>
</ol>
<p>In essence, <span class="math inline">\(S_R\)</span> involves a conditional ranking of which surgical procedure is prefered.</p>
<p>For example, say the selection is: dair, two-stage, one-stage in order of preference. If randomisation is not reveal, dair is would be the selection. If randomisation is revealed, two-stage would be as it is the most prefered surgical procedure applicable to revision.</p>
<p>Originally, <span class="math inline">\(D\)</span> was said to depend on some of the selection elements. However, subsequently it was decided that <span class="math inline">\(D\)</span> (long/short) should be viewed like all other randomisation processes, i.e.&nbsp;independent of all other nodes, but is only manifest through <span class="math inline">\(D_A\)</span> for certain surgery types.</p>
</div>
</div>
</div>
<p>Again consider intervening on surgical procedure whereby we are interested in the effect of dair vs revision on treatment success. There are no open backdoor paths apparent and therefore no adjustment is required to identify the total effect of <span class="math inline">\(R\)</span> on <span class="math inline">\(Y\)</span>. Similarly, neither <span class="math inline">\(D\)</span> nor <span class="math inline">\(F\)</span> have backdoor paths.</p>
<p>Postulate the following model:</p>
<p><span class="math display">\[
\begin{aligned}
\mathbb{E}[Y|L; \beta] &amp;=  \text{expit}( \beta_0 + \\
  &amp;\quad \beta_1 \mathbb{I}[G = 1] + \beta_2 \mathbb{I}[G = 2] + \beta_3 J + \\
  &amp;\quad \beta_4 J \mathbb{I}[G = 1] + \beta_5 J \mathbb{I}[G = 2] + \\
  &amp;\quad \beta_6 \mathbb{I}(1-E_R) + ([\beta_7 R + \beta_8 R \mathbb{I}(S_{R_P} = 2) ])\mathbb{I}(E_R) + \\
  &amp;\quad \beta_9 \mathbb{I}(1-E_D) + ([\beta_{10} R_P D + \beta_{11} R_P D \mathbb{I}(S_{R_P} = 2)])\mathbb{I}(E_D) + \\
  &amp;\quad \beta_{12} \mathbb{I}(1-E_F) + \beta_{13} F E_F )
\end{aligned}
\]</span></p>
<p>where the <span class="math inline">\(L\)</span> stands for the set of model variables and <span class="math inline">\(\beta\)</span> the vector of parameters. The following describe the reference/movements in the log-odds of treatment success:</p>
<ul>
<li><span class="math inline">\(\beta_{0}\)</span> baseline log-odds of treatment success in the early silo / knee site</li>
<li><span class="math inline">\(\beta_{1}\)</span> shift for late-silo membership relative to early</li>
<li><span class="math inline">\(\beta_{2}\)</span> shift for chronic-silo membership relative to early</li>
<li><span class="math inline">\(\beta_{3}\)</span> shift for hip</li>
<li><span class="math inline">\(\beta_{4}\)</span> relative shift for late-silo membership with hip</li>
<li><span class="math inline">\(\beta_{5}\)</span> relative shift for chronic-silo membership with hip</li>
<li><span class="math inline">\(\beta_{6}\)</span> shift under non-reveal (surgery<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>)</li>
<li><span class="math inline">\(\beta_{7}\)</span> shift under revision that was performed with one-stage procedure for long duration and no-rif</li>
<li><span class="math inline">\(\beta_{8}\)</span> relative shift under revision that was performed with two-stage procedure for long duration and no-rif</li>
<li><span class="math inline">\(\beta_{9}\)</span> shift under non-reveal (duration) with no differentiation for surgical nor duration preference</li>
<li><span class="math inline">\(\beta_{10}\)</span> shift for short duration when one-stage was actually performed</li>
<li><span class="math inline">\(\beta_{11}\)</span> shift for short duration when two-stage was actually performed</li>
<li><span class="math inline">\(\beta_{12}\)</span> shift under non-reveal (choice) with no differentiation for choice preference</li>
<li><span class="math inline">\(\beta_{13}\)</span> shift for rif</li>
</ul>
<p>With the complicating factor being that the surgical allocation may inform the type of surgery that the patient gets (but may deviate) and the randomisation that the patient is revealed to in the duration domain is determined by what surgical intervention the patient actually got.</p>
<p>We replace pre-randomised preference for surgical type with post-randomised surgical type performed and marginalise out this term.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-24-contents" aria-controls="callout-24" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-24" class="callout-24-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Full disclosure, I am not entirely sure as to whether the above addresses the full impacts of deviations between allocated and performed surgery or whether the DAG is sufficiently complete representation of the dependencies.</p>
</div>
</div>
</div>
<p>As previously, for the surgical domain, we are interested the effect of intervening on <span class="math inline">\(R\)</span>. For the duration domain, we are interested in the effect of intervening on <span class="math inline">\(D|R_P\)</span>. For the choice domain, we are interested in the effect of intervening on <span class="math inline">\(F\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Note that for the following specification, the design matrix can become singular (linear dependence between some of the variables) e.g.&nbsp;if surgical reveal is equivalent to silo membership. I am assuming some small amount of noise in reveal such that this isn’t a problem.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Generate complete data</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>generate_data_4 <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb56-2"><a href="#cb56-2"></a>    <span class="at">n =</span> <span class="fl">1e6</span>,</span>
<span id="cb56-3"><a href="#cb56-3"></a>    <span class="at">g =</span> <span class="cf">function</span>(p_a, l1, l2, j, er, ed, ef, r, rp, d, srp, f){ </span>
<span id="cb56-4"><a href="#cb56-4"></a>      <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> <span class="sc">-</span><span class="fl">0.04</span> <span class="sc">*</span> l1 <span class="sc">-</span> <span class="fl">0.07</span> <span class="sc">*</span> l2 <span class="sc">-</span> <span class="fl">0.02</span> <span class="sc">*</span> j <span class="sc">-</span> <span class="fl">0.01</span> <span class="sc">*</span> l1 <span class="sc">*</span> j <span class="sc">-</span> <span class="fl">0.06</span> <span class="sc">*</span> l2 <span class="sc">*</span> j <span class="sc">+</span></span>
<span id="cb56-5"><a href="#cb56-5"></a>        <span class="sc">-</span><span class="fl">0.1</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>er) <span class="sc">+</span> (<span class="fl">0.2</span><span class="sc">*</span>r <span class="sc">+</span> <span class="fl">0.4</span><span class="sc">*</span>r<span class="sc">*</span>(srp<span class="sc">==</span><span class="dv">2</span>))<span class="sc">*</span>(er) <span class="sc">+</span></span>
<span id="cb56-6"><a href="#cb56-6"></a>        <span class="sc">-</span><span class="fl">0.05</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>ed) <span class="sc">+</span> (<span class="fl">0.4</span><span class="sc">*</span>rp<span class="sc">*</span>d <span class="sc">+</span> <span class="fl">0.1</span><span class="sc">*</span>rp<span class="sc">*</span>d<span class="sc">*</span>(srp<span class="sc">==</span><span class="dv">2</span>))<span class="sc">*</span>(ed) <span class="sc">+</span></span>
<span id="cb56-7"><a href="#cb56-7"></a>        <span class="sc">-</span><span class="fl">0.25</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>ef) <span class="sc">+</span> <span class="fl">0.15</span><span class="sc">*</span>f<span class="sc">*</span>(ef) </span>
<span id="cb56-8"><a href="#cb56-8"></a>      }</span>
<span id="cb56-9"><a href="#cb56-9"></a>    ) {</span>
<span id="cb56-10"><a href="#cb56-10"></a>  </span>
<span id="cb56-11"><a href="#cb56-11"></a>  p_a <span class="ot">=</span> <span class="fu">array</span>(</span>
<span id="cb56-12"><a href="#cb56-12"></a>    <span class="fu">c</span>(<span class="fl">0.65</span>, <span class="fl">0.55</span>, <span class="fl">0.6</span>, <span class="fl">0.75</span>, <span class="fl">0.6</span>, <span class="fl">0.65</span>),</span>
<span id="cb56-13"><a href="#cb56-13"></a>    <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>), <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"early"</span>, <span class="st">"late"</span>, <span class="st">"chronic"</span>),<span class="fu">c</span>(<span class="st">"knee"</span>, <span class="st">"hip"</span>)))</span>
<span id="cb56-14"><a href="#cb56-14"></a>  </span>
<span id="cb56-15"><a href="#cb56-15"></a>  <span class="co"># silo (l) and joint (j)</span></span>
<span id="cb56-16"><a href="#cb56-16"></a>  l <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, n, <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>)) </span>
<span id="cb56-17"><a href="#cb56-17"></a>  l1 <span class="ot">=</span> <span class="fu">as.numeric</span>(l <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb56-18"><a href="#cb56-18"></a>  l2 <span class="ot">=</span> <span class="fu">as.numeric</span>(l <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb56-19"><a href="#cb56-19"></a>  </span>
<span id="cb56-20"><a href="#cb56-20"></a>  p_j <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="fl">0.4</span>,<span class="fl">0.7</span>,<span class="fl">0.5</span>,<span class="fl">0.6</span>,<span class="fl">0.3</span>,<span class="fl">0.5</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>), </span>
<span id="cb56-21"><a href="#cb56-21"></a>               <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"early"</span>, <span class="st">"late"</span>, <span class="st">"chronic"</span>), <span class="fu">c</span>(<span class="st">"knee"</span>, <span class="st">"hip"</span>)))</span>
<span id="cb56-22"><a href="#cb56-22"></a>  j <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, p_j[l<span class="sc">+</span><span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb56-23"><a href="#cb56-23"></a>  <span class="co"># reveal for late only, with a small number who never get revealed even if they</span></span>
<span id="cb56-24"><a href="#cb56-24"></a>  <span class="co"># were in late. you can leave this out but the model spec will need to be updated</span></span>
<span id="cb56-25"><a href="#cb56-25"></a>  <span class="co"># because there will be linearly depenedent cols in the design matrix</span></span>
<span id="cb56-26"><a href="#cb56-26"></a>  er <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(l <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb56-27"><a href="#cb56-27"></a>  er[l<span class="sc">==</span><span class="dv">1</span>][<span class="fu">as.logical</span>(<span class="fu">rbinom</span>(er[l<span class="sc">==</span><span class="dv">1</span>], <span class="dv">1</span>, <span class="fl">0.05</span>))] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb56-28"><a href="#cb56-28"></a>  <span class="co"># randomise dair vs rev</span></span>
<span id="cb56-29"><a href="#cb56-29"></a>  r <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>)</span>
<span id="cb56-30"><a href="#cb56-30"></a>  <span class="co"># (approx) 70% chance of clinician choosing two-stage if pt is rand to revision </span></span>
<span id="cb56-31"><a href="#cb56-31"></a>  sr <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n)</span>
<span id="cb56-32"><a href="#cb56-32"></a>  sr[r <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="fu">sum</span>(r <span class="sc">==</span> <span class="dv">0</span>), <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>))</span>
<span id="cb56-33"><a href="#cb56-33"></a>  sr[r <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="fu">sum</span>(r <span class="sc">==</span> <span class="dv">1</span>), <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.7</span>))</span>
<span id="cb56-34"><a href="#cb56-34"></a>  <span class="co"># pref towards two-stage, assuming revision</span></span>
<span id="cb56-35"><a href="#cb56-35"></a>  sra <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(sr <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb56-36"><a href="#cb56-36"></a>  <span class="co"># determine allocation of surgery type</span></span>
<span id="cb56-37"><a href="#cb56-37"></a>  ra <span class="ot">&lt;-</span> er <span class="sc">*</span> sr <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>er) <span class="sc">*</span> r <span class="sc">*</span> (sr) </span>
<span id="cb56-38"><a href="#cb56-38"></a>  </span>
<span id="cb56-39"><a href="#cb56-39"></a>  <span class="co"># 10% of the allocated treatments may have switch to a different surg type</span></span>
<span id="cb56-40"><a href="#cb56-40"></a>  srp <span class="ot">&lt;-</span> ra</span>
<span id="cb56-41"><a href="#cb56-41"></a>  ic <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.1</span>)</span>
<span id="cb56-42"><a href="#cb56-42"></a>  srp[<span class="fu">as.logical</span>(ic)] <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">2</span>, <span class="fu">sum</span>(ic), <span class="at">replace =</span> T, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>))</span>
<span id="cb56-43"><a href="#cb56-43"></a>  <span class="co"># was the procedure type dair or revision?</span></span>
<span id="cb56-44"><a href="#cb56-44"></a>  rp <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(srp <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb56-45"><a href="#cb56-45"></a>  </span>
<span id="cb56-46"><a href="#cb56-46"></a>  <span class="co"># non-reveal of duration if rp is dair (0)</span></span>
<span id="cb56-47"><a href="#cb56-47"></a>  ed <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(rp <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb56-48"><a href="#cb56-48"></a>  <span class="co"># rand to long (0), short (1) based on surgery received</span></span>
<span id="cb56-49"><a href="#cb56-49"></a>  d <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>((rp <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">*</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb56-50"><a href="#cb56-50"></a>  <span class="co"># 60% reveal ab choice</span></span>
<span id="cb56-51"><a href="#cb56-51"></a>  ef <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.6</span>)</span>
<span id="cb56-52"><a href="#cb56-52"></a>  f <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>((ef <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fl">0.5</span>))</span>
<span id="cb56-53"><a href="#cb56-53"></a>  </span>
<span id="cb56-54"><a href="#cb56-54"></a>  y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">plogis</span>(<span class="fu">g</span>(p_a, l1, l2, j, er, ed, ef, r, rp, d, srp, f)))</span>
<span id="cb56-55"><a href="#cb56-55"></a>  <span class="co"># table(y, useNA = "always")</span></span>
<span id="cb56-56"><a href="#cb56-56"></a>  </span>
<span id="cb56-57"><a href="#cb56-57"></a>  D <span class="ot">&lt;-</span> <span class="fu">data.table</span>(</span>
<span id="cb56-58"><a href="#cb56-58"></a>    l1, l2, j, </span>
<span id="cb56-59"><a href="#cb56-59"></a>    er, ed, ef,</span>
<span id="cb56-60"><a href="#cb56-60"></a>    <span class="at">erx =</span> <span class="dv">1</span><span class="sc">-</span>er, <span class="at">edx =</span> <span class="dv">1</span><span class="sc">-</span>ed, <span class="at">efx=</span><span class="dv">1</span><span class="sc">-</span>ef,</span>
<span id="cb56-61"><a href="#cb56-61"></a>    r, sr, sra, ra, </span>
<span id="cb56-62"><a href="#cb56-62"></a>    ic, rp, srp, <span class="at">srp2 =</span> <span class="fu">as.numeric</span>(srp <span class="sc">==</span> <span class="dv">2</span>), d,</span>
<span id="cb56-63"><a href="#cb56-63"></a>    f, y</span>
<span id="cb56-64"><a href="#cb56-64"></a>  )</span>
<span id="cb56-65"><a href="#cb56-65"></a>}</span>
<span id="cb56-66"><a href="#cb56-66"></a><span class="fu">set.seed</span>(<span class="dv">102</span>)</span>
<span id="cb56-67"><a href="#cb56-67"></a>D <span class="ot">&lt;-</span> <span class="fu">generate_data_4</span>()</span>
<span id="cb56-68"><a href="#cb56-68"></a></span>
<span id="cb56-69"><a href="#cb56-69"></a><span class="co"># early silo, should be non-reveal with no r options (default to 0)</span></span>
<span id="cb56-70"><a href="#cb56-70"></a><span class="co"># D[, .N, keyby = .(l, j, er, r)]</span></span>
<span id="cb56-71"><a href="#cb56-71"></a><span class="co"># those who received rev are revealed for d (ed = 0) and are 0:1 conditional on revision type (srp)</span></span>
<span id="cb56-72"><a href="#cb56-72"></a><span class="co"># D[, .N, keyby = .(rp, ed, srp, d)]</span></span>
<span id="cb56-73"><a href="#cb56-73"></a><span class="co"># those entering ab choice should come from all strata, infec site</span></span>
<span id="cb56-74"><a href="#cb56-74"></a><span class="co"># D[ef == 0, .N, keyby = .(l, j, f)]</span></span>
<span id="cb56-75"><a href="#cb56-75"></a><span class="co"># those that dont should also be dist across sample</span></span>
<span id="cb56-76"><a href="#cb56-76"></a><span class="co"># D[ef == 1, .N, keyby = .(l, j, f)]</span></span>
<span id="cb56-77"><a href="#cb56-77"></a></span>
<span id="cb56-78"><a href="#cb56-78"></a>fit2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(y <span class="sc">~</span> l1 <span class="sc">+</span> l2 <span class="sc">+</span> j <span class="sc">+</span> l1<span class="sc">:</span>j <span class="sc">+</span> l2<span class="sc">:</span>j <span class="sc">+</span></span>
<span id="cb56-79"><a href="#cb56-79"></a>              erx <span class="sc">+</span> er<span class="sc">:</span>r <span class="sc">+</span> er<span class="sc">:</span>r<span class="sc">:</span>srp2 <span class="sc">+</span></span>
<span id="cb56-80"><a href="#cb56-80"></a>              edx <span class="sc">+</span> ed<span class="sc">:</span>rp<span class="sc">:</span>d <span class="sc">+</span> ed<span class="sc">:</span>d<span class="sc">:</span>rp<span class="sc">:</span>srp2 <span class="sc">+</span></span>
<span id="cb56-81"><a href="#cb56-81"></a>              efx <span class="sc">+</span> ef<span class="sc">:</span>f, </span>
<span id="cb56-82"><a href="#cb56-82"></a>            <span class="at">data =</span> D, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb56-83"><a href="#cb56-83"></a><span class="fu">summary</span>(fit2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y ~ l1 + l2 + j + l1:j + l2:j + erx + er:r + er:r:srp2 + 
    edx + ed:rp:d + ed:d:rp:srp2 + efx + ef:f, family = binomial(), 
    data = D)

Coefficients:
              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  -0.992730   0.017361 -57.182  &lt; 2e-16 ***
l1           -0.036997   0.016251  -2.277  0.02281 *  
l2           -0.081398   0.009886  -8.234  &lt; 2e-16 ***
j            -0.028103   0.008548  -3.288  0.00101 ** 
erx          -0.101703   0.015480  -6.570 5.04e-11 ***
edx          -0.045398   0.006282  -7.227 4.94e-13 ***
efx          -0.251435   0.005446 -46.167  &lt; 2e-16 ***
l1:j         -0.022724   0.010840  -2.096  0.03605 *  
l2:j         -0.052919   0.013561  -3.902 9.53e-05 ***
er:r          0.187560   0.009727  19.283  &lt; 2e-16 ***
ef:f          0.147332   0.005624  26.198  &lt; 2e-16 ***
er:r:srp2     0.407762   0.010375  39.302  &lt; 2e-16 ***
ed:rp:d       0.414709   0.008222  50.439  &lt; 2e-16 ***
srp2:ed:rp:d  0.085740   0.008749   9.800  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1216852  on 999999  degrees of freedom
Residual deviance: 1179406  on 999986  degrees of freedom
AIC: 1179434

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details class="code-fold">
<summary>Generate complete data</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># linearly_dep_cols(fit2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>Using g-computation to determine the marginal effects. <code>lnor</code> and <code>lnoravg</code> are used as the comparisons.</p>
<p>The first (<code>lnor</code>) approach (average log odds?)</p>
<ol type="1">
<li>predicts the log-odds of treatment success for all units with the surgical approach set to revision.</li>
<li>predicts the log-odds of treatment success for all units with the surgical approach set to dair.</li>
<li>computes the difference between the response on the log odds scale and takes the mean</li>
</ol>
<p>Also can be derived from a weigted combination of the parameters from the regression model. What is an accurate interpretation of this parameter? How would you explain it to a non-statistician?</p>
<p>The second (<code>lnoravg</code>) approach (marginal mean?)</p>
<ol type="1">
<li>predicts the probability of treatment success for all units with the surgical approach set to revision and computes the mean</li>
<li>predicts the probability of treatment success for all units with the surgical approach set to dair and computes the mean</li>
<li>converts the mean probability of treatment success to the log-odds scale and takes the difference</li>
</ol>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># Revision vs. DAIR</span></span>
<span id="cb59-2"><a href="#cb59-2"></a>cmp <span class="ot">&lt;-</span> <span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnor"</span>)</span>
<span id="cb59-3"><a href="#cb59-3"></a></span>
<span id="cb59-4"><a href="#cb59-4"></a><span class="co"># avg_comparisons(fit2, variables = "r", comparison = "lnor", by = "er")</span></span>
<span id="cb59-5"><a href="#cb59-5"></a></span>
<span id="cb59-6"><a href="#cb59-6"></a>d_new <span class="ot">&lt;-</span> <span class="fu">copy</span>(D)</span>
<span id="cb59-7"><a href="#cb59-7"></a></span>
<span id="cb59-8"><a href="#cb59-8"></a><span class="co"># equivalent to using lnor</span></span>
<span id="cb59-9"><a href="#cb59-9"></a>d_new[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">r =</span> <span class="dv">1</span>)]</span>
<span id="cb59-10"><a href="#cb59-10"></a>lo1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">newdata =</span> d_new)</span>
<span id="cb59-11"><a href="#cb59-11"></a>d_new[, <span class="st">`</span><span class="at">:=</span><span class="st">`</span>(<span class="at">r =</span> <span class="dv">0</span>)]</span>
<span id="cb59-12"><a href="#cb59-12"></a>lo0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">newdata =</span> d_new)</span>
<span id="cb59-13"><a href="#cb59-13"></a></span>
<span id="cb59-14"><a href="#cb59-14"></a><span class="co"># in this setting is equivalent to weighted combination of parameters</span></span>
<span id="cb59-15"><a href="#cb59-15"></a>b <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit2)</span>
<span id="cb59-16"><a href="#cb59-16"></a></span>
<span id="cb59-17"><a href="#cb59-17"></a>w_srp <span class="ot">&lt;-</span> D[er <span class="sc">==</span> <span class="dv">1</span>, <span class="fu">mean</span>(srp2)]</span>
<span id="cb59-18"><a href="#cb59-18"></a>w_er <span class="ot">&lt;-</span> D[, <span class="fu">mean</span>(er)]</span>
<span id="cb59-19"><a href="#cb59-19"></a></span>
<span id="cb59-20"><a href="#cb59-20"></a><span class="fu">rbind</span>(</span>
<span id="cb59-21"><a href="#cb59-21"></a>  <span class="st">"predict at r = 0/1"</span> <span class="ot">=</span> <span class="fu">mean</span>(lo1 <span class="sc">-</span> lo0),</span>
<span id="cb59-22"><a href="#cb59-22"></a>  <span class="st">"weighting coef by er and srp (condit on reveal)"</span> <span class="ot">=</span> w_er <span class="sc">*</span> b[<span class="st">"er:r"</span>] <span class="sc">+</span> w_er <span class="sc">*</span> w_srp <span class="sc">*</span> b[<span class="st">"er:r:srp2"</span>] , </span>
<span id="cb59-23"><a href="#cb59-23"></a>  <span class="st">"avg_comparisons (lnor)"</span> <span class="ot">=</span> cmp<span class="sc">$</span>estimate</span>
<span id="cb59-24"><a href="#cb59-24"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                                     er:r
predict at r = 0/1                              0.2136018
weighting coef by er and srp (condit on reveal) 0.2136018
avg_comparisons (lnor)                          0.2136018</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>cmp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast Estimate Std. Error    z Pr(&gt;|z|)   S 2.5 % 97.5 %
    r ln(odds(1) / odds(0))    0.214    0.00301 70.9   &lt;0.001 Inf 0.208   0.22

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># using lnoravg</span></span>
<span id="cb63-2"><a href="#cb63-2"></a><span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"r"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast Estimate Std. Error    z Pr(&gt;|z|)   S 2.5 % 97.5 %
    r ln(odds(1) / odds(0))    0.229    0.00314 73.1   &lt;0.001 Inf 0.223  0.235

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted 
Type:  response </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>d_new[, r <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span>]</span>
<span id="cb65-2"><a href="#cb65-2"></a>p1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">newdata =</span> d_new, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb65-3"><a href="#cb65-3"></a>d_new[, r <span class="sc">:</span><span class="er">=</span> <span class="dv">0</span>]</span>
<span id="cb65-4"><a href="#cb65-4"></a>p0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit2, <span class="at">newdata =</span> d_new, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb65-5"><a href="#cb65-5"></a><span class="fu">qlogis</span>(<span class="fu">mean</span>(p1)) <span class="sc">-</span> <span class="fu">qlogis</span>(<span class="fu">mean</span>(p0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2292898</code></pre>
</div>
</div>
<p>And for duration and choice.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># Short vs Long (one-stage) and short vs. long (two-stage)</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"d"</span>, <span class="at">by =</span> <span class="st">"srp2"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast srp2 Estimate Std. Error    z Pr(&gt;|z|)   S 2.5 %
    d ln(odds(1) / odds(0))    0    0.179    0.00361 49.8   &lt;0.001 Inf 0.172
    d ln(odds(1) / odds(0))    1    0.486    0.00558 87.1   &lt;0.001 Inf 0.475
 97.5 %
  0.187
  0.497

Columns: term, contrast, srp2, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high 
Type:  response </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># Rifampicin vs not</span></span>
<span id="cb69-2"><a href="#cb69-2"></a><span class="fu">avg_comparisons</span>(fit2, <span class="at">variables =</span> <span class="st">"f"</span>, <span class="at">comparison =</span> <span class="st">"lnoravg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
 Term              Contrast Estimate Std. Error    z Pr(&gt;|z|)     S  2.5 %
    f ln(odds(1) / odds(0))   0.0894    0.00341 26.2   &lt;0.001 500.7 0.0827
 97.5 %
  0.096

Columns: term, contrast, estimate, std.error, statistic, p.value, s.value, conf.low, conf.high, predicted_lo, predicted_hi, predicted 
Type:  response </code></pre>
</div>
</div>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The parameter ignores potential differentiation for surgical type.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/github\.com");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>